<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--created by Augurit    2019-12-23 09:54:35 -->
<!--0 一些前置信息配置 -->
<mapper namespace="com.augurit.aplanmis.common.mapper.AeaHiSolicitMapper">
    <!--1 返回所有字段的SQL字句 -->
    <sql id="allColumns">
    ${alias}.SOLICIT_ID  solicitId,
    ${alias}.BUS_TYPE  busType,
    ${alias}.SOLICIT_TYPE  solicitType,
    ${alias}.SOLICIT_ORG_ID  solicitOrgId,
    ${alias}.SOLICIT_ITEM_ID  solicitItemId,
    ${alias}.APPLYINST_ID  applyinstId,
    ${alias}.PROCINST_ID  procinstId,
    ${alias}.HI_TASKINST_ID  hiTaskinstId,
    ${alias}.SOLICIT_CODE  solicitCode,
    ${alias}.SOLICIT_TOPIC  solicitTopic,
    ${alias}.SOLICIT_CONTENT  solicitContent,
    ${alias}.SOLICIT_DUE_DAYS  solicitDueDays,
    ${alias}.SOLICIT_REAL_DAYS  solicitRealDays,
    ${alias}.SOLICIT_DAYS_UNIT  solicitDaysUnit,
    ${alias}.SOLICIT_START_TIME  solicitStartTime,
    ${alias}.SOLICIT_END_TIME  solicitEndTime,
    ${alias}.IS_CALC_TIMERULE  isCalcTimerule,
    ${alias}.SOLICIT_TIMERULE_ID  solicitTimeruleId,
    ${alias}.CONCLUSION_FLAG  conclusionFlag,
    ${alias}.CONCLUSION_DESC  conclusionDesc,
    ${alias}.CONCLUSION_TIME  conclusionTime,
    ${alias}.CONCLUSION_USER_ID  conclusionUserId,
    ${alias}.CONCLUSION_USER_NAME  conclusionUserName,
    ${alias}.INITIATOR_ORG_ID  initiatorOrgId,
    ${alias}.INITIATOR_ORG_NAME  initiatorOrgName,
    ${alias}.INITIATOR_USER_ID  initiatorUserId,
    ${alias}.INITIATOR_USER_NAME  initiatorUserName,
    ${alias}.COUNT_LIMIT  countLimit,
    ${alias}.SOLICIT_STATE  solicitState,
    ${alias}.CREATER  creater,
    ${alias}.CREATE_TIME  createTime,
    ${alias}.MODIFIER  modifier,
    ${alias}.MODIFY_TIME  modifyTime,
    ${alias}.ROOT_ORG_ID  rootOrgId
    </sql>

    <!--2 根据主键ID查询单个实体 -->
    <select id="getAeaHiSolicitById" resultType="AeaHiSolicit">
        select
        <include refid="allColumns">
            <property name="alias" value="ahs"/>
        </include>
        from AEA_HI_SOLICIT ahs
        where ahs.SOLICIT_ID = #{id}
    </select>

    <!--3 根据条件查询实体list -->
    <select id="listAeaHiSolicit" resultType="AeaHiSolicit">
        select
        <include refid="allColumns">
            <property name="alias" value="ahs"/>
        </include>
        from AEA_HI_SOLICIT ahs
        <where>
            <if test="solicitId != null AND solicitId != ''">
                AND ahs.SOLICIT_ID = #{solicitId}
            </if>
            <if test="busType != null AND busType != ''">
                AND ahs.BUS_TYPE = #{busType}
            </if>
            <if test="solicitType != null AND solicitType != ''">
                AND ahs.SOLICIT_TYPE = #{solicitType}
            </if>
            <if test="solicitOrgId != null AND solicitOrgId != ''">
                AND ahs.SOLICIT_ORG_ID = #{solicitOrgId}
            </if>
            <if test="solicitItemId != null AND solicitItemId != ''">
                AND ahs.SOLICIT_ITEM_ID = #{solicitItemId}
            </if>
            <if test="applyinstId != null AND applyinstId != ''">
                AND ahs.APPLYINST_ID = #{applyinstId}
            </if>
            <if test="procinstId != null AND procinstId != ''">
                AND ahs.PROCINST_ID = #{procinstId}
            </if>
            <if test="hiTaskinstId != null AND hiTaskinstId != ''">
                AND ahs.HI_TASKINST_ID = #{hiTaskinstId}
            </if>
            <if test="solicitCode != null AND solicitCode != ''">
                AND ahs.SOLICIT_CODE = #{solicitCode}
            </if>
            <if test="solicitTopic != null AND solicitTopic != ''">
                AND ahs.SOLICIT_TOPIC = #{solicitTopic}
            </if>
            <if test="solicitContent != null AND solicitContent != ''">
                AND ahs.SOLICIT_CONTENT = #{solicitContent}
            </if>
            <if test="solicitDueDays != null AND solicitDueDays != ''">
                AND ahs.SOLICIT_DUE_DAYS = #{solicitDueDays}
            </if>
            <if test="solicitRealDays != null AND solicitRealDays != ''">
                AND ahs.SOLICIT_REAL_DAYS = #{solicitRealDays}
            </if>
            <if test="solicitDaysUnit != null AND solicitDaysUnit != ''">
                AND ahs.SOLICIT_DAYS_UNIT = #{solicitDaysUnit}
            </if>
            <if test="solicitStartTime != null AND solicitStartTime != ''">
                AND ahs.SOLICIT_START_TIME = #{solicitStartTime}
            </if>
            <if test="solicitEndTime != null AND solicitEndTime != ''">
                AND ahs.SOLICIT_END_TIME = #{solicitEndTime}
            </if>
            <if test="isCalcTimerule != null AND isCalcTimerule != ''">
                AND ahs.IS_CALC_TIMERULE = #{isCalcTimerule}
            </if>
            <if test="solicitTimeruleId != null AND solicitTimeruleId != ''">
                AND ahs.SOLICIT_TIMERULE_ID = #{solicitTimeruleId}
            </if>
            <if test="conclusionFlag != null AND conclusionFlag != ''">
                AND ahs.CONCLUSION_FLAG = #{conclusionFlag}
            </if>
            <if test="conclusionDesc != null AND conclusionDesc != ''">
                AND ahs.CONCLUSION_DESC = #{conclusionDesc}
            </if>
            <if test="conclusionTime != null AND conclusionTime != ''">
                AND ahs.CONCLUSION_TIME = #{conclusionTime}
            </if>
            <if test="conclusionUserId != null AND conclusionUserId != ''">
                AND ahs.CONCLUSION_USER_ID = #{conclusionUserId}
            </if>
            <if test="conclusionUserName != null AND conclusionUserName != ''">
                AND ahs.CONCLUSION_USER_NAME = #{conclusionUserName}
            </if>
            <if test="initiatorOrgId != null AND initiatorOrgId != ''">
                AND ahs.INITIATOR_ORG_ID = #{initiatorOrgId}
            </if>
            <if test="initiatorOrgName != null AND initiatorOrgName != ''">
                AND ahs.INITIATOR_ORG_NAME = #{initiatorOrgName}
            </if>
            <if test="initiatorUserId != null AND initiatorUserId != ''">
                AND ahs.INITIATOR_USER_ID = #{initiatorUserId}
            </if>
            <if test="initiatorUserName != null AND initiatorUserName != ''">
                AND ahs.INITIATOR_USER_NAME = #{initiatorUserName}
            </if>
            <if test="countLimit != null AND countLimit != ''">
                AND ahs.COUNT_LIMIT = #{countLimit}
            </if>
            <if test="solicitState != null AND solicitState != ''">
                AND ahs.SOLICIT_STATE = #{solicitState}
            </if>
            <if test="creater != null AND creater != ''">
                AND ahs.CREATER = #{creater}
            </if>
            <if test="createTime != null AND createTime != ''">
                AND ahs.CREATE_TIME = #{createTime}
            </if>
            <if test="modifier != null AND modifier != ''">
                AND ahs.MODIFIER = #{modifier}
            </if>
            <if test="modifyTime != null AND modifyTime != ''">
                AND ahs.MODIFY_TIME = #{modifyTime}
            </if>
            <if test="rootOrgId != null AND rootOrgId != ''">
                AND ahs.ROOT_ORG_ID = #{rootOrgId}
            </if>
        </where>
    </select>
    <!--4 根据条件查询实体list,返回分页对象 -->

    <!--5 新增实体对象 -->
    <insert id="insertAeaHiSolicit" parameterType="AeaHiSolicit">
        insert into AEA_HI_SOLICIT (
    SOLICIT_ID  ,BUS_TYPE  ,SOLICIT_TYPE  ,SOLICIT_ORG_ID  ,SOLICIT_ITEM_ID  ,APPLYINST_ID  ,PROCINST_ID  ,HI_TASKINST_ID  ,SOLICIT_CODE  ,SOLICIT_TOPIC  ,SOLICIT_CONTENT  ,SOLICIT_DUE_DAYS  ,SOLICIT_REAL_DAYS  ,SOLICIT_DAYS_UNIT  ,SOLICIT_START_TIME  ,SOLICIT_END_TIME  ,IS_CALC_TIMERULE  ,SOLICIT_TIMERULE_ID  ,CONCLUSION_FLAG  ,CONCLUSION_DESC  ,CONCLUSION_TIME  ,CONCLUSION_USER_ID  ,CONCLUSION_USER_NAME  ,INITIATOR_ORG_ID  ,INITIATOR_ORG_NAME  ,INITIATOR_USER_ID  ,INITIATOR_USER_NAME  ,COUNT_LIMIT  ,SOLICIT_STATE  ,CREATER  ,CREATE_TIME  ,MODIFIER  ,MODIFY_TIME  ,ROOT_ORG_ID
        )  values  (
    #{solicitId},#{busType},#{solicitType},#{solicitOrgId},#{solicitItemId},#{applyinstId},#{procinstId},#{hiTaskinstId},#{solicitCode},#{solicitTopic},#{solicitContent},#{solicitDueDays},#{solicitRealDays},#{solicitDaysUnit},#{solicitStartTime},#{solicitEndTime},#{isCalcTimerule},#{solicitTimeruleId},#{conclusionFlag},#{conclusionDesc},#{conclusionTime},#{conclusionUserId},#{conclusionUserName},#{initiatorOrgId},#{initiatorOrgName},#{initiatorUserId},#{initiatorUserName},#{countLimit},#{solicitState},#{creater},#{createTime},#{modifier},#{modifyTime},  #{rootOrgId}
        )
    </insert>
    <!--6 修改实体对象 -->
    <update id="updateAeaHiSolicit" parameterType="AeaHiSolicit">
        update AEA_HI_SOLICIT
        <set>
            <if test="solicitId != null AND solicitId != '' ">
                SOLICIT_ID = #{solicitId},
            </if>
            <if test="busType != null AND busType != '' ">
                BUS_TYPE = #{busType},
            </if>
            <if test="solicitType != null AND solicitType != '' ">
                SOLICIT_TYPE = #{solicitType},
            </if>
            <if test="solicitOrgId != null AND solicitOrgId != '' ">
                SOLICIT_ORG_ID = #{solicitOrgId},
            </if>
            <if test="solicitItemId != null AND solicitItemId != '' ">
                SOLICIT_ITEM_ID = #{solicitItemId},
            </if>
            <if test="applyinstId != null AND applyinstId != '' ">
                APPLYINST_ID = #{applyinstId},
            </if>
            <if test="procinstId != null AND procinstId != '' ">
                PROCINST_ID = #{procinstId},
            </if>
            <if test="hiTaskinstId != null AND hiTaskinstId != '' ">
                HI_TASKINST_ID = #{hiTaskinstId},
            </if>
            <if test="solicitCode != null AND solicitCode != '' ">
                SOLICIT_CODE = #{solicitCode},
            </if>
            <if test="solicitTopic != null AND solicitTopic != '' ">
                SOLICIT_TOPIC = #{solicitTopic},
            </if>
            <if test="solicitContent != null AND solicitContent != '' ">
                SOLICIT_CONTENT = #{solicitContent},
            </if>
            <if test="solicitDueDays != null AND solicitDueDays != '' ">
                SOLICIT_DUE_DAYS = #{solicitDueDays},
            </if>
            <if test="solicitRealDays != null AND solicitRealDays != '' ">
                SOLICIT_REAL_DAYS = #{solicitRealDays},
            </if>
            <if test="solicitDaysUnit != null AND solicitDaysUnit != '' ">
                SOLICIT_DAYS_UNIT = #{solicitDaysUnit},
            </if>
            <if test="solicitStartTime != null AND solicitStartTime != '' ">
                SOLICIT_START_TIME = #{solicitStartTime},
            </if>
            <if test="solicitEndTime != null AND solicitEndTime != '' ">
                SOLICIT_END_TIME = #{solicitEndTime},
            </if>
            <if test="isCalcTimerule != null AND isCalcTimerule != '' ">
                IS_CALC_TIMERULE = #{isCalcTimerule},
            </if>
            <if test="solicitTimeruleId != null AND solicitTimeruleId != '' ">
                SOLICIT_TIMERULE_ID = #{solicitTimeruleId},
            </if>
            <if test="conclusionFlag != null AND conclusionFlag != '' ">
                CONCLUSION_FLAG = #{conclusionFlag},
            </if>
            <if test="conclusionDesc != null AND conclusionDesc != '' ">
                CONCLUSION_DESC = #{conclusionDesc},
            </if>
            <if test="conclusionTime != null AND conclusionTime != '' ">
                CONCLUSION_TIME = #{conclusionTime},
            </if>
            <if test="conclusionUserId != null AND conclusionUserId != '' ">
                CONCLUSION_USER_ID = #{conclusionUserId},
            </if>
            <if test="conclusionUserName != null AND conclusionUserName != '' ">
                CONCLUSION_USER_NAME = #{conclusionUserName},
            </if>
            <if test="initiatorOrgId != null AND initiatorOrgId != '' ">
                INITIATOR_ORG_ID = #{initiatorOrgId},
            </if>
            <if test="initiatorOrgName != null AND initiatorOrgName != '' ">
                INITIATOR_ORG_NAME = #{initiatorOrgName},
            </if>
            <if test="initiatorUserId != null AND initiatorUserId != '' ">
                INITIATOR_USER_ID = #{initiatorUserId},
            </if>
            <if test="initiatorUserName != null AND initiatorUserName != '' ">
                INITIATOR_USER_NAME = #{initiatorUserName},
            </if>
            <if test="countLimit != null AND countLimit != '' ">
                COUNT_LIMIT = #{countLimit},
            </if>
            <if test="solicitState != null AND solicitState != '' ">
                SOLICIT_STATE = #{solicitState},
            </if>
            <if test="creater != null AND creater != '' ">
                CREATER = #{creater},
            </if>
            <if test="createTime != null AND createTime != '' ">
                CREATE_TIME = #{createTime},
            </if>
            <if test="modifier != null AND modifier != '' ">
                MODIFIER = #{modifier},
            </if>
            <if test="modifyTime != null AND modifyTime != '' ">
                MODIFY_TIME = #{modifyTime},
            </if>
            <if test="rootOrgId != null AND rootOrgId != '' ">
                ROOT_ORG_ID = #{rootOrgId},
            </if>
        </set>
        where SOLICIT_ID = #{solicitId}
    </update>
    <!--7 删除实体对象,根据主键ID -->
    <delete id="deleteAeaHiSolicit">
        delete from   AEA_HI_SOLICIT
        where
    SOLICIT_ID = #{id}
    </delete>

    <!--根据意见征求流水号获取意见征求信息-->
    <select id="getAeaHiSolicitBySolicitCode" resultType="AeaHiSolicit">
        select
        <include refid="allColumns">
            <property name="alias" value="ahs"/>
        </include>
        from AEA_HI_SOLICIT ahs
        where ahs.SOLICIT_CODE = #{solicitCode}
    </select>

    <sql id="queryByThemeId">
        <if test="theme!=null and theme!=''">
            and theme.THEME_ID=#{theme}
        </if>
    </sql>
    <!--查询意见征求，一次征询，部门征求等意见列表-->
    <select id="listSolicit" resultType="com.augurit.aplanmis.common.vo.solicit.AeaHiSolicitVo">

        SELECT
        ahs.SOLICIT_ID as solicitId,
        ahs.SOLICIT_TYPE as solicitType,
        ahs.PROCINST_ID as procinstId,
        ahs.HI_TASKINST_ID as hiTaskinstId,
        ahs.SOLICIT_CODE as solicitCode,
        ahs.SOLICIT_TOPIC as solicitTopic,
        ahs.APPLYINST_ID as applyinstId,
        ahs.INITIATOR_ORG_ID as initiatorOrgId,
        ahs.INITIATOR_ORG_NAME as initiatorOrgName,
        ahs.INITIATOR_USER_ID as initiatorUserId,
        ahs.INITIATOR_USER_NAME as initiatorUserName,
        ahs.OVERDUE_TIME overdueTime,
        ahs.REMAINING_TIME remainingTime,
        ahs.TIMERULE_UNIT as timeruleUnit,
        ahs.taskId as taskId,
        ahs.SOLICIT_DETAIL_ID as solicitDetailId,
        ahs.DETAIL_TASK_ID as detailTaskId,
        aha.APPLYINST_CODE as applyinstCode,
        aha.IS_SERIES_APPROVE as isSeriesApprove,
        ( CASE aha.IS_SERIES_APPROVE WHEN '0' THEN '并联' ELSE '单项' END ) AS applyType,
        aha.CREATE_TIME as createTime,
        aha.ITEMINST_NAME as itemName,
        aha.STAGE_NAME as stageName,
        aha.THEME_NAME as themeName,
        aha.APPLYINST_SOURCE as applyinstSource,
        ( CASE aha.APPLYINST_SOURCE WHEN 'win' THEN '网厅' ELSE '窗口' END ) AS applySource,
        api.PROJ_NAME as projName,
        api.PROJ_INFO_ID as projInfoId,
        api.LOCAL_CODE as localCode
        FROM
        (
        SELECT
        ahs.SOLICIT_ID,
        ahs.SOLICIT_TYPE,
        ahs.PROCINST_ID,
        ahs.HI_TASKINST_ID,
        ahs.SOLICIT_CODE,
        ahs.SOLICIT_TOPIC,
        ahs.APPLYINST_ID,
        ahs.INITIATOR_ORG_ID,
        ahs.INITIATOR_ORG_NAME,
        ahs.INITIATOR_USER_ID,
        ahs.INITIATOR_USER_NAME,
        ahsd.SOLICIT_DETAIL_ID,
        ahsdu.DETAIL_TASK_ID,
        ahsdu.USER_ID,
        asti.OVERDUE_TIME,
        asti.REMAINING_TIME,
        asti.TIMERULE_UNIT,
        art.ID_ as taskId
        FROM AEA_HI_SOLICIT ahs
        left join ACT_RU_TASK art on art.PROC_INST_ID_=ahs.PROCINST_ID
        left join act_hi_taskinst aht on aht.ID_=ahs.HI_TASKINST_ID
        LEFT JOIN AEA_HI_SOLICIT_DETAIL ahsd ON ahsd.SOLICIT_ID = ahs.SOLICIT_ID
        LEFT JOIN AEA_HI_SOLICIT_DETAIL_USER ahsdu ON ahsdu.SOLICIT_DETAIL_ID = ahsd.SOLICIT_DETAIL_ID
        LEFT JOIN AEA_SOLICIT_ITEM asi ON asi.ITEM_VER_ID = ahsd.ITEM_VER_ID
        LEFT JOIN ACT_STO_TIMERULE ast ON ast.TIMERULE_ID = ahs.SOLICIT_TIMERULE_ID
        LEFT JOIN ACT_STO_TIMERULE_INST asti ON asti.TIMERULE_ID = ast.TIMERULE_ID AND ahs.PROCINST_ID =
        asti.PROC_INST_ID
        WHERE ahs.SOLICIT_TYPE = 'i' AND asi.BUS_TYPE = #{busType} and ahs.SOLICIT_STATE in('0','1')
        AND ( ahs.INITIATOR_USER_ID = #{userId} OR ahsdu.USER_ID =#{userId} )
        AND ahs.ROOT_ORG_ID = #{rootOrgId}
        UNION
        SELECT
        ahs.SOLICIT_ID,
        ahs.SOLICIT_TYPE,
        ahs.PROCINST_ID,
        ahs.HI_TASKINST_ID,
        ahs.SOLICIT_CODE,
        ahs.SOLICIT_TOPIC,
        ahs.APPLYINST_ID,
        ahs.INITIATOR_ORG_ID,
        ahs.INITIATOR_ORG_NAME,
        ahs.INITIATOR_USER_ID,
        ahs.INITIATOR_USER_NAME,
        ahsd.SOLICIT_DETAIL_ID,
        ahsdu.DETAIL_TASK_ID,
        ahsdu.USER_ID,
        asti.OVERDUE_TIME,
        asti.REMAINING_TIME,
        asti.TIMERULE_UNIT,
        art.ID_ as taskId
        FROM AEA_HI_SOLICIT ahs
        left join ACT_RU_TASK art on art.PROC_INST_ID_=ahs.PROCINST_ID
        left join act_hi_taskinst aht on aht.ID_=ahs.HI_TASKINST_ID
        LEFT JOIN AEA_HI_SOLICIT_DETAIL ahsd ON ahsd.SOLICIT_ID = ahs.SOLICIT_ID
        LEFT JOIN AEA_HI_SOLICIT_DETAIL_USER ahsdu ON ahsdu.SOLICIT_DETAIL_ID = ahsd.SOLICIT_DETAIL_ID
        LEFT JOIN AEA_SOLICIT_ORG aso ON aso.ORG_ID = ahsd.DETAIL_ORG_ID
        LEFT JOIN ACT_STO_TIMERULE ast ON ast.TIMERULE_ID = ahs.SOLICIT_TIMERULE_ID
        LEFT JOIN ACT_STO_TIMERULE_INST asti ON asti.TIMERULE_ID = ast.TIMERULE_ID AND ahs.PROCINST_ID =
        asti.PROC_INST_ID
        WHERE ahs.SOLICIT_TYPE = 'd' AND aso.BUS_TYPE = #{busType} and ahs.SOLICIT_STATE in('0','1')
        AND ( ahs.INITIATOR_USER_ID = #{userId} OR ahsdu.USER_ID = #{userId} )
        AND ahs.ROOT_ORG_ID = #{rootOrgId}
        ) ahs
        LEFT JOIN (
        SELECT
        aha.APPLYINST_ID,
        aha.APPLYINST_CODE,
        aha.IS_SERIES_APPROVE,
        aha.CREATE_TIME,
        aha.APPLYINST_SOURCE,
        NULL AS ITEMINST_NAME,
        aps_123.STAGE_NAME,
        theme.THEME_NAME
        FROM AEA_HI_APPLYINST aha
        INNER JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = aha.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <where>
            aha.IS_SERIES_APPROVE = '0'
            <include refid="queryByThemeId"></include>
        </where>

        UNION
        SELECT
        aha.APPLYINST_ID,
        aha.APPLYINST_CODE,
        aha.IS_SERIES_APPROVE,
        aha.CREATE_TIME,
        aha.APPLYINST_SOURCE,
        NULL AS ITEMINST_NAME,
        aps_123.STAGE_NAME,
        theme.THEME_NAME
        FROM AEA_HI_APPLYINST aha
        INNER JOIN aea_hi_seriesinst ahs ON ahs.applyinst_id = aha.applyinst_id
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <where>
            aha.IS_SERIES_APPROVE = '1' AND ahs.stage_id IS NOT NULL AND ahs.IS_PARALLEL = '1'
            <include refid="queryByThemeId"></include>
        </where>
        UNION
        SELECT
        aha.APPLYINST_ID,
        aha.APPLYINST_CODE,
        aha.IS_SERIES_APPROVE,
        aha.CREATE_TIME,
        aha.APPLYINST_SOURCE,
        iteminst.ITEMINST_NAME AS ITEMINST_NAME,
        NULL AS STAGE_NAME,
        NULL AS THEME_NAME
        FROM AEA_HI_APPLYINST aha
        INNER JOIN AEA_HI_SERIESINST ahs ON ahs.applyinst_id = aha.applyinst_id
        LEFT JOIN AEA_HI_ITEMINST iteminst ON iteminst.SERIESINST_ID = ahs.SERIESINST_ID
        <where>
            aha.IS_SERIES_APPROVE = '1' AND ahs.IS_PARALLEL = '0'
            <include refid="queryByThemeId"></include>
        </where>

        ) aha ON ahs.APPLYINST_ID = aha.APPLYINST_ID
        LEFT JOIN aea_applyinst_proj aap ON ahs.APPLYINST_ID = aap.APPLYINST_ID
        LEFT JOIN aea_proj_info api ON aap.PROJ_INFO_ID = api.PROJ_INFO_ID

        <where>
            <if test="keyword!=null and keyword!=''">
                AND (
                api.PROJ_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR api.LOCAL_CODE LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR api.GCBM LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR aha.APPLYINST_CODE LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR aha.ITEMINST_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR aha.STAGE_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
            <if test="applyType!=null and applyType!=''">
                and aha.IS_SERIES_APPROVE=#{applyType}
            </if>
        </where>

    </select>

    <!--8 删除实体对象列表,根据主键ID列表 -->
    <!--9 返回所有字段的对象map,用于级联 -->
    <resultMap type="AeaHiSolicit" id="AeaHiSolicitMap">
        <id property="solicitId" column="SOLICIT_ID"/>
        <result property="busType" column="BUS_TYPE"/>
        <result property="solicitType" column="SOLICIT_TYPE"/>
        <result property="solicitOrgId" column="SOLICIT_ORG_ID"/>
        <result property="solicitItemId" column="SOLICIT_ITEM_ID"/>
        <result property="applyinstId" column="APPLYINST_ID"/>
        <result property="procinstId" column="PROCINST_ID"/>
        <result property="hiTaskinstId" column="HI_TASKINST_ID"/>
        <result property="solicitCode" column="SOLICIT_CODE"/>
        <result property="solicitTopic" column="SOLICIT_TOPIC"/>
        <result property="solicitContent" column="SOLICIT_CONTENT"/>
        <result property="solicitDueDays" column="SOLICIT_DUE_DAYS"/>
        <result property="solicitRealDays" column="SOLICIT_REAL_DAYS"/>
        <result property="solicitDaysUnit" column="SOLICIT_DAYS_UNIT"/>
        <result property="solicitStartTime" column="SOLICIT_START_TIME"/>
        <result property="solicitEndTime" column="SOLICIT_END_TIME"/>
        <result property="isCalcTimerule" column="IS_CALC_TIMERULE"/>
        <result property="solicitTimeruleId" column="SOLICIT_TIMERULE_ID"/>
        <result property="conclusionFlag" column="CONCLUSION_FLAG"/>
        <result property="conclusionDesc" column="CONCLUSION_DESC"/>
        <result property="conclusionTime" column="CONCLUSION_TIME"/>
        <result property="conclusionUserId" column="CONCLUSION_USER_ID"/>
        <result property="conclusionUserName" column="CONCLUSION_USER_NAME"/>
        <result property="initiatorOrgId" column="INITIATOR_ORG_ID"/>
        <result property="initiatorOrgName" column="INITIATOR_ORG_NAME"/>
        <result property="initiatorUserId" column="INITIATOR_USER_ID"/>
        <result property="initiatorUserName" column="INITIATOR_USER_NAME"/>
        <result property="countLimit" column="COUNT_LIMIT"/>
        <result property="solicitState" column="SOLICIT_STATE"/>
        <result property="creater" column="CREATER"/>
        <result property="createTime" column="CREATE_TIME"/>
        <result property="modifier" column="MODIFIER"/>
        <result property="modifyTime" column="MODIFY_TIME"/>
        <result property="rootOrgId" column="ROOT_ORG_ID"/>
    </resultMap>
</mapper>