<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--created by Augurit    2020-01-15 09:37:39 -->
<!--0 一些前置信息配置 -->
<mapper namespace="com.augurit.aplanmis.common.mapper.AeaHiItemFillMapper" >
<!--1 返回所有字段的SQL字句 -->
<sql id="allColumns" >
    FILL_ID  fillId,
    ITEMINST_ID  iteminstId,
    APPLYINST_ID  applyinstId,
    PROJ_INFO_ID  projInfoId,
    FILL_DESC  fillDesc,
    FILL_MEMO  fillMemo,
    CHARGE_ORG_ID  chargeOrgId,
    CHARGE_ORG_NAME  chargeOrgName,
    OPS_USER_ID  opsUserId,
    OPS_USER_NAME  opsUserName,
    LAST_OPS_TIME  lastOpsTime,
    LAST_UPLOAD_TIME  lastUploadTime,
    LAST_TIPS_COUNT  lastTipsCount,
    FILL_END_TIME  fillEndTime,
    FILL_STATE  fillState,
    IS_DELETED  isDeleted,
    CREATER  creater,
    CREATE_TIME  createTime,
    MODIFIER  modifier,
    MODIFY_TIME  modifyTime,
    ROOT_ORG_ID  rootOrgId
    </sql>

    <sql id="aliasColumns" >
        ${alias}.FILL_ID  fillId,
        ${alias}.ITEMINST_ID  iteminstId,
        ${alias}.APPLYINST_ID  applyinstId,
        ${alias}.PROJ_INFO_ID  projInfoId,
        ${alias}.FILL_DESC  fillDesc,
        ${alias}.FILL_MEMO  fillMemo,
        ${alias}.CHARGE_ORG_ID  chargeOrgId,
        ${alias}.CHARGE_ORG_NAME  chargeOrgName,
        ${alias}.OPS_USER_ID  opsUserId,
        ${alias}.OPS_USER_NAME  opsUserName,
        ${alias}.LAST_OPS_TIME  lastOpsTime,
        ${alias}.LAST_UPLOAD_TIME  lastUploadTime,
        ${alias}.LAST_TIPS_COUNT  lastTipsCount,
        ${alias}.FILL_END_TIME  fillEndTime,
        ${alias}.FILL_STATE  fillState,
        ${alias}.IS_DELETED  isDeleted,
        ${alias}.CREATER  creater,
        ${alias}.CREATE_TIME  createTime,
        ${alias}.MODIFIER  modifier,
        ${alias}.MODIFY_TIME  modifyTime,
        ${alias}.ROOT_ORG_ID  rootOrgId
    </sql>

<!--2 根据主键ID查询单个实体 -->
<select id="getAeaHiItemFillById" resultType="AeaHiItemFill" >
    select
    <include refid="allColumns"/>
    from    AEA_HI_ITEM_FILL
    where    FILL_ID = #{id}
    AND  IS_DELETED = '0'
</select>

    <select id="getAeaHiItemFillDetail" resultType="AeaHiItemFill" >
      SELECT
        <include refid="aliasColumns">
            <property name="alias" value="fill"/>
        </include>,
        tt.APPLICANT unitName,
        tt.UNIT_INFO_ID unitInfoId,
        tt.APPLYINST_CODE applyinstCode,
        api.PROJ_NAME projName,api.LOCAL_CODE localCode,
        ahi.ITEMINST_NAME itemName
        FROM aea_hi_item_fill fill
        LEFT JOIN (
            SELECT aui.UNIT_INFO_ID,aui.APPLICANT,aha.APPLYINST_ID,aha.APPLYINST_CODE
            FROM aea_hi_applyinst aha,aea_applyinst_unit_proj aaup,aea_unit_proj aup,aea_unit_info aui
            WHERE aha.APPLYINST_ID = aaup.APPLYINST_ID
            AND aaup.UNIT_PROJ_ID = aup.UNIT_PROJ_ID
            AND aup.UNIT_INFO_ID = aui.UNIT_INFO_ID
            AND aup.IS_OWNER = '1'
            GROUP BY aha.APPLYINST_ID
        ) tt ON tt.APPLYINST_ID = fill.APPLYINST_ID
        LEFT JOIN aea_proj_info api ON api.PROJ_INFO_ID = fill.PROJ_INFO_ID
        LEFT JOIN aea_hi_iteminst ahi ON ahi.ITEMINST_ID = fill.ITEMINST_ID
        WHERE fill.FILL_ID = #{fillId}
        AND fill.IS_DELETED = '0'
    </select>

<!--3 根据条件查询实体list -->
    <select id="listAeaHiItemFill" resultType="AeaHiItemFill" >
        select
        <include refid="allColumns"/>
        from    AEA_HI_ITEM_FILL
    <where>
        <if test="fillId != null and fillId != ''" >
        and    FILL_ID = #{fillId}
        </if>
        <if test="iteminstId != null and iteminstId != ''" >
        and    ITEMINST_ID = #{iteminstId}
        </if>
        <if test="applyinstId != null and applyinstId != ''" >
        and    APPLYINST_ID = #{applyinstId}
        </if>
        <if test="projInfoId != null and projInfoId != ''" >
        and    PROJ_INFO_ID = #{projInfoId}
        </if>
        <if test="fillDesc != null and fillDesc != ''" >
        and    FILL_DESC = #{fillDesc}
        </if>
        <if test="fillMemo != null and fillMemo != ''" >
        and    FILL_MEMO = #{fillMemo}
        </if>
        <if test="chargeOrgId != null and chargeOrgId != ''" >
        and    CHARGE_ORG_ID = #{chargeOrgId}
        </if>
        <if test="chargeOrgName != null and chargeOrgName != ''" >
        and    CHARGE_ORG_NAME = #{chargeOrgName}
        </if>
        <if test="opsUserId != null and opsUserId != ''" >
        and    OPS_USER_ID = #{opsUserId}
        </if>
        <if test="opsUserName != null and opsUserName != ''" >
        and    OPS_USER_NAME = #{opsUserName}
        </if>
        <if test="lastOpsTime != null" >
        and    LAST_OPS_TIME = #{lastOpsTime}
        </if>
        <if test="lastUploadTime != null" >
        and    LAST_UPLOAD_TIME = #{lastUploadTime}
        </if>
        <if test="lastTipsCount != null and lastTipsCount != ''" >
        and    LAST_TIPS_COUNT = #{lastTipsCount}
        </if>
        <if test="fillEndTime != null" >
        and    FILL_END_TIME = #{fillEndTime}
        </if>
        <if test="fillState != null and fillState != ''" >
        and    FILL_STATE = #{fillState}
        </if>
        <if test="isDeleted != null and isDeleted != ''" >
        and    IS_DELETED = #{isDeleted}
        </if>
        <if test="creater != null and creater != ''" >
        and    CREATER = #{creater}
        </if>
        <if test="createTime != null" >
        and    CREATE_TIME = #{createTime}
        </if>
        <if test="modifier != null and modifier != ''" >
        and    MODIFIER = #{modifier}
        </if>
        <if test="modifyTime != null" >
        and    MODIFY_TIME = #{modifyTime}
        </if>
        <if test="rootOrgId != null and rootOrgId != ''" >
        and    ROOT_ORG_ID = #{rootOrgId}
        </if>
      and  IS_DELETED = '0'
    </where>
    </select>
<!--4 根据条件查询实体list,返回分页对象 -->
    <select id="listAeaHiItemFillsByCondition" resultType="AeaHiItemFill" >
        SELECT
        <include refid="aliasColumns">
            <property name="alias" value="fill"/>
        </include>,
        aha.APPLYINST_CODE applyinstCode,
        aha.APPLYINST_SOURCE applyinstSource,
        aha.IS_SERIES_APPROVE isSeriesApprove,
        aha.CREATE_TIME applyTime,
        api.PROJ_NAME projName,
        api.LOCAL_CODE localCode,
        ahi.ITEMINST_NAME itemName,
        stage.STAGE_NAME stageName,
        stage.DYBZSPJDXH dybzspjdxh
        FROM aea_hi_item_fill fill
        LEFT JOIN aea_hi_applyinst aha ON aha.APPLYINST_ID = fill.APPLYINST_ID
        LEFT JOIN aea_proj_info api ON api.PROJ_INFO_ID = fill.PROJ_INFO_ID
        LEFT JOIN aea_hi_iteminst ahi ON ahi.ITEMINST_ID = fill.ITEMINST_ID
        LEFT JOIN (
            SELECT ahps.APPLYINST_ID,aps.STAGE_NAME,aps.DYBZSPJDXH
            FROM aea_hi_par_stageinst ahps,aea_par_stage aps
            WHERE aps.STAGE_ID = ahps.STAGE_ID
        ) stage ON stage.APPLYINST_ID = fill.APPLYINST_ID
        <where>
            <if test="keyword != null and keyword != ''">
                and (
                api.LOCAL_CODE LIKE CONCAT(CONCAT('%',#{keyword}),'%') OR
                api.PROJ_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%') OR
                ahi.ITEMINST_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%') OR
                stage.STAGE_NAME LIKE CONCAT(CONCAT('%',#{keyword}),'%') OR
                aha.APPLYINST_CODE = #{keyword}
                )
            </if>
            <if test="orgIds != null and orgIds.length > 0" >
                and    fill.CHARGE_ORG_ID in
                <foreach collection="orgIds" close=")" open="(" separator="," item="orgId">
                    #{orgId}
                </foreach>
            </if>
            <if test="applyinstSource != null and applyinstSource != ''" >
                and    aha.APPLYINST_SOURCE = #{applyinstSource}
            </if>
            <if test="isSeriesApprove != null and isSeriesApprove != ''" >
                and    aha.IS_SERIES_APPROVE = #{isSeriesApprove}
            </if>
            <if test="fillId != null and fillId != ''" >
                and    fill.FILL_ID = #{fillId}
            </if>
            <if test="iteminstId != null and iteminstId != ''" >
                and    fill.ITEMINST_ID = #{iteminstId}
            </if>
            <if test="applyinstId != null and applyinstId != ''" >
                and    fill.APPLYINST_ID = #{applyinstId}
            </if>
            <if test="projInfoId != null and projInfoId != ''" >
                and    fill.PROJ_INFO_ID = #{projInfoId}
            </if>
            <if test="fillDesc != null and fillDesc != ''" >
                and    fill.FILL_DESC = #{fillDesc}
            </if>
            <if test="fillMemo != null and fillMemo != ''" >
                and    fill.FILL_MEMO = #{fillMemo}
            </if>
            <if test="chargeOrgId != null and chargeOrgId != ''" >
                and    fill.CHARGE_ORG_ID = #{chargeOrgId}
            </if>
            <if test="chargeOrgName != null and chargeOrgName != ''" >
                and    fill.CHARGE_ORG_NAME = #{chargeOrgName}
            </if>
            <if test="opsUserId != null and opsUserId != ''" >
                and    fill.OPS_USER_ID = #{opsUserId}
            </if>
            <if test="opsUserName != null and opsUserName != ''" >
                and    fill.OPS_USER_NAME = #{opsUserName}
            </if>
            <if test="lastOpsTime != null" >
                and    fill.LAST_OPS_TIME = #{lastOpsTime}
            </if>
            <if test="lastUploadTime != null" >
                and    fill.LAST_UPLOAD_TIME = #{lastUploadTime}
            </if>
            <if test="lastTipsCount != null and lastTipsCount != ''" >
                and    fill.LAST_TIPS_COUNT = #{lastTipsCount}
            </if>
            <if test="fillEndTime != null" >
                and    fill.FILL_END_TIME = #{fillEndTime}
            </if>
            <if test="fillState != null and fillState != ''" >
                and    fill.FILL_STATE = #{fillState}
            </if>
            <if test="creater != null and creater != ''" >
                and    fill.CREATER = #{creater}
            </if>
            <if test="createTime != null" >
                and    fill.CREATE_TIME = #{createTime}
            </if>
            <if test="modifier != null and modifier != ''" >
                and    fill.MODIFIER = #{modifier}
            </if>
            <if test="modifyTime != null" >
                and    fill.MODIFY_TIME = #{modifyTime}
            </if>
            <if test="rootOrgId != null and rootOrgId != ''" >
                and    fill.ROOT_ORG_ID = #{rootOrgId}
            </if>
            and  fill.IS_DELETED = '0'
        </where>
    </select>
<!--5 新增实体对象 -->
<insert id="insertAeaHiItemFill" parameterType="AeaHiItemFill" >
    insert into AEA_HI_ITEM_FILL (
FILL_ID  ,ITEMINST_ID  ,APPLYINST_ID  ,PROJ_INFO_ID  ,FILL_DESC  ,FILL_MEMO  ,CHARGE_ORG_ID  ,CHARGE_ORG_NAME  ,OPS_USER_ID  ,OPS_USER_NAME  ,LAST_OPS_TIME  ,LAST_UPLOAD_TIME  ,LAST_TIPS_COUNT  ,FILL_END_TIME  ,FILL_STATE  ,IS_DELETED  ,CREATER  ,CREATE_TIME  ,MODIFIER  ,MODIFY_TIME  ,ROOT_ORG_ID  
    )  values  (
#{fillId},#{iteminstId},#{applyinstId},#{projInfoId},#{fillDesc},#{fillMemo},#{chargeOrgId},#{chargeOrgName},#{opsUserId},#{opsUserName},#{lastOpsTime},#{lastUploadTime},#{lastTipsCount},#{fillEndTime},#{fillState},#{isDeleted},#{creater},#{createTime},#{modifier},#{modifyTime},  #{rootOrgId}
    )
</insert>
<!--6 修改实体对象 -->
<update id="updateAeaHiItemFill" parameterType="AeaHiItemFill" >
    update AEA_HI_ITEM_FILL
    <set >
        <if test="fillId != null and fillId != '' " >
        FILL_ID = #{fillId},
        </if>
        <if test="iteminstId != null and iteminstId != '' " >
        ITEMINST_ID = #{iteminstId},
        </if>
        <if test="applyinstId != null and applyinstId != '' " >
        APPLYINST_ID = #{applyinstId},
        </if>
        <if test="projInfoId != null and projInfoId != '' " >
        PROJ_INFO_ID = #{projInfoId},
        </if>
        <if test="fillDesc != null and fillDesc != '' " >
        FILL_DESC = #{fillDesc},
        </if>
        <if test="fillMemo != null and fillMemo != '' " >
        FILL_MEMO = #{fillMemo},
        </if>
        <if test="chargeOrgId != null and chargeOrgId != '' " >
        CHARGE_ORG_ID = #{chargeOrgId},
        </if>
        <if test="chargeOrgName != null and chargeOrgName != '' " >
        CHARGE_ORG_NAME = #{chargeOrgName},
        </if>
        <if test="opsUserId != null and opsUserId != '' " >
        OPS_USER_ID = #{opsUserId},
        </if>
        <if test="opsUserName != null and opsUserName != '' " >
        OPS_USER_NAME = #{opsUserName},
        </if>
        <if test="lastOpsTime != null" >
        LAST_OPS_TIME = #{lastOpsTime},
        </if>
        <if test="lastUploadTime != null" >
        LAST_UPLOAD_TIME = #{lastUploadTime},
        </if>
        <if test="lastTipsCount != null and lastTipsCount != '' " >
        LAST_TIPS_COUNT = #{lastTipsCount},
        </if>
        <if test="fillEndTime != null" >
        FILL_END_TIME = #{fillEndTime},
        </if>
        <if test="fillState != null and fillState != '' " >
        FILL_STATE = #{fillState},
        </if>
        <if test="isDeleted != null and isDeleted != '' " >
        IS_DELETED = #{isDeleted},
        </if>
        <if test="creater != null and creater != '' " >
        CREATER = #{creater},
        </if>
        <if test="createTime != null" >
        CREATE_TIME = #{createTime},
        </if>
        <if test="modifier != null and modifier != '' " >
        MODIFIER = #{modifier},
        </if>
        <if test="modifyTime != null" >
        MODIFY_TIME = #{modifyTime},
        </if>
        <if test="rootOrgId != null and rootOrgId != '' " >
        ROOT_ORG_ID = #{rootOrgId},
        </if>
    </set>
    where FILL_ID = #{fillId}
</update>
<!--7 删除实体对象,根据主键ID -->
    <update id="deleteAeaHiItemFill"  >
        update AEA_HI_ITEM_FILL
    <set >
        IS_DELETED = '1'
    </set>
        where FILL_ID = #{id}
    </update>
<!--8 删除实体对象列表,根据主键ID列表 -->
<!--9 返回所有字段的对象map,用于级联 -->
    <resultMap type="AeaHiItemFill" id="AeaHiItemFillMap">
        <id property="fillId" column="FILL_ID"/>
        <result property="iteminstId" column="ITEMINST_ID"/>
        <result property="applyinstId" column="APPLYINST_ID"/>
        <result property="projInfoId" column="PROJ_INFO_ID"/>
        <result property="fillDesc" column="FILL_DESC"/>
        <result property="fillMemo" column="FILL_MEMO"/>
        <result property="chargeOrgId" column="CHARGE_ORG_ID"/>
        <result property="chargeOrgName" column="CHARGE_ORG_NAME"/>
        <result property="opsUserId" column="OPS_USER_ID"/>
        <result property="opsUserName" column="OPS_USER_NAME"/>
        <result property="lastOpsTime" column="LAST_OPS_TIME"/>
        <result property="lastUploadTime" column="LAST_UPLOAD_TIME"/>
        <result property="lastTipsCount" column="LAST_TIPS_COUNT"/>
        <result property="fillEndTime" column="FILL_END_TIME"/>
        <result property="fillState" column="FILL_STATE"/>
        <result property="isDeleted" column="IS_DELETED"/>
        <result property="creater" column="CREATER"/>
        <result property="createTime" column="CREATE_TIME"/>
        <result property="modifier" column="MODIFIER"/>
        <result property="modifyTime" column="MODIFY_TIME"/>
        <result property="rootOrgId" column="ROOT_ORG_ID"/>
    </resultMap>
</mapper>