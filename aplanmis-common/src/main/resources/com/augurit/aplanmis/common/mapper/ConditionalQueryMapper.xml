<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--0 一些前置信息配置 -->
<mapper namespace="com.augurit.aplanmis.common.mapper.ConditionalQueryMapper">

    <sql id="leftJoinApplyinstProj">
        LEFT JOIN (
              SELECT
                  ap.APPLYINST_ID AS APPLYINST_ID,
                  <if test="_databaseId == 'oracle'">
                      listagg(to_char(p.PROJ_NAME),',')within group(order by p.PROJ_INFO_ID) AS PROJ_NAME,
                      listagg(to_char(p.LOCAL_CODE),',')within group(order by p.PROJ_INFO_ID) AS LOCAL_CODE,
                      listagg(to_char(p.GCBM),',')within group(order by p.PROJ_INFO_ID) AS GCBM
                  </if>
                  <if test="_databaseId == 'mysql'">
                      GROUP_CONCAT(p.PROJ_NAME SEPARATOR ',') AS PROJ_NAME,
                      GROUP_CONCAT(p.LOCAL_CODE SEPARATOR ',') AS LOCAL_CODE,
                      GROUP_CONCAT(p.GCBM SEPARATOR ',') AS GCBM
                  </if>
              FROM
                  aea_applyinst_proj ap
              LEFT JOIN aea_proj_info p ON ap.PROJ_INFO_ID = p.PROJ_INFO_ID
              GROUP BY ap.APPLYINST_ID
        ) temp1 ON temp1.APPLYINST_ID = ahap_123.APPLYINST_ID
    </sql>

    <sql id="baseConditionalQuery">
        <if test="theme != null and theme != '' ">
            AND ahap_123.IS_SERIES_APPROVE != '1'
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
            <if test="arriveStartTime != null and arriveStartTime != '' ">
                <![CDATA[ AND to_char(art_123.CREATE_TIME_ , 'yyyy-mm-dd')>=  #{arriveStartTime}   ]]>
            </if>
            <if test="arriveEndTime != null and arriveEndTime != '' ">
                <![CDATA[ AND to_char(art_123.CREATE_TIME_ , 'yyyy-mm-dd')<=  #{arriveEndTime}   ]]>
            </if>
            <if test="acceptStartTime != null and acceptStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.ACCEPT_TIME , 'yyyy-mm-dd')>=  #{acceptStartTime}   ]]>
            </if>
            <if test="acceptEndTime != null and acceptEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.ACCEPT_TIME , 'yyyy-mm-dd')<=  #{acceptEndTime}   ]]>
            </if>
            <if test="processStartTime != null and processStartTime != '' ">
                <![CDATA[ AND to_char(aht_123.END_TIME_ , 'yyyy-mm-dd')>=  #{processStartTime}   ]]>
            </if>
            <if test="processEndTime != null and processEndTime != '' ">
                <![CDATA[ AND to_char(aht_123.END_TIME_ , 'yyyy-mm-dd')<=  #{processEndTime}   ]]>
            </if>
            <if test="concludedStartTime != null and concludedStartTime != '' ">
                <![CDATA[ AND to_char(hist.TRIGGER_TIME , 'yyyy-mm-dd')>=  #{concludedStartTime}   ]]>
            </if>
            <if test="concludedEndTime != null and concludedEndTime != '' ">
                <![CDATA[ AND to_char(hist.TRIGGER_TIME , 'yyyy-mm-dd')<=  #{concludedEndTime}   ]]>
            </if>

        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
            <if test="arriveStartTime != null and arriveStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(art_123.CREATE_TIME_ , '%Y-%m-%d')>=  #{arriveStartTime}   ]]>
            </if>
            <if test="arriveEndTime != null and arriveEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(art_123.CREATE_TIME_ , '%Y-%m-%d')<=  #{arriveEndTime}   ]]>
            </if>
            <if test="acceptStartTime != null and acceptStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.ACCEPT_TIME , '%Y-%m-%d')>=  #{acceptStartTime}   ]]>
            </if>
            <if test="acceptEndTime != null and acceptEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.ACCEPT_TIME , '%Y-%m-%d')<=  #{acceptEndTime}   ]]>
            </if>
            <if test="processStartTime != null and processStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(aht_123.END_TIME_ , '%Y-%m-%d')>=  #{processStartTime}   ]]>
            </if>
            <if test="processEndTime != null and processEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(aht_123.END_TIME_ , '%Y-%m-%d')<=  #{processEndTime}   ]]>
            </if>
            <if test="concludedStartTime != null and concludedStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(hist.TRIGGER_TIME , '%Y-%m-%d')>=  #{concludedStartTime}   ]]>
            </if>
            <if test="concludedEndTime != null and concludedEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(hist.TRIGGER_TIME , '%Y-%m-%d')<=  #{concludedEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="applyType != null and applyType != '' ">
            AND ahap_123.IS_SERIES_APPROVE = #{applyType}
        </if>
        <if test="instState != null and instState != '' ">
            AND ti.INST_STATE = #{instState}
        </if>
    </sql>

    <select id="listApplyinfo" resultType="com.augurit.aplanmis.common.vo.conditional.ApplyInfo">
        SELECT
        *
        FROM
        (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_STATE AS applyState,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项'
        ELSE
        '并联'
        END AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahap_123.CREATE_TIME AS applyTime,
        tinst.OVERDUE_TIME AS overdueTime,
        tinst.REMAINING_TIME AS remainingTime,
        tinst.INST_STATE AS instState,
        tinst.TIMERULE_UNIT AS timeruleUnit,
        tinst.IS_CONCLUDING AS isConcluding,
        tinst.USE_LIMIT_TIME AS useLimitTime,
        aps_123.DUE_NUM AS dueNum,
        NULL AS itemName,
        tinst.PROC_INST_ID AS procInstId
        FROM
        aea_hi_applyinst ahap_123
        <if test="entrust or handler">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="entrust">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
                <if test="handler">
                    AND alog.OPS_USER_ID = #{userId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        INNER JOIN (
        SELECT
        ap.APPLYINST_ID AS APPLYINST_ID,
        <if test="_databaseId == 'oracle'">
            listagg(to_char(p.PROJ_NAME),',')within group(order by p.PROJ_INFO_ID) AS PROJ_NAME,
            listagg(to_char(p.LOCAL_CODE),',')within group(order by p.PROJ_INFO_ID) AS LOCAL_CODE,
            listagg(to_char(p.GCBM),',')within group(order by p.PROJ_INFO_ID) AS GCBM
        </if>

        <if test="_databaseId == 'mysql'">
            GROUP_CONCAT(p.PROJ_NAME SEPARATOR ',') AS PROJ_NAME,
            GROUP_CONCAT(p.LOCAL_CODE SEPARATOR ',') AS LOCAL_CODE,
            GROUP_CONCAT(p.GCBM SEPARATOR ',') AS GCBM
        </if>
        FROM
        aea_applyinst_proj ap
        LEFT JOIN aea_proj_info p ON ap.PROJ_INFO_ID = p.PROJ_INFO_ID
        <where>
            <if test="region != null and region != '' ">
                AND p.REGIONALISM = #{region}
            </if>
            <if test="projType != null and projType != '' ">
                AND p.PROJ_TYPE = #{projType}
            </if>
            <if test="investCategory != null and investCategory != '' ">
                AND p.INVEST_TYPE = #{investCategory}
            </if>
            <if test="industries != null and industries.length > 0">
                AND p.INDUSTRY IN
                <foreach collection="industries" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="buildNature != null and buildNature != '' ">
                AND p.PROJ_NATURE = #{buildNature}
            </if>
            <if test="projLevel != null and projLevel != '' ">
                AND p.PROJ_LEVEL = #{projLevel}
            </if>
        </where>
        GROUP BY ap.APPLYINST_ID
        ) temp1 ON temp1.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst asp ON asp.APPINST_ID = ahs_123.APPINST_ID AND ahs_123.ROOT_ORG_ID = #{currentOrgId} AND asp.ROOT_ORG_ID = #{currentOrgId}
        LEFT JOIN act_sto_timerule_inst tinst ON tinst.APP_FLOWDEF_ID = asp.APP_FLOWDEF_ID AND tinst.PROC_INST_ID = asp.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
        WHERE
        ahap_123.IS_SERIES_APPROVE = '0'
        <if test="isConcluding != null and isConcluding != ''">
            AND tinst.IS_CONCLUDING = #{isConcluding}
        </if>
        <if test="theme != null and theme != '' ">
            AND theme.THEME_ID = #{theme}
        </if>
        <if test="approvalStage != null and approvalStage != '' ">
            AND aps_123.STAGE_ID = #{approvalStage}
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="applyType != null and applyType != '' ">
            AND ahap_123.IS_SERIES_APPROVE = #{applyType}
        </if>
        <if test="applyState != null and applyState != '' ">
            AND ahap_123.APPLYINST_STATE = #{applyState}
        </if>
        <if test="instState != null and instState != '' ">
            AND tinst.INST_STATE = #{instState}
        </if>

        <if test="approvalStage == null or approvalStage == '' ">
            UNION
            SELECT
            ahap_123.APPLYINST_ID AS applyinstId,
            ahap_123.APPLYINST_STATE AS applyState,
            ahap_123.APPLYINST_CODE AS applyinstCode,
            temp1.PROJ_NAME AS projName,
            temp1.LOCAL_CODE AS localCode,
            temp1.GCBM AS gcbm,
            ahap_123.APPLYINST_SOURCE AS applySource,
--             ali_123.LINKMAN_NAME AS linkmanName,
            CASE ahap_123.IS_SERIES_APPROVE
            WHEN '1' THEN
            '单项'
            ELSE
            '并联'
            END AS applyType,
            NULL AS themeName,
            NULL AS stageName,
            ahap_123.CREATE_TIME AS applyTime,
            tinst.OVERDUE_TIME AS overdueTime,
            tinst.REMAINING_TIME AS remainingTime,
            tinst.INST_STATE AS instState,
            tinst.TIMERULE_UNIT AS timeruleUnit,
            tinst.IS_CONCLUDING AS isConcluding,
            tinst.USE_LIMIT_TIME AS useLimitTime,
            ai_123.DUE_NUM AS dueNum,
            ahi_123.ITEMINST_NAME AS itemName,
            tinst.PROC_INST_ID AS procInstId
            FROM
            aea_hi_applyinst ahap_123
            <if test=" handler or entrust">
                INNER JOIN (
                SELECT
                DISTINCT alog.APPLYINST_ID
                FROM aea_log_apply_state_hist alog
                <where>
                    <if test="entrust">
                        AND alog.OPS_WINDOW_ID = #{windowId}
                    </if>
                    <if test="handler">
                        AND alog.OPS_USER_ID = #{userId}
                    </if>
                </where>

                )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
            </if>
            INNER JOIN (
            SELECT
            ap.APPLYINST_ID AS APPLYINST_ID,
            <if test="_databaseId == 'oracle'">
                listagg(to_char(p.PROJ_NAME),',')within group(order by p.PROJ_INFO_ID) AS PROJ_NAME,
                listagg(to_char(p.LOCAL_CODE),',')within group(order by p.PROJ_INFO_ID) AS LOCAL_CODE,
                listagg(to_char(p.GCBM),',')within group(order by p.PROJ_INFO_ID) AS GCBM
            </if>

            <if test="_databaseId == 'mysql'">
                GROUP_CONCAT(p.PROJ_NAME SEPARATOR ',') AS PROJ_NAME,
                GROUP_CONCAT(p.LOCAL_CODE SEPARATOR ',') AS LOCAL_CODE,
                GROUP_CONCAT(p.GCBM SEPARATOR ',') AS GCBM
            </if>
            FROM
            aea_applyinst_proj ap
            LEFT JOIN aea_proj_info p ON ap.PROJ_INFO_ID = p.PROJ_INFO_ID
            <where>
                <if test="region != null and region != '' ">
                    AND p.REGIONALISM = #{region}
                </if>
                <if test="projType != null and projType != '' ">
                    AND p.PROJ_TYPE = #{projType}
                </if>
                <if test="investCategory != null and investCategory != '' ">
                    AND p.INVEST_TYPE = #{investCategory}
                </if>
                <if test="industries != null and industries.length > 0">
                    AND p.INDUSTRY IN
                    <foreach collection="industries" item="item" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="buildNature != null and buildNature != '' ">
                    AND p.PROJ_NATURE = #{buildNature}
                </if>
                <if test="projLevel != null and projLevel != '' ">
                    AND p.PROJ_LEVEL = #{projLevel}
                </if>
            </where>
            GROUP BY ap.APPLYINST_ID
            ) temp1 ON temp1.APPLYINST_ID = ahap_123.APPLYINST_ID
--             LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
            LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
            LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
            LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID =
            ai_123.ITEM_VER_ID
            LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
            WHERE
            ahap_123.IS_SERIES_APPROVE = '1'
            <if test="isConcluding != null and isConcluding != ''">
                AND tinst.IS_CONCLUDING = #{isConcluding}
            </if>
            <if test="_databaseId == 'oracle'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
                </if>
            </if>

            <if test="applySource != null and applySource != '' ">
                AND ahap_123.APPLYINST_SOURCE = #{applySource}
            </if>
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
            <if test="applyState != null and applyState != '' ">
                AND ahap_123.APPLYINST_STATE = #{applyState}
            </if>
            <if test="instState != null and instState != '' ">
                AND tinst.INST_STATE = #{instState}
            </if>
            <if test="theme != null and theme != '' ">
                AND ahap_123.IS_SERIES_APPROVE != '1'
            </if>

        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listPartsInfo" resultType="com.augurit.aplanmis.common.vo.conditional.PartsInfo">

        SELECT
        *
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahi_123.ITEMINST_STATE AS iteminstState,
        ahap_123.APPLYINST_SOURCE AS applySource,
        tinst.OVERDUE_TIME AS overdueTime,
        tinst.REMAINING_TIME AS remainingTime,
        tinst.INST_STATE AS instState,
        tinst.TIMERULE_UNIT AS timeruleUnit,
        tinst.IS_CONCLUDING AS isConcluding,
        tinst.USE_LIMIT_TIME AS useLimitTime,
        ai_123.DUE_NUM AS dueNum,
        tinst.PROC_INST_ID AS procInstId
        FROM AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        <if test="handler">

            INNER JOIN (
            SELECT
            DISTINCT tmp1.ITEMINST_ID
            FROM (
            SELECT
            ahi_123.ITEMINST_ID
            FROM
            AEA_HI_ITEMINST ahi_123
            LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
            LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
            LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
            LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = app.PROCINST_ID
            WHERE
            ahi_123.IS_SERIES_APPROVE = '0'
            AND t.ASSIGNEE_ = #{loginName}
            UNION
            SELECT
            ahi_123.ITEMINST_ID
            FROM
            AEA_HI_ITEMINST ahi_123
            LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
            LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
            LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
            LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
            LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = apps.SUBFLOW_PROCINST_ID
            WHERE
            ahi_123.IS_SERIES_APPROVE = '0'
            AND t.ASSIGNEE_ = #{loginName}
            ) tmp1

            ) task ON task.ITEMINST_ID = ahi_123.ITEMINST_ID

        </if>
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
        WHERE ahi_123.IS_SERIES_APPROVE = '0'
        <if test="isConcluding != null and isConcluding != ''">
            AND tinst.IS_CONCLUDING = #{isConcluding}
        </if>


        <if test="entrust">
            AND (
            <foreach collection="currentUserOrgIdList" item="item" index="index" open=" " separator=" " close=" ">

                <if test="index == 0">
                    (
                        ahi_123.APPROVE_ORG_ID = #{item}
                        OR
                        ahi_123.APPROVE_ORG_ID IN (
                            select t.PARENT_ORG_ID AS ORG_ID from
                            (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                            find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                            from opu_om_org,(select @id:=#{item}) vars
                            where @id is not null
                            )t where t.PARENT_ORG_ID is not null
                        )
                    )
                </if>
                <if test="index != 0">
                    OR (
                        ahi_123.APPROVE_ORG_ID = #{item}
                        OR
                        ahi_123.APPROVE_ORG_ID IN (
                            select t.PARENT_ORG_ID AS ORG_ID from
                            (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                            find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                            from opu_om_org,(select @id:=#{item}) vars
                            where @id is not null
                            )t where t.PARENT_ORG_ID is not null
                        )
                    )
                </if>

            </foreach>
            )
        </if>

        <if test="theme != null and theme != '' ">
            AND theme.THEME_ID = #{theme}
        </if>
        <if test="approvalStage != null and approvalStage != '' ">
            AND aps_123.STAGE_ID = #{approvalStage}
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="applyType != null and applyType != '' ">
            AND ahap_123.IS_SERIES_APPROVE = #{applyType}
        </if>
        <if test="iteminstState != null and iteminstState != '' ">
            AND ahi_123.ITEMINST_STATE = #{iteminstState}
        </if>
        <if test="instState != null and instState != '' ">
            AND tinst.INST_STATE = #{instState}
        </if>
        <if test="approvalStage == null or approvalStage == '' ">
            UNION
            SELECT
            ahi_123.ITEMINST_ID AS iteminstId,
            ahap_123.APPLYINST_CODE AS applyinstCode,
            temp1.PROJ_NAME AS projName,
            temp1.LOCAL_CODE AS localCode,
            temp1.GCBM AS gcbm,
--             ali_123.LINKMAN_NAME AS linkmanName,
            '单项' AS applyType,
            NULL AS themeName,
            NULL AS stageName,
            ahi_123.ITEMINST_NAME AS itemName,
            ahap_123.CREATE_TIME AS applyTime,
            ahi_123.ITEMINST_STATE AS iteminstState,
            ahap_123.APPLYINST_SOURCE AS applySource,
            tinst.OVERDUE_TIME AS overdueTime,
            tinst.REMAINING_TIME AS remainingTime,
            tinst.INST_STATE AS instState,
            tinst.TIMERULE_UNIT AS timeruleUnit,
            tinst.IS_CONCLUDING AS isConcluding,
            tinst.USE_LIMIT_TIME AS useLimitTime,
            ai_123.DUE_NUM AS dueNum,
            tinst.PROC_INST_ID AS procInstId
            FROM AEA_HI_ITEMINST ahi_123
            LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID =
            ai_123.ITEM_VER_ID
            <if test="handler">

                INNER JOIN (
                SELECT
                DISTINCT tmp1.ITEMINST_ID
                FROM (
                SELECT
                ahi_123.ITEMINST_ID
                FROM
                AEA_HI_ITEMINST ahi_123
                LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
                LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
                LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
                LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = app.PROCINST_ID
                WHERE
                ahi_123.IS_SERIES_APPROVE = '1'
                AND t.ASSIGNEE_ = #{loginName}
                UNION
                SELECT
                ahi_123.ITEMINST_ID
                FROM
                AEA_HI_ITEMINST ahi_123
                LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
                LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
                LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
                LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
                LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = apps.SUBFLOW_PROCINST_ID
                WHERE
                ahi_123.IS_SERIES_APPROVE = '1'
                AND t.ASSIGNEE_ = #{loginName}

                ) tmp1

                ) task ON task.ITEMINST_ID = ahi_123.ITEMINST_ID

            </if>
            LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
            LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
            <include refid="leftJoinApplyinstProj">
            </include>
--             LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
            LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
            WHERE ahi_123.IS_SERIES_APPROVE = '1'

            <if test="isConcluding != null and isConcluding != ''">
                AND tinst.IS_CONCLUDING = #{isConcluding}
            </if>

            <if test="entrust">
                AND (
                <foreach collection="currentUserOrgIdList" item="item" index="index" open=" " separator=" " close=" ">

                    <if test="index == 0">
                        (
                            ahi_123.APPROVE_ORG_ID = #{item}
                            OR
                            ahi_123.APPROVE_ORG_ID IN (
                                select t.PARENT_ORG_ID AS ORG_ID from
                                (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                                find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                                from opu_om_org,(select @id:=#{item}) vars
                                where @id is not null
                                )t where t.PARENT_ORG_ID is not null
                            )
                        )
                    </if>
                    <if test="index != 0">
                        OR (
                            ahi_123.APPROVE_ORG_ID = #{item}
                            OR
                            ahi_123.APPROVE_ORG_ID IN (
                                select t.PARENT_ORG_ID AS ORG_ID from
                                (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                                find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                                from opu_om_org,(select @id:=#{item}) vars
                                where @id is not null
                                )t where t.PARENT_ORG_ID is not null
                            )
                        )
                    </if>

                </foreach>
                )
            </if>

            <if test="_databaseId == 'oracle'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
                </if>
            </if>

            <if test="applySource != null and applySource != '' ">
                AND ahap_123.APPLYINST_SOURCE = #{applySource}
            </if>
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
            <if test="iteminstState != null and iteminstState != '' ">
                AND ahi_123.ITEMINST_STATE = #{iteminstState}
            </if>
            <if test="instState != null and instState != '' ">
                AND tinst.INST_STATE = #{instState}
            </if>
        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="queryApplyInfoTaskId" resultType="java.lang.String">
		SELECT
			ahti_123.ID_ AS TASK_ID
		FROM
			AEA_HI_APPLYINST ahap_123
		LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
		LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
		LEFT JOIN act_hi_taskinst ahti_123 ON ahti_123.PROC_INST_ID_ = ahp_123.ID_
		WHERE
			ahap_123.APPLYINST_ID = #{applyinstId}
        AND ahti_123.ID_ IS NOT NULL
		UNION
			SELECT
				ahti_123.ID_ TASK_ID
			FROM
				AEA_HI_APPLYINST ahap_123
			LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
			LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
			LEFT JOIN act_sto_appinst_subflow asas_123 ON asas_123.SUBFLOW_PROCINST_ID = ahp_123.PROC_INST_ID_
			LEFT JOIN act_hi_taskinst ahti_123 ON ahti_123.PROC_INST_ID_ = ahp_123.ID_
			WHERE
			    ahap_123.APPLYINST_ID = #{applyinstId}
			AND ahti_123.ID_ IS NOT NULL
    </select>

    <select id="queryItemInfoTaskId" resultType="java.lang.String">
        SELECT
        t.ID_ TASK_ID
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = app.PROCINST_ID
        WHERE
        ahi_123.IS_SERIES_APPROVE = '0'
        <if test="loginName != null and loginName != '' ">
            AND t.ASSIGNEE_ = #{loginName}
        </if>
        AND ahi_123.ITEMINST_ID = #{iteminstId}
        UNION
        SELECT
        t.ID_ TASK_ID
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = apps.SUBFLOW_PROCINST_ID
        WHERE
        ahi_123.IS_SERIES_APPROVE = '0'
        <if test="loginName != null and loginName != '' ">
            AND t.ASSIGNEE_ = #{loginName}
        </if>
        AND ahi_123.ITEMINST_ID = #{iteminstId}
        UNION
        SELECT
        t.ID_ TASK_ID
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = app.PROCINST_ID
        WHERE
        ahi_123.IS_SERIES_APPROVE = '1'
        <if test="loginName != null and loginName != '' ">
            AND t.ASSIGNEE_ = #{loginName}
        </if>
        AND ahi_123.ITEMINST_ID = #{iteminstId}
        UNION
        SELECT
        t.ID_ TASK_ID
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_hi_taskinst t on t.proc_inst_id_ = apps.SUBFLOW_PROCINST_ID
        WHERE
        ahi_123.IS_SERIES_APPROVE = '1'
        <if test="loginName != null and loginName != '' ">
            AND t.ASSIGNEE_ = #{loginName}
        </if>
        AND ahi_123.ITEMINST_ID = #{iteminstId}
    </select>

    <select id="queryViewId" resultType="java.lang.String">
        select
            VIEW_ID
        from
            act_sto_view
        where
            VIEW_COMMENT LIKE CONCAT(CONCAT('%', #{keyword}), '%')
    </select>

    <select id="listWaitDoTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        *
        FROM
        (
        SELECT
        ART_123.*
        FROM
        (
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        art_123.CREATE_TIME_ AS arriveTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        ahap_123.CREATE_TIME AS applyTime,
        art_123.NAME_ AS taskName,
        aps_123.DUE_NUM AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        NULL AS itemProperty,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        theme.THEME_NAME AS themeName,
        NULL AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        art_123.SIGN_STATE_ AS signState
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = AHP_123.PROC_INST_ID_
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
            AND art_123.ASSIGNEE_ = #{loginName}
            AND ahap_123.APPLYINST_STATE NOT IN ('0', '1', '3', '5', '6')
        </where>
        )
        UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        art_123.CREATE_TIME_ AS arriveTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        ahap_123.CREATE_TIME AS applyTime,
        art_123.NAME_ AS taskName,
        ai_123.DUE_NUM AS dueNum,
        '0' AS isSeriesApprove,
        hi.ITEMINST_ID AS busRecordId,
        NULL AS itemProperty,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        theme.THEME_NAME AS themeName,
        hi.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        art_123.SIGN_STATE_ AS signState
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN aea_hi_iteminst hi ON hi.PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON hi.ITEM_ID = ai_123.ITEM_ID AND hi.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = hi.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND hi.ITEMINST_STATE NOT IN (
            '1',
            '2',
            '4',
            '5',
            '6',
            '14',
            '15'
            )
            AND ahap_123.APPLYINST_STATE != '0'
            AND art_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        art_123.CREATE_TIME_ AS arriveTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        ahap_123.CREATE_TIME AS applyTime,
        art_123.NAME_ AS taskName,
        aps_123.DUE_NUM AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        NULL AS itemProperty,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        theme.THEME_NAME AS themeName,
        NULL AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        art_123.SIGN_STATE_ AS signState
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = AHP_123.PROC_INST_ID_
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE != '0'
            AND art_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        art_123.CREATE_TIME_ AS arriveTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        ahap_123.CREATE_TIME AS applyTime,
        art_123.NAME_ AS taskName,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        ai_123.ITEM_PROPERTY AS itemProperty,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        art_123.SIGN_STATE_ AS signState
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE NOT IN (
            '1',
            '2',
            '4',
            /*'5',*/
            '6',
            '14',
            '15'
            )
            AND ahap_123.APPLYINST_STATE != '0'
            AND art_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>

        </where>
        )
        UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        art_123.CREATE_TIME_ AS arriveTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        ahap_123.CREATE_TIME AS applyTime,
        art_123.NAME_ AS taskName,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        ai_123.ITEM_PROPERTY AS itemProperty,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        art_123.SIGN_STATE_ AS signState
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE NOT IN ('2', '4', /*'5',*/ '6', '14', '15')
            AND ahap_123.APPLYINST_STATE != '0'
            AND art_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        ) ART_123

        GROUP BY
        <if test="_databaseId == 'oracle'">
            ART_123.taskId,
            ART_123.applyinstId,
            ART_123.applyinstCode,
            ART_123.stageName,
--             ART_123.linkmanName,
            ART_123.applySource,
            ART_123.arriveTime,
            ART_123.acceptTime,
            ART_123.applyTime,
            ART_123.taskName,
            ART_123.dueNum,
            ART_123.isSeriesApprove,
            ART_123.busRecordId,
            ART_123.itemProperty,
            ART_123.applyType,
            ART_123.projName,
            ART_123.localCode,
            ART_123.gcbm,
            ART_123.themeName,
            ART_123.itemName,
            ART_123.overdueTime,
            ART_123.remainingTime,
            ART_123.instState,
            ART_123.timeruleUnit,
            ART_123.signState
        </if>
        <if test="_databaseId == 'mysql'">
            ART_123.taskId
        </if>

        )temp_123

        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listDoneTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        temp.*
        FROM
        (
        (
        SELECT
        aht_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        aht_123.END_TIME_ AS processTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        aht_123.NAME_ AS taskName,
        CASE when hi.ITEMINST_NAME IS NULL THEN aps_123.DUE_NUM else ai_123.DUE_NUM end AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        theme.THEME_NAME AS themeName,
        hi.ITEMINST_NAME AS itemName,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.OVERDUE_TIME else ti.OVERDUE_TIME end AS overdueTime,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.REMAINING_TIME else ti.REMAINING_TIME end AS remainingTime,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.INST_STATE else ti.INST_STATE end AS instState,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.TIMERULE_UNIT else ti.TIMERULE_UNIT end AS timeruleUnit,
        aht_123.TASK_DEF_KEY_ AS taskDefKey,
        ahp_123.ID_ procInstId
        FROM
        ACT_HI_TASKINST aht_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON aht_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_hi_varinst hv ON hv.PROC_INST_ID_ = ahp_123.PROC_INST_ID_
        AND hv.name_ = '$BUS_CURRENT_ITEMINST_ID'
        LEFT JOIN aea_hi_iteminst hi ON hi.iteminst_id = hv.text_
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON hi.ITEM_ID = ai_123.ITEM_ID AND hi.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = hi.PROCINST_ID
        LEFT JOIN act_sto_timerule_inst ati ON ati.PROC_INST_ID = AHP_123.PROC_INST_ID_
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND aht_123.ASSIGNEE_ = #{loginName}
            AND aht_123.END_TIME_ IS NOT NULL
            AND aht_123.DELETE_REASON_ IS NULL
            AND ahap_123.APPLYINST_STATE !='6'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        UNION
        (
        SELECT
        aht_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        aht_123.END_TIME_ AS processTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        aht_123.NAME_ AS taskName,
        CASE when hi.ITEMINST_NAME IS NULL THEN aps_123.DUE_NUM else ai_123.DUE_NUM end AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        theme.THEME_NAME AS themeName,
        hi.ITEMINST_NAME AS itemName,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.OVERDUE_TIME else ti.OVERDUE_TIME end AS overdueTime,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.REMAINING_TIME else ti.REMAINING_TIME end AS remainingTime,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.INST_STATE else ti.INST_STATE end AS instState,
        CASE when hi.ITEMINST_NAME IS NULL THEN ati.TIMERULE_UNIT else ti.TIMERULE_UNIT end AS timeruleUnit,
        aht_123.TASK_DEF_KEY_ AS taskDefKey,
        ahp_123.ID_ procInstId
        FROM
        ACT_HI_TASKINST aht_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON aht_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN act_sto_appinst_subflow asas_123 ON asas_123.SUBFLOW_PROCINST_ID = ahp_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.APPINST_ID = asas_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_hi_varinst hv ON hv.PROC_INST_ID_ = ahp_123.PROC_INST_ID_
        AND hv.name_ = '$BUS_CURRENT_ITEMINST_ID'
        LEFT JOIN aea_hi_iteminst hi ON hi.iteminst_id = hv.text_
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON hi.ITEM_ID = ai_123.ITEM_ID AND hi.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = hi.PROCINST_ID
        LEFT JOIN act_sto_timerule_inst ati ON ati.PROC_INST_ID = AHP_123.PROC_INST_ID_

        <where>

            ahap_123.IS_SERIES_APPROVE = '0'
            AND aht_123.ASSIGNEE_ = #{loginName}
            AND aht_123.END_TIME_ IS NOT NULL
            AND aht_123.DELETE_REASON_ IS NULL
            AND ahap_123.APPLYINST_STATE !='6'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        UNION
        (
        SELECT
        aht_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        aht_123.END_TIME_ AS processTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        aht_123.NAME_ As taskName,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        aht_123.TASK_DEF_KEY_ AS taskDefKey,
        ahp_123.ID_ procInstId
        FROM
        ACT_HI_TASKINST aht_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON aht_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND aht_123.ASSIGNEE_ = #{loginName}
            AND aht_123.END_TIME_ IS NOT NULL
            AND aht_123.DELETE_REASON_ IS NULL
            AND ahap_123.APPLYINST_STATE !='6'
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )
        UNION
        (
        SELECT
        aht_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        aht_123.END_TIME_ AS processTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        aht_123.NAME_ AS taskName,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        aht_123.TASK_DEF_KEY_ AS taskDefKey,
        ahp_123.ID_ procInstId
        FROM
        ACT_HI_TASKINST aht_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON aht_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = aht_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND aht_123.ASSIGNEE_ = #{loginName}
            AND aht_123.END_TIME_ IS NOT NULL
            AND aht_123.DELETE_REASON_ IS NULL
            AND ahap_123.APPLYINST_STATE !='6'
            <include refid="baseConditionalQuery">
            </include>
        </where>

        )
        ) temp
        GROUP BY
        <if test="_databaseId == 'oracle'">
            temp.taskId,
            temp.applyinstId,
            temp.applyinstCode,
            temp.stageName,
--             temp.linkmanName,
            temp.applySource,
            temp.processTime,
            temp.applyTime,
            temp.acceptTime,
            temp.taskName,
            temp.dueNum,
            temp.isSeriesApprove,
            temp.busRecordId,
            temp.applyType,
            temp.projName,
            temp.localCode,
            temp.gcbm,
            temp.themeName,
            temp.itemName,
            temp.overdueTime,
            temp.remainingTime,
            temp.instState,
            temp.timeruleUnit,
            temp.taskDefKey,
            temp.procInstId
        </if>
        <if test="_databaseId == 'mysql'">
            temp.taskId
        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>

    </select>

    <select id="listConcludedTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        temp.*
        FROM
        (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        aps_123.DUE_NUM AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahp_123.ID_ AS procInstId,
        aht_123.ID_ AS taskId,
        hist.TRIGGER_TIME AS concludedTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        theme.THEME_NAME AS themeName,
        NULL AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        ti.USE_LIMIT_TIME AS useLimitTime
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_hi_taskinst aht_123 ON aht_123.PROC_INST_ID_ = ahp_123.ID_
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = AHP_123.PROC_INST_ID_
        LEFT JOIN (
            SELECT
                ahist.APPLYINST_ID,MAX(TRIGGER_TIME) AS TRIGGER_TIME
            FROM aea_log_apply_state_hist ahist
            WHERE ahist.NEW_STATE = '6'
            GROUP BY APPLYINST_ID
        ) hist ON hist.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '6'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
--         ali_123.LINKMAN_NAME linkmanName,
        ahap_123.APPLYINST_SOURCE applySource,
        aps_123.DUE_NUM AS dueNum,
        '0' AS isSeriesApprove,
        NULL AS busRecordId,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahp_123.ID_ AS procInstId,
        aht_123.ID_ AS taskId,
        hist.TRIGGER_TIME AS concludedTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        theme.THEME_NAME AS themeName,
        NULL AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        ti.USE_LIMIT_TIME AS useLimitTime
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
        LEFT JOIN act_sto_appinst_subflow asas_123 ON asas_123.SUBFLOW_PROCINST_ID = ahp_123.PROC_INST_ID_
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_hi_taskinst aht_123 ON aht_123.PROC_INST_ID_ = ahp_123.ID_
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = AHP_123.PROC_INST_ID_
        LEFT JOIN (
        SELECT
        ahist.APPLYINST_ID,MAX(TRIGGER_TIME) AS TRIGGER_TIME
        FROM aea_log_apply_state_hist ahist
        WHERE ahist.NEW_STATE = '6'
        GROUP BY APPLYINST_ID
        ) hist ON hist.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '6'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahp_123.ID_ AS procInstId,
        aht_123.ID_ AS taskId,
        hist.TRIGGER_TIME AS concludedTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        ti.USE_LIMIT_TIME AS useLimitTime
        FROM
        AEA_HI_APPLYINST ahap_123

        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = AHP_123.PROC_INST_ID_
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_hi_taskinst aht_123 ON aht_123.PROC_INST_ID_ = ahp_123.ID_
        LEFT JOIN (
        SELECT
        ahist.APPLYINST_ID,MAX(TRIGGER_TIME) AS TRIGGER_TIME
        FROM aea_log_apply_state_hist ahist
        WHERE ahist.NEW_STATE = '6'
        GROUP BY APPLYINST_ID
        ) hist ON hist.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '6'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>

        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        ahap_123.APPLYINST_SOURCE AS applySource,
        ai_123.DUE_NUM AS dueNum,
        '1' AS isSeriesApprove,
        ahi_123.ITEMINST_ID AS busRecordId,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahp_123.ID_ AS procInstId,
        aht_123.ID_ AS taskId,
        hist.TRIGGER_TIME AS concludedTime,
        ahap_123.CREATE_TIME AS applyTime,
        ahap_123.ACCEPT_TIME AS acceptTime,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
        ti.OVERDUE_TIME AS overdueTime,
        ti.REMAINING_TIME AS remainingTime,
        ti.INST_STATE AS instState,
        ti.TIMERULE_UNIT AS timeruleUnit,
        ti.USE_LIMIT_TIME AS useLimitTime
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN act_sto_appinst asa_123 ON asa_123.master_record_id = ahap_123.APPLYINST_ID
        LEFT JOIN act_hi_procinst ahp_123 ON ahp_123.PROC_INST_ID_ = asa_123.procinst_id
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_timerule_inst ti ON ti.PROC_INST_ID = ahi_123.PROCINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN act_hi_taskinst aht_123 ON aht_123.PROC_INST_ID_ = ahp_123.ID_
        LEFT JOIN (
        SELECT
        ahist.APPLYINST_ID,MAX(TRIGGER_TIME) AS TRIGGER_TIME
        FROM aea_log_apply_state_hist ahist
        WHERE ahist.NEW_STATE = '6'
        GROUP BY APPLYINST_ID
        ) hist ON hist.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '6'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp
        GROUP BY
        <if test="_databaseId == 'oracle'">
            temp.procInstId,
            temp.applyinstId,
            temp.applyinstCode,
            temp.stageName,
--             temp.linkmanName,
            temp.applySource,
            temp.dueNum,
            temp.isSeriesApprove,
            temp.busRecordId,
            temp.applyType,
            temp.projName,
            temp.localCode,
            temp.gcbm,
            temp.taskId,
            temp.concludedTime,
            temp.applyTime,
            temp.acceptTime,
            temp.themeName,
            temp.itemName,
            temp.overdueTime,
            temp.remainingTime,
            temp.instState,
            temp.timeruleUnit,
            temp.useLimitTime
        </if>
        <if test="_databaseId == 'mysql'">
            temp.procInstId
        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listAllPreliminaryTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime
        FROM
        <choose>
            <when test="windowId != null and windowId != '' ">
                (SELECT * FROM AEA_HI_APPLYINST WHERE APPLYINST_ID IN (
                  SELECT APPLYINST_ID FROM AEA_HI_APPLYINST ahap_123
                  LEFT JOIN ACT_STO_APPINST app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
                  LEFT JOIN ACT_RU_TASK t ON t.PROC_INST_ID_ = app.PROCINST_ID AND t.ASSIGNEE_ in (
                    SELECT ou.LOGIN_NAME FROM AEA_SERVICE_WINDOW_USER wu
                    LEFT JOIN OPU_OM_USER ou ON wu.USER_ID = ou.USER_ID
                    WHERE wu.WINDOW_ID = #{windowId})
                  WHERE ahap_123.IS_SERIES_APPROVE = '0'
                    AND ahap_123.APPLYINST_STATE = '0'
                    AND ahap_123.APPLYINST_SOURCE = 'net'
                    GROUP BY ahap_123.APPLYINST_ID) ) ahap_123
            </when>
            <otherwise>
                aea_hi_applyinst ahap_123
            </otherwise>
        </choose>
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID

        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '0'
            AND APPLYINST_SOURCE = 'net'

            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime
        FROM
        <choose>
            <when test="windowId != null and windowId != '' ">
                (SELECT * FROM AEA_HI_APPLYINST WHERE APPLYINST_ID IN (
                  SELECT APPLYINST_ID FROM AEA_HI_APPLYINST ahap_123
                  LEFT JOIN ACT_STO_APPINST app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
                  LEFT JOIN ACT_RU_TASK t ON t.PROC_INST_ID_ = app.PROCINST_ID AND t.ASSIGNEE_ in (
                    SELECT ou.LOGIN_NAME FROM aea_service_window_user wu
                    LEFT JOIN opu_om_user ou ON wu.USER_ID = ou.USER_ID
                    WHERE wu.WINDOW_ID = #{windowId})
                  WHERE ahap_123.IS_SERIES_APPROVE = '1'
                    AND ahap_123.APPLYINST_STATE = '0'
                    AND ahap_123.APPLYINST_SOURCE = 'net'
                  GROUP BY ahap_123.APPLYINST_ID) ) ahap_123
            </when>
            <otherwise>
                aea_hi_applyinst ahap_123
            </otherwise>
        </choose>
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID

        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '0'
            AND APPLYINST_SOURCE = 'net'
            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listPreliminaryTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = app.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND (ahap_123.APPLYINST_STATE = '0' or ahap_123.APPLYINST_STATE = '4')
            AND APPLYINST_SOURCE = 'net'

            <!--<if test="userList != null and userList.size() > 0">-->
                <!--AND t.ASSIGNEE_ IN-->
                <!--<foreach collection="userList" item="item" open="(" separator="," close=")">-->
                    <!--#{item}-->
                <!--</foreach>-->
            <!--</if>-->

            AND t.ASSIGNEE_ = #{loginName}

            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = apps.SUBFLOW_PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND (ahap_123.APPLYINST_STATE = '0' or ahap_123.APPLYINST_STATE = '4')
            AND APPLYINST_SOURCE = 'net'
            <!--<if test="userList != null and userList.size() > 0">-->
                <!--AND t.ASSIGNEE_ IN-->
                <!--<foreach collection="userList" item="item" open="(" separator="," close=")">-->
                    <!--#{item}-->
                <!--</foreach>-->
            <!--</if>-->


            AND t.ASSIGNEE_ = #{loginName}

            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = app.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND (ahap_123.APPLYINST_STATE = '0' or ahap_123.APPLYINST_STATE = '4')
            AND APPLYINST_SOURCE = 'net'
            <!--<if test="userList != null and userList.size() > 0">-->
                <!--AND t.ASSIGNEE_ IN-->
                <!--<foreach collection="userList" item="item" open="(" separator="," close=")">-->
                    <!--#{item}-->
                <!--</foreach>-->
            <!--</if>-->

            AND t.ASSIGNEE_ = #{loginName}

            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        NULL AS THEME_NAME,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = apps.SUBFLOW_PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND (ahap_123.APPLYINST_STATE = '0' or ahap_123.APPLYINST_STATE = '4')
            AND APPLYINST_SOURCE = 'net'
            <!--<if test="userList != null and userList.size() > 0">-->
                <!--AND t.ASSIGNEE_ IN-->
                <!--<foreach collection="userList" item="item" open="(" separator="," close=")">-->
                    <!--#{item}-->
                <!--</foreach>-->
            <!--</if>-->

            AND t.ASSIGNEE_ = #{loginName}

            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listDoneliminaryTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = app.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND (ahap_123.APPLYINST_STATE = '1' or ahap_123.APPLYINST_STATE = '5')
            AND APPLYINST_SOURCE = 'net'

            <if test="userList != null and userList.size() > 0">
                AND t.ASSIGNEE_ IN
                <foreach collection="userList" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = apps.SUBFLOW_PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND (ahap_123.APPLYINST_STATE = '1' or ahap_123.APPLYINST_STATE = '5')
            AND APPLYINST_SOURCE = 'net'
            <if test="userList != null and userList.size() > 0">
                AND t.ASSIGNEE_ IN
                <foreach collection="userList" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = app.PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND (ahap_123.APPLYINST_STATE = '1' or ahap_123.APPLYINST_STATE = '5')
            AND APPLYINST_SOURCE = 'net'
            <if test="userList != null and userList.size() > 0">
                AND t.ASSIGNEE_ IN
                <foreach collection="userList" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' else '并联' end AS applyType,
        NULL AS THEME_NAME,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        t.ID_ AS taskId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN act_sto_appinst app ON app.MASTER_RECORD_ID = ahap_123.APPLYINST_ID
        LEFT JOIN act_sto_appinst_subflow apps ON apps.APPINST_ID = app.APPINST_ID
        LEFT JOIN act_ru_task t ON t.PROC_INST_ID_ = apps.SUBFLOW_PROCINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND (ahap_123.APPLYINST_STATE = '1' or ahap_123.APPLYINST_STATE = '5')
            AND APPLYINST_SOURCE = 'net'
            <if test="userList != null and userList.size() > 0">
                AND t.ASSIGNEE_ IN
                <foreach collection="userList" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listDismissedApply" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">


        SELECT
        temp_123.*
        FROM (

        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' ELSE '并联' end applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        asi_123.TRIGGER_TIME AS dismissedTime,
        asi_123.OPS_USER_NAME AS assignee,
        receive.RECEIVE_ID AS receiveId

        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_receive receive ON receive.APPLYINST_ID = ahap_123.APPLYINST_ID AND receive.RECEIPT_TYPE = '3'
        INNER JOIN aea_log_apply_state_hist asi_123 ON asi_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND asi_123.NEW_STATE
        = '5'
        <if test="entrust">
            <if test="windowId != null and windowId != '' ">
                AND asi_123.OPS_WINDOW_ID = #{windowId}
            </if>
        </if>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '5'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE when '1' THEN '单项' ELSE '并联' end applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        asi_123.TRIGGER_TIME AS dismissedTime,
        asi_123.OPS_USER_NAME AS assignee,
        receive.RECEIVE_ID AS receiveId
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_receive receive ON receive.APPLYINST_ID = ahap_123.APPLYINST_ID AND receive.RECEIPT_TYPE = '3'
        INNER JOIN aea_log_apply_state_hist asi_123 ON asi_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND asi_123.NEW_STATE
        = '5'
        <if test="entrust">
            <if test="windowId != null and windowId != '' ">
                AND asi_123.OPS_WINDOW_ID = #{windowId}
            </if>
        </if>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID

        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '5'
            <include refid="baseConditionalQuery">
            </include>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listNeedCorrectTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahic_123.CORRECT_ID AS correctId,
        ahic_123.CHARGE_ORG_NAME AS organizer,
        oou.USER_NAME AS assignee,
        ahic_123.CORRECT_DUE_TIME AS correctDueTime
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '6'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '6'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>


            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>

            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>

        </where>
        UNION
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId ,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahic_123.CORRECT_ID AS correctId,
        ahic_123.CHARGE_ORG_NAME AS organizer,
        oou.USER_NAME AS assignee,
        ahic_123.CORRECT_DUE_TIME AS correctDueTime
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '6'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '6'
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listNeedCompletedApply" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
--         ali_123.LINKMAN_NAME AS linkmanName,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahac_123.APPLYINST_CORRECT_ID AS correctId,
        ahac_123.CORRECT_DUE_TIME AS correctDueTime,
        ahac_123.WINDOW_USER_NAME AS assignee
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahap_123.APPLYINST_ID = ahs_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_APPLYINST_CORRECT ahac_123 ON ahac_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ( ahac_123.CORRECT_STATE = '6' OR ahac_123.CORRECT_STATE IS NULL )
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '3'

            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>

            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>

            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
--         ali_123.LINKMAN_NAME AS linkmanName,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahac_123.APPLYINST_CORRECT_ID AS correctId,
        ahac_123.CORRECT_DUE_TIME AS correctDueTime,
        ahac_123.WINDOW_USER_NAME AS assignee
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        INNER JOIN AEA_HI_APPLYINST_CORRECT ahac_123 ON ahac_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ( ahac_123.CORRECT_STATE = '6' OR ahac_123.CORRECT_STATE IS NULL )
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '3'
            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>

    </select>

    <select id="listNeedConfirmCompletedApply" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        NULL AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahac_123.APPLYINST_CORRECT_ID AS correctId,
        ahac_123.CORRECT_END_TIME AS correctTime
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>

--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_APPLYINST_CORRECT ahac_123 ON ahac_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahac_123.CORRECT_STATE = '7'
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE = '4'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>

            <if test="_databaseId == 'oracle'">
                <if test="correctStartTime != null and correctStartTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_END_TIME , 'yyyy-mm-dd')>=  #{correctStartTime}   ]]>
                </if>
                <if test="correctEndTime != null and correctEndTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_END_TIME , 'yyyy-mm-dd')<=  #{correctEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctStartTime != null and correctStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_END_TIME , '%Y-%m-%d')>=  #{correctStartTime}   ]]>
                </if>
                <if test="correctEndTime != null and correctEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_END_TIME , '%Y-%m-%d')<=  #{correctEndTime}   ]]>
                </if>
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahac_123.APPLYINST_CORRECT_ID AS correctId,
        ahac_123.CORRECT_END_TIME AS correctTime
        FROM
        aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_seriesinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        INNER JOIN AEA_HI_APPLYINST_CORRECT ahac_123 ON ahac_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahac_123.CORRECT_STATE = '7'
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE = '4'
            <if test="_databaseId == 'oracle'">
                <if test="correctStartTime != null and correctStartTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_END_TIME , 'yyyy-mm-dd')>=  #{correctStartTime}   ]]>
                </if>
                <if test="correctEndTime != null and correctEndTime != '' ">
                    <![CDATA[ AND to_char(ahac_123.CORRECT_END_TIME , 'yyyy-mm-dd')<=  #{correctEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctStartTime != null and correctStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_END_TIME , '%Y-%m-%d')>=  #{correctStartTime}   ]]>
                </if>
                <if test="correctEndTime != null and correctEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahac_123.CORRECT_END_TIME , '%Y-%m-%d')<=  #{correctEndTime}   ]]>
                </if>
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listPickupCheckTasksByPage" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME themeName,
        theme.THEME_ID themeId,
        aps_123.STAGE_NAME stageName ,
        NULL as iteminst_id,
        NULL AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE IN ('6')
            AND (ahap_123.is_sms_send ='0' or ahap_123.IS_SMS_SEND is null )
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>

        UNION

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '单项' AS applyType,
        NULL AS themeName,
        NULL AS themeId,
        NULL AS stageName,
        ahi_123.ITEMINST_ID,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID

        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE IN ('6')

            AND (ahap_123.is_sms_send ='0' or ahap_123.IS_SMS_SEND is null )
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>


        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>


            <if test="_databaseId == 'oracle'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')<=  #{concludedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')<=  #{concludedEndTime}   ]]>
                </if>
            </if>
            <if test="applySource != null and applySource != '' ">
                AND temp_123.applySource = #{applySource}
            </if>
            <if test="theme != null and theme != '' ">
                AND temp_123.themeId = #{theme}
            </if>
        </where>

    </select>
    <select id="listPickupCheckTasksFinishByPage" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME themeName,
        theme.THEME_ID themeId,
        aps_123.STAGE_NAME stageName ,
        NULL AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE IN ('6')
            AND ahap_123.is_sms_send ='1'
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>

        UNION

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '单项' AS applyType,
        NULL AS themeName,
        NULL AS themeId,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID

        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE IN ('6')
            AND ahap_123.is_sms_send ='1'
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>


            <if test="_databaseId == 'oracle'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')<=  #{concludedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')<=  #{concludedEndTime}   ]]>
                </if>
            </if>

            <if test="applySource != null and applySource != '' ">
                AND temp_123.applySource = #{applySource}
            </if>
            <if test="theme != null and theme != '' ">
                AND temp_123.themeId = #{theme}
            </if>
        </where>

    </select>

    <select id="listNeedCorrectTasksOrganizer" resultType="com.augurit.agcloud.opus.common.domain.OpuOmOrg">
        SELECT
        temp_123.*
        FROM (
        SELECT
        ahic_123.CHARGE_ORG_ID AS orgId,
        ahic_123.CHARGE_ORG_NAME AS orgName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        INNER JOIN (
        SELECT
        DISTINCT alog.APPLYINST_ID
        FROM aea_log_apply_state_hist alog
        <where>
            <if test="windowId != null and windowId != '' ">
                AND alog.OPS_WINDOW_ID = #{windowId}
            </if>
        </where>
        )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '6'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '6'
        </where>
        UNION
        SELECT
        ahic_123.CHARGE_ORG_ID AS orgId,
        ahic_123.CHARGE_ORG_NAME AS orgName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        INNER JOIN (
        SELECT
        DISTINCT alog.APPLYINST_ID
        FROM aea_log_apply_state_hist alog
        <where>
            <if test="windowId != null and windowId != '' ">
                AND alog.OPS_WINDOW_ID = #{windowId}
            </if>
        </where>
        )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '6'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '6'
        </where>

        ) temp_123 GROUP BY temp_123.orgId,temp_123.orgName
    </select>

    <!--不予受理-部门事项列表-->
    <select id="listItemOutScope" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        NULL AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        theme.THEME_NAME themeName,
        aps_123.STAGE_NAME stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS TASK_ID ,
        aht_123.NAME_ taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '5'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID UNION
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahi_123.ITEMINST_ID AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '5'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <!--部门-办结（不通过）-->
    <select id="listItemDisgree" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        NULL AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        theme.THEME_NAME themeName,
        aps_123.STAGE_NAME stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId ,
        aht_123.NAME_ taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '13'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>

        </where>
        GROUP BY
        ahi_123.ITEMINST_ID UNION
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahi_123.ITEMINST_ID AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '13'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>
    <!--容缺受理件-->
    <select id="listItemToleranceAccept" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        NULL AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        theme.THEME_NAME themeName,
        aps_123.STAGE_NAME stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS TASK_ID ,
        aht_123.NAME_ taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.IS_TOLERANCE_ACCEPT = '1'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID UNION
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahi_123.ITEMINST_ID AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.IS_TOLERANCE_ACCEPT = '1'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>
    <!--容缺通过件-->
    <select id="listItemAgreeTolerance" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        theme.THEME_NAME themeName,
        aps_123.STAGE_NAME stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS TASK_ID ,
        NULL AS busRecordId,
        aht_123.NAME_ taskName

        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '12'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID UNION
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        ahi_123.ITEMINST_ID AS busRecordId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '12'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>

        </where>
        GROUP BY
        ahi_123.ITEMINST_ID
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <!-- 未完成申报流程 -->
    <select id="listUnCompleteFlow" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        *
        FROM
        (
        SELECT
        result_123.*
        FROM
        (
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
        theme.THEME_NAME themeName,
        NULL AS itemName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE
        ahap_123.APPLYINST_SOURCE
        WHEN 'win' THEN
        '窗口' ELSE '网上'
        END AS applySource,
        art_123.NAME_ AS taskName,
        '0' AS isSeriesApprove,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj"></include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        WHERE
        art_123.ASSIGNEE_ IS NULL
        AND ahap_123.IS_SERIES_APPROVE = '0'
        ) UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        aps_123.STAGE_NAME AS stageName,
        theme.THEME_NAME themeName,
        NULL AS itemName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE
        ahap_123.APPLYINST_SOURCE
        WHEN 'win' THEN
        '窗口' ELSE '网上'
        END AS applySource,
        art_123.NAME_ AS taskName,
        '0' AS isSeriesApprove,
        '并联' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj"></include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        WHERE
        art_123.ASSIGNEE_ IS NULL
        AND ahap_123.IS_SERIES_APPROVE = '0'
        ) UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE
        ahap_123.APPLYINST_SOURCE
        WHEN 'win' THEN
        '窗口' ELSE '网上'
        END AS applySource,
        art_123.NAME_ AS taskName,
        '1' AS isSeriesApprove,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asa_123.procinst_id = ahp_123.PROC_INST_ID_
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj"></include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID
        AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        WHERE
        art_123.ASSIGNEE_ IS NULL
        AND ahap_123.IS_SERIES_APPROVE = '1'
        ) UNION
        (
        SELECT
        art_123.ID_ AS taskId,
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        NULL AS stageName,
        NULL AS themeName,
        ahi_123.ITEMINST_NAME AS itemName,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE
        ahap_123.APPLYINST_SOURCE
        WHEN 'win' THEN
        '窗口' ELSE '网上'
        END AS applySource,
        art_123.NAME_ AS taskName,
        '1' AS isSeriesApprove,
        '单项' AS applyType,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm
        FROM
        ACT_RU_TASK art_123
        LEFT JOIN ACT_HI_PROCINST ahp_123 ON art_123.PROC_INST_ID_ = AHP_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST_SUBFLOW asas_123 ON asas_123.SUBFLOW_PROCINST_ID = art_123.PROC_INST_ID_
        LEFT JOIN ACT_STO_APPINST asa_123 ON asas_123.appinst_id = asa_123.APPINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahap_123.APPLYINST_ID = asa_123.master_record_id
        <include refid="leftJoinApplyinstProj"></include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID
        AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        WHERE
        art_123.ASSIGNEE_ IS NULL
        AND ahap_123.IS_SERIES_APPROVE = '1'
        )
        ) result_123
        GROUP BY
        result_123.taskId
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <!--部门-补正待确认件 -->
    <select id="listUnConfirmItemCorrect" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahic_123.CORRECT_ID AS correctId,
        ahic_123.CHARGE_ORG_NAME AS organizer,
        oou.USER_NAME AS assignee,
        ahic_123.CORRECT_DUE_TIME AS correctDueTime
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '7'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '7'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>

        </where>
        UNION
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId ,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahic_123.CORRECT_ID AS correctId,
        ahic_123.CHARGE_ORG_NAME AS organizer,
        oou.USER_NAME AS assignee,
        ahic_123.CORRECT_DUE_TIME AS correctDueTime
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        INNER JOIN AEA_HI_ITEM_CORRECT ahic_123 ON ahic_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahic_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahic_123.CORRECT_STATE = '7'
        LEFT JOIN opu_om_user oou ON ahic_123.CREATER = oou.USER_ID
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '7'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND to_char(ahic_123.CORRECT_DUE_TIME , 'yyyy-mm-dd')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="correctDueStartTime != null and correctDueStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')>=  #{correctDueStartTime}   ]]>
                </if>
                <if test="correctDueEndTime != null and correctDueEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahic_123.CORRECT_DUE_TIME , '%Y-%m-%d')<=  #{correctDueEndTime}   ]]>
                </if>
            </if>

            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <!--特别程序件 只查询 审批通过 且 未结束的件 -->
    <select id="lisSpecialProcedureTasks" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        ahap_123.APPLYINST_ID AS applyinstId,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        oou.USER_NAME AS assignee,
        ahis_123.SPECIAL_ID AS specialId,
        ahis_123.SPECIAL_TYPE AS specialType,
        ahis_123.SPECIAL_DUE_WAY AS specialDueWay,
        ahis_123.CREATE_TIME AS specialCreateTime,
        ahis_123.SPECIAL_DUE_TIME AS specialDueTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        ahi_123.ITEMINST_ID AS busRecordId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        INNER JOIN AEA_HI_ITEM_SPECIAL ahis_123 ON ahis_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahis_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahis_123.APPROVE_RESULT = '1' and ahis_123.SPECIAL_STATE='9'
        LEFT JOIN opu_om_user oou ON ahis_123.OPS_USER_ID = oou.USER_ID
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '9'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>


            <if test="_databaseId == 'oracle'">
                <if test="specialStartTime != null and specialStartTime != '' ">
                    <![CDATA[ AND to_char(ahis_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{specialStartTime}   ]]>
                </if>
                <if test="specialEndTime != null and specialEndTime != '' ">
                    <![CDATA[ AND to_char(ahis_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{specialEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="specialStartTime != null and specialStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahis_123.CREATE_TIME , '%Y-%m-%d')>=  #{specialStartTime}   ]]>
                </if>
                <if test="specialEndTime != null and specialEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahis_123.CREATE_TIME , '%Y-%m-%d')<=  #{specialEndTime}   ]]>
                </if>
            </if>

            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>

        </where>
        UNION
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId ,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        ahap_123.APPLYINST_ID AS applyinstId,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        case ahap_123.IS_SERIES_APPROVE WHEN '1' THEN '单项' ELSE '并联' end AS applyType,
        ahap_123.APPLYINST_SOURCE AS applySource,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        oou.USER_NAME AS assignee,
        ahis_123.SPECIAL_ID AS specialId,
        ahis_123.SPECIAL_TYPE AS specialType,
        ahis_123.SPECIAL_DUE_WAY AS specialDueWay,
        ahis_123.CREATE_TIME AS specialCreateTime,
        ahis_123.SPECIAL_DUE_TIME AS specialDueTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        ahi_123.ITEMINST_ID AS busRecordId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            <where>
                <if test="windowId != null and windowId != '' ">
                    AND alog.OPS_WINDOW_ID = #{windowId}
                </if>
            </where>

            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        INNER JOIN AEA_HI_ITEM_SPECIAL ahis_123 ON ahis_123.APPLYINST_ID = ahap_123.APPLYINST_ID AND
        ahis_123.ITEMINST_ID = ahi_123.ITEMINST_ID AND ahis_123.APPROVE_RESULT = '1' and ahis_123.SPECIAL_STATE='9'
        LEFT JOIN opu_om_user oou ON ahis_123.OPS_USER_ID = oou.USER_ID
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '9'
            AND aht_123.ASSIGNEE_ = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="specialStartTime != null and specialStartTime != '' ">
                    <![CDATA[ AND to_char(ahis_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{specialStartTime}   ]]>
                </if>
                <if test="specialEndTime != null and specialEndTime != '' ">
                    <![CDATA[ AND to_char(ahis_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{specialEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="specialStartTime != null and specialStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahis_123.CREATE_TIME , '%Y-%m-%d')>=  #{specialStartTime}   ]]>
                </if>
                <if test="specialEndTime != null and specialEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahis_123.CREATE_TIME , '%Y-%m-%d')<=  #{specialEndTime}   ]]>
                </if>
            </if>
            <if test="organizerId != null and organizerId != '' ">
                AND ahic_123.CHARGE_ORG_ID = #{organizerId}
            </if>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>
    <select id="listPickupCheckTasksByPageState" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">

        SELECT
        temp_123.*
        FROM
        (

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME themeName,
        theme.THEME_ID themeId,
        aps_123.STAGE_NAME stageName ,
        NULL as iteminst_id,
        NULL AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN aea_hi_sms_info ahsi on ahsi.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.APPLYINST_STATE IN ('6')
            AND (ahap_123.is_sms_send ='0' or ahap_123.IS_SMS_SEND is null )
            and ahsi.RECEIVE_MODE = #{receiveMode}
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>
        UNION

        SELECT
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        '单项' AS applyType,
        NULL AS themeName,
        NULL AS themeId,
        NULL AS stageName,
ahi_123.ITEMINST_ID,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.ACCEPT_TIME acceptTime,
        ahap_123.MODIFY_TIME concludedTime,
        ahap_123.IS_SMS_SEND isSmsSend
        FROM
        AEA_HI_APPLYINST ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN AEA_HI_ITEMINST ahi_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN aea_hi_sms_info ahsi on ahsi.APPLYINST_ID = ahap_123.APPLYINST_ID
        <where>
            ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.APPLYINST_STATE IN ('6')

            AND (ahap_123.is_sms_send ='0' or ahap_123.IS_SMS_SEND is null )
            and ahsi.RECEIVE_MODE = #{receiveMode}
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
        </where>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>

            <if test="_databaseId == 'oracle'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.acceptTime , 'yyyy-mm-dd')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND to_char(temp_123.concludedTime , 'yyyy-mm-dd')<=  #{concludedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="acceptStartTime != null and acceptStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')>=  #{acceptStartTime}   ]]>
                </if>
                <if test="acceptEndTime != null and acceptEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.acceptTime , '%Y-%m-%d')<=  #{acceptEndTime}   ]]>
                </if>
                <if test="concludedStartTime != null and concludedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')>=  #{concludedStartTime}   ]]>
                </if>
                <if test="concludedEndTime != null and concludedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(temp_123.concludedTime , '%Y-%m-%d')<=  #{concludedEndTime}   ]]>
                </if>
            </if>
            <if test="applySource != null and applySource != '' ">
                AND temp_123.applySource = #{applySource}
            </if>
            <if test="theme != null and theme != '' ">
                AND temp_123.themeId = #{theme}
            </if>
        </where>
    </select>

    <select id="listSeriesApplyItem" resultType="com.augurit.aplanmis.common.domain.AeaItemBasic">
        SELECT temp_table.*
        FROM (
                SELECT aiv_123.ITEM_VER_ID AS itemVerId, aiv_123.ITEM_ID AS itemId, aiv_123.VER_NUM AS verNum, aib_123.ITEM_CODE AS itemCode,
                aib_123.ITEM_NAME AS itemName, aib_123.ORG_ID AS orgId, aib_123.XKDX AS xkdx, aib_123.ITEM_PROPERTY AS itemProperty, aib_123.DUE_NUM AS dueNum,
                aib_123.BJ_TYPE AS bjType, ooo_123.ORG_NAME AS orgName
                FROM AEA_ITEM_VER aiv_123
                LEFT JOIN AEA_ITEM_BASIC aib_123 ON aiv_123.ITEM_VER_ID = aib_123.ITEM_VER_ID
                LEFT JOIN OPU_OM_ORG ooo_123 ON aib_123.org_id = ooo_123.org_id
                WHERE
                aiv_123.IS_DELETED = 0
                AND aiv_123.ITEM_VER_STATUS IN ('1', '2')
                <if test="itemNature != null and itemNature != '' ">
                    AND aib_123.item_nature = #{itemNature}
                </if>
                AND aiv_123.ITEM_VER_ID IN (
                    SELECT ITEM_VER_ID
                    FROM aea_service_window_item
                    WHERE WIND_ID IN (
                        SELECT asw_123.WINDOW_ID
                        FROM aea_service_window asw_123
                        INNER JOIN aea_service_window_user aswu_123 ON asw_123.WINDOW_ID = aswu_123.WINDOW_ID
                        INNER JOIN opu_om_user usr_123 ON usr_123.USER_ID = aswu_123.USER_ID
                        AND usr_123.LOGIN_NAME = #{loginName}
                        WHERE  aswu_123.IS_ACTIVE = '1'
                        AND asw_123.IS_ACTIVE = '1' AND asw_123.IS_ALL_ITEM = '0'
                    )
                    AND IS_ACTIVE = '1'
                )
            UNION
            SELECT aiv_123.ITEM_VER_ID AS itemVerId, aiv_123.ITEM_ID AS itemId, aiv_123.VER_NUM AS verNum, aib_123.ITEM_CODE AS itemCode,
            aib_123.ITEM_NAME AS itemName, aib_123.ORG_ID AS orgId, aib_123.XKDX AS xkdx, aib_123.ITEM_PROPERTY AS itemProperty, aib_123.DUE_NUM AS dueNum,
            aib_123.BJ_TYPE AS bjType, ooo_123.ORG_NAME AS orgName
            FROM AEA_ITEM_VER aiv_123
            LEFT JOIN AEA_ITEM_BASIC aib_123 ON aiv_123.ITEM_VER_ID = aib_123.ITEM_VER_ID
            LEFT JOIN OPU_OM_ORG ooo_123 ON aib_123.org_id = ooo_123.org_id
            WHERE
            aiv_123.IS_DELETED = 0
            AND aiv_123.ITEM_VER_STATUS IN ('1', '2')
            <if test="itemNature != null and itemNature != '' ">
                AND aib_123.item_nature = #{itemNature}
            </if>
            AND aib_123.IS_CATALOG = '0'
            AND EXISTS (
                SELECT asw_123.WINDOW_ID
                FROM aea_service_window asw_123
                INNER JOIN aea_service_window_user aswu_123 ON asw_123.WINDOW_ID = aswu_123.WINDOW_ID
                INNER JOIN opu_om_user usr_123 ON usr_123.USER_ID = aswu_123.USER_ID
                AND usr_123.LOGIN_NAME = #{loginName}
                WHERE  aswu_123.IS_ACTIVE = '1'
                AND asw_123.IS_ALL_ITEM = '1' AND asw_123.IS_ACTIVE = '1'
            )
            ) temp_table
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_table.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_table.itemCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_table.orgName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>


    <select id="listTaskRemindInfo" resultType="com.augurit.agcloud.bpm.common.domain.ActStoRemindAndReceiver">
        SELECT
        r.REMIND_ID remindId,
        r.TASK_INST_ID taskInstId,
        r.SEND_USER_ID sendUserId,
        u.USER_NAME sendUserName,
        r.SEND_DATE sendDate,
        r.REMIND_CONTENT remindContent,
        r.REMIND_MODE remindModel,
        r.REMIND_LEVEL remindLevel,
        r.REMIND_TYPE remindType,
        re.REMIND_RECEIVER_TYPE remindReceiver,
        re.RECEIVER_USER_ID receiverUserId,
        re.REMIND_RECEIVER_ID remindReceiverId,
        re.IS_READ isRead,
        re.READED_TIME readedTime
        FROM
        act_sto_remind_receiver re
        LEFT JOIN act_sto_remind r ON r.REMIND_ID = re.REMIND_ID
        LEFT JOIN opu_om_user u ON u.USER_ID = r.SEND_USER_ID
        <where>
            AND re.RECEIVER_USER_ID = #{receiverUserId}
            AND re.IS_READ != '1'
            AND r.REMIND_TYPE LIKE CONCAT(CONCAT('%','n'),'%')
            <if test="taskIdList != null and taskIdList.size > 0">
                AND r.TASK_INST_ID IN
                <foreach collection="taskIdList" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

        </where>
        ORDER BY r.SEND_DATE desc
    </select>
    
    <select id="listMyDrafts" resultType="com.augurit.aplanmis.common.vo.conditional.ApplyInfo">

        SELECT
        temp_123.*
        FROM (

        SELECT
            ahap_123.APPLYINST_CODE AS applyinstCode,
            ahap_123.APPLYINST_ID AS applyinstId,
            temp1.PROJ_NAME AS projName,
            temp1.LOCAL_CODE AS localCode,
            temp1.GCBM AS gcbm,
            '并联' AS applyType,
            theme.THEME_NAME AS themeName,
            aps_123.STAGE_NAME AS stageName,
            NULL AS itemName,
            '已接件' AS applyState,
            ahap_123.CREATE_TIME AS applyTime,
--             ali_123.LINKMAN_NAME AS linkmanName,
            ahap_123.APPLYINST_SOURCE applySource
        FROM
            aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_par_stage aps_123 ON ahs_123.STAGE_ID = aps_123.STAGE_ID
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <where>
            ahap_123.APPLYINST_SOURCE = 'win'
            AND ahap_123.IS_DELETED = '0'
            AND ahap_123.APPLYINST_STATE = '1'
            AND ahap_123.IS_SERIES_APPROVE = '0'
            AND ahap_123.CREATER = #{loginName}
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>
        </where>
        UNION ALL
        SELECT
            ahap_123.APPLYINST_CODE AS applyinstCode,
            ahap_123.APPLYINST_ID AS applyinstId,
            temp1.PROJ_NAME AS projName,
            temp1.LOCAL_CODE AS localCode,
            temp1.GCBM AS gcbm,
            '单项' AS applyType,
            NULL AS themeName,
            NULL AS stageName,
            iteminst.ITEMINST_NAME AS itemName,
            '已接件' AS applyState,
            ahap_123.CREATE_TIME AS applyTime,
--             ali_123.LINKMAN_NAME AS linkmanName,
            ahap_123.APPLYINST_SOURCE applySource

        FROM
            aea_hi_applyinst ahap_123
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN aea_hi_seriesinst ser ON ser.APPLYINST_ID = ahap_123.APPLYINST_ID
        LEFT JOIN aea_hi_iteminst iteminst ON iteminst.seriesinst_id = ser.seriesinst_id
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <where>
            ahap_123.APPLYINST_SOURCE = 'win'
            AND ahap_123.IS_DELETED = '0'
            AND ahap_123.APPLYINST_STATE = '1'
            AND ahap_123.IS_SERIES_APPROVE = '1'
            AND ahap_123.CREATER = #{loginName}
            <include refid="baseConditionalQuery">
            </include>
        </where>
        )temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>

    </select>

    <select id="listWindowParts" resultType="com.augurit.aplanmis.common.vo.conditional.PartsInfo">

        SELECT
        *
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahi_123.ITEMINST_STATE AS iteminstState,
        ahap_123.APPLYINST_SOURCE AS applySource,
        tinst.OVERDUE_TIME AS overdueTime,
        tinst.REMAINING_TIME AS remainingTime,
        tinst.INST_STATE AS instState,
        tinst.TIMERULE_UNIT AS timeruleUnit,
        ai_123.DUE_NUM AS dueNum,
        tinst.PROC_INST_ID AS procInstId
        FROM AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        INNER JOIN (
            SELECT
                DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            where alog.OPS_WINDOW_ID = #{windowId}
        )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
        WHERE ahi_123.IS_SERIES_APPROVE = '0'
        <if test="theme != null and theme != '' ">
            AND theme.THEME_ID = #{theme}
        </if>
        <if test="approvalStage != null and approvalStage != '' ">
            AND aps_123.STAGE_ID = #{approvalStage}
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="applyType != null and applyType != '' ">
            AND ahap_123.IS_SERIES_APPROVE = #{applyType}
        </if>
        <if test="iteminstState != null and iteminstState != '' ">
            AND ahi_123.ITEMINST_STATE = #{iteminstState}
        </if>
        <if test="instState != null and instState != '' ">
            AND tinst.INST_STATE = #{instState}
        </if>
        <if test="approvalStage == null or approvalStage == '' ">
            UNION
            SELECT
            ahi_123.ITEMINST_ID AS iteminstId,
            ahap_123.APPLYINST_CODE AS applyinstCode,
            temp1.PROJ_NAME AS projName,
            temp1.LOCAL_CODE AS localCode,
            temp1.GCBM AS gcbm,
--             ali_123.LINKMAN_NAME AS linkmanName,
            '单项' AS applyType,
            NULL AS themeName,
            NULL AS stageName,
            ahi_123.ITEMINST_NAME AS itemName,
            ahap_123.CREATE_TIME AS applyTime,
            ahi_123.ITEMINST_STATE AS iteminstState,
            ahap_123.APPLYINST_SOURCE AS applySource,
            tinst.OVERDUE_TIME AS overdueTime,
            tinst.REMAINING_TIME AS remainingTime,
            tinst.INST_STATE AS instState,
            tinst.TIMERULE_UNIT AS timeruleUnit,
            ai_123.DUE_NUM AS dueNum,
            tinst.PROC_INST_ID AS procInstId
            FROM AEA_HI_ITEMINST ahi_123
            LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID =
            ai_123.ITEM_VER_ID
            LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
            LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
            INNER JOIN (
                SELECT
                    DISTINCT alog.APPLYINST_ID
                FROM aea_log_apply_state_hist alog
                where alog.OPS_WINDOW_ID = #{windowId}
            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
            <include refid="leftJoinApplyinstProj">
            </include>
--             LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
            LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
            WHERE ahi_123.IS_SERIES_APPROVE = '1'

            <if test="_databaseId == 'oracle'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="applyStartTime != null and applyStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
                </if>
                <if test="applyEndTime != null and applyEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
                </if>
            </if>

            <if test="applySource != null and applySource != '' ">
                AND ahap_123.APPLYINST_SOURCE = #{applySource}
            </if>
            <if test="applyType != null and applyType != '' ">
                AND ahap_123.IS_SERIES_APPROVE = #{applyType}
            </if>
            <if test="iteminstState != null and iteminstState != '' ">
                AND ahi_123.ITEMINST_STATE = #{iteminstState}
            </if>
            <if test="instState != null and instState != '' ">
                AND tinst.INST_STATE = #{instState}
            </if>
        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listSublineApplyInfo" resultType="com.augurit.aplanmis.common.vo.conditional.ApplyInfo">
        SELECT
        *
        FROM
        (
        SELECT
        ahap_123.APPLYINST_ID AS applyinstId,
        ahap_123.APPLYINST_STATE AS applyState,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
        ahap_123.APPLYINST_SOURCE AS applySource,
--         ali_123.LINKMAN_NAME AS linkmanName,
        CASE ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项'
        ELSE
        '并联'
        END AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahap_123.CREATE_TIME AS applyTime,
        tinst.OVERDUE_TIME AS overdueTime,
        tinst.REMAINING_TIME AS remainingTime,
        tinst.INST_STATE AS instState,
        tinst.TIMERULE_UNIT AS timeruleUnit,
        aps_123.DUE_NUM AS dueNum,
        NULL AS itemName,
        tinst.PROC_INST_ID AS procInstId
        FROM
        aea_hi_applyinst ahap_123
        INNER JOIN (
        SELECT
        ap.APPLYINST_ID AS APPLYINST_ID,
        <if test="_databaseId == 'oracle'">
            listagg(to_char(p.PROJ_NAME),',')within group(order by p.PROJ_INFO_ID) AS PROJ_NAME,
            listagg(to_char(p.LOCAL_CODE),',')within group(order by p.PROJ_INFO_ID) AS LOCAL_CODE,
            listagg(to_char(p.GCBM),',')within group(order by p.PROJ_INFO_ID) AS GCBM
        </if>

        <if test="_databaseId == 'mysql'">
            GROUP_CONCAT(p.PROJ_NAME SEPARATOR ',') AS PROJ_NAME,
            GROUP_CONCAT(p.LOCAL_CODE SEPARATOR ',') AS LOCAL_CODE,
            GROUP_CONCAT(p.GCBM SEPARATOR ',') AS GCBM
        </if>
        FROM
        aea_applyinst_proj ap
        LEFT JOIN aea_proj_info p ON ap.PROJ_INFO_ID = p.PROJ_INFO_ID
        <where>
            <if test="region != null and region != '' ">
                AND p.REGIONALISM = #{region}
            </if>
            <if test="projType != null and projType != '' ">
                AND p.PROJ_TYPE = #{projType}
            </if>
            <if test="investCategory != null and investCategory != '' ">
                AND p.INVEST_TYPE = #{investCategory}
            </if>
            <if test="industries != null and industries.length > 0">
                AND p.INDUSTRY IN
                <foreach collection="industries" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="buildNature != null and buildNature != '' ">
                AND p.PROJ_NATURE = #{buildNature}
            </if>
            <if test="projLevel != null and projLevel != '' ">
                AND p.PROJ_LEVEL = #{projLevel}
            </if>
        </where>
        GROUP BY ap.APPLYINST_ID
        ) temp1 ON temp1.APPLYINST_ID = ahap_123.APPLYINST_ID
--         LEFT JOIN aea_linkman_info ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        INNER JOIN aea_hi_par_stageinst ahs_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        INNER JOIN aea_par_stage aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID AND aps_123.IS_NODE = '2'
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            where alog.OPS_WINDOW_ID = #{windowId}
            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN aea_par_theme_ver ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
        LEFT JOIN aea_par_theme theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_appinst asp ON asp.APPINST_ID = ahs_123.APPINST_ID AND ahs_123.ROOT_ORG_ID = #{currentOrgId} AND asp.ROOT_ORG_ID = #{currentOrgId}
        LEFT JOIN act_sto_timerule_inst tinst ON tinst.APP_FLOWDEF_ID = asp.APP_FLOWDEF_ID AND tinst.PROC_INST_ID = asp.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
        WHERE
        ahap_123.IS_SERIES_APPROVE = '0'
        <if test="theme != null and theme != '' ">
            AND theme.THEME_ID = #{theme}
        </if>
        <if test="sublineType != null and sublineType != '' ">
            AND aps_123.DYGJBZFXFW = #{sublineType}
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="applyState != null and applyState != '' ">
            AND ahap_123.APPLYINST_STATE = #{applyState}
        </if>
        <if test="instState != null and instState != '' ">
            AND tinst.INST_STATE = #{instState}
        </if>
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>


    <select id="listSublinePartsInfo" resultType="com.augurit.aplanmis.common.vo.conditional.PartsInfo">

        SELECT
        *
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID AS iteminstId,
        ahap_123.APPLYINST_CODE AS applyinstCode,
        temp1.PROJ_NAME AS projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME AS linkmanName,
        '并联' AS applyType,
        theme.THEME_NAME AS themeName,
        aps_123.STAGE_NAME AS stageName,
        ahi_123.ITEMINST_NAME AS itemName,
        ahap_123.CREATE_TIME AS applyTime,
        ahi_123.ITEMINST_STATE AS iteminstState,
        ahap_123.APPLYINST_SOURCE AS applySource,
        tinst.OVERDUE_TIME AS overdueTime,
        tinst.REMAINING_TIME AS remainingTime,
        tinst.INST_STATE AS instState,
        tinst.TIMERULE_UNIT AS timeruleUnit,
        ai_123.DUE_NUM AS dueNum,
        tinst.PROC_INST_ID AS procInstId
        FROM AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_ITEM_BASIC ai_123 ON ahi_123.ITEM_ID = ai_123.ITEM_ID AND ahi_123.ITEM_VER_ID = ai_123.ITEM_VER_ID
        INNER JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        INNER JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID AND aps_123.IS_NODE = '2'
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        LEFT JOIN act_sto_timerule_inst tinst ON tinst.PROC_INST_ID = ahi_123.PROCINST_ID AND tinst.ORG_ID = #{currentOrgId}
        WHERE ahi_123.IS_SERIES_APPROVE = '0'

        <if test="sublineType != null and sublineType != '' ">
            AND aps_123.DYGJBZFXFW = #{sublineType}
        </if>

        <if test="theme != null and theme != '' ">
            AND theme.THEME_ID = #{theme}
        </if>

        <if test="_databaseId == 'oracle'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND to_char(ahap_123.CREATE_TIME , 'yyyy-mm-dd')<=  #{applyEndTime}   ]]>
            </if>
        </if>
        <if test="_databaseId == 'mysql'">
            <if test="applyStartTime != null and applyStartTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')>=  #{applyStartTime}   ]]>
            </if>
            <if test="applyEndTime != null and applyEndTime != '' ">
                <![CDATA[ AND DATE_FORMAT(ahap_123.CREATE_TIME , '%Y-%m-%d')<=  #{applyEndTime}   ]]>
            </if>
        </if>

        <if test="applySource != null and applySource != '' ">
            AND ahap_123.APPLYINST_SOURCE = #{applySource}
        </if>
        <if test="iteminstState != null and iteminstState != '' ">
            AND ahi_123.ITEMINST_STATE = #{iteminstState}
        </if>
        <if test="instState != null and instState != '' ">
            AND tinst.INST_STATE = #{instState}
        </if>

        <if test="entrust">
            AND (
            <foreach collection="currentUserOrgIdList" item="item" index="index" open=" " separator=" " close=" ">

                <if test="index == 0">
                    (
                    ahi_123.APPROVE_ORG_ID = #{item}
                    OR
                    ahi_123.APPROVE_ORG_ID IN (
                    select t.PARENT_ORG_ID AS ORG_ID from
                    (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                    find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                    from opu_om_org,(select @id:=#{item}) vars
                    where @id is not null
                    )t where t.PARENT_ORG_ID is not null
                    )
                    )
                </if>
                <if test="index != 0">
                    OR (
                    ahi_123.APPROVE_ORG_ID = #{item}
                    OR
                    ahi_123.APPROVE_ORG_ID IN (
                    select t.PARENT_ORG_ID AS ORG_ID from
                    (select (select @id:=group_concat(PARENT_ORG_ID separator ',') from opu_om_org where
                    find_in_set(ORG_ID,@id)) PARENT_ORG_ID
                    from opu_om_org,(select @id:=#{item}) vars
                    where @id is not null
                    )t where t.PARENT_ORG_ID is not null
                    )
                    )
                </if>

            </foreach>
            )
        </if>

        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>

    <select id="listWindowItemOutScope" resultType="com.augurit.aplanmis.common.vo.conditional.TaskInfo">
        SELECT
        temp_123.*
        FROM
        (
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        NULL AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        theme.THEME_NAME themeName,
        aps_123.STAGE_NAME stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS TASK_ID ,
        aht_123.NAME_ taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_PAR_STAGEINST ahs_123 ON ahi_123.STAGEINST_ID = ahs_123.STAGEINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            where alog.OPS_WINDOW_ID = #{windowId}
            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
        LEFT JOIN AEA_PAR_STAGE aps_123 ON aps_123.STAGE_ID = ahs_123.STAGE_ID
        LEFT JOIN AEA_PAR_THEME_VER ver ON aps_123.THEME_VER_ID = ver.THEME_VER_ID
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        LEFT JOIN AEA_PAR_THEME theme ON theme.THEME_ID = ver.THEME_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '0'
            AND ahi_123.ITEMINST_STATE = '5'
            <if test="theme != null and theme != '' ">
                AND theme.THEME_ID = #{theme}
            </if>
            <include refid="baseConditionalQuery">
            </include>

            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID UNION
        SELECT
        ahi_123.ITEMINST_ID iteminstId,
        ahi_123.ITEMINST_ID AS busRecordId,
        ahap_123.APPLYINST_CODE applyinstCode,
        ahap_123.APPLYINST_ID applyinstId,
        ahap_123.CREATE_TIME applyTime,
        ahap_123.APPLYINST_SOURCE applySource,
        temp1.PROJ_NAME projName,
        temp1.LOCAL_CODE AS localCode,
        temp1.GCBM AS gcbm,
--         ali_123.LINKMAN_NAME linkmanName,
        CASE
        ahap_123.IS_SERIES_APPROVE
        WHEN '1' THEN
        '单项' ELSE '并联'
        END AS applyType,
        NULL AS themeName,
        NULL AS stageName,
        ahi_123.ITEMINST_NAME itemName,
        ahi_123.MODIFY_TIME dismissedTime,
        CONVERT ( MAX( aht_123.ID_ + 0 ), CHAR ) AS taskId,
        aht_123.NAME_ as taskName
        FROM
        AEA_HI_ITEMINST ahi_123
        LEFT JOIN AEA_HI_SERIESINST ahs_123 ON ahi_123.SERIESINST_ID = ahs_123.SERIESINST_ID
        LEFT JOIN AEA_HI_APPLYINST ahap_123 ON ahs_123.APPLYINST_ID = ahap_123.APPLYINST_ID
        <if test="entrust">
            INNER JOIN (
            SELECT
            DISTINCT alog.APPLYINST_ID
            FROM aea_log_apply_state_hist alog
            where alog.OPS_WINDOW_ID = #{windowId}
            )wi ON wi.APPLYINST_ID = ahap_123.APPLYINST_ID
        </if>
--         LEFT JOIN AEA_LINKMAN_INFO ali_123 ON ali_123.LINKMAN_INFO_ID = ahap_123.LINKMAN_INFO_ID
        <include refid="leftJoinApplyinstProj">
        </include>
        LEFT JOIN ACT_HI_TASKINST aht_123 ON aht_123.PROC_INST_ID_ = ahi_123.PROCINST_ID
        <where>
            ahi_123.IS_SERIES_APPROVE = '1'
            AND ahi_123.ITEMINST_STATE = '5'
            <include refid="baseConditionalQuery">
            </include>
            <if test="_databaseId == 'oracle'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND to_char(ahi_123.MODIFY_TIME , 'yyyy-mm-dd')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
            <if test="_databaseId == 'mysql'">
                <if test="dismissedStartTime != null and dismissedStartTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')>=  #{dismissedStartTime}   ]]>
                </if>
                <if test="dismissedEndTime != null and dismissedEndTime != '' ">
                    <![CDATA[ AND DATE_FORMAT(ahi_123.MODIFY_TIME , '%Y-%m-%d')<=  #{dismissedEndTime}   ]]>
                </if>
            </if>
        </where>
        GROUP BY
        ahi_123.ITEMINST_ID
        ) temp_123
        <where>
            <if test="keyword != null and keyword != '' ">
                AND (
                temp_123.projName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.applyinstCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.localCode LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.gcbm LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.itemName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                OR temp_123.stageName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
--                 OR temp_123.linkmanName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
                )
            </if>
        </where>
    </select>
</mapper>