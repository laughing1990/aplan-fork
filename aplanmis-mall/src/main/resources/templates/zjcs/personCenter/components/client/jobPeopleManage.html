<div id="jobPeopleManage" class="box normal-module-box job-people-manage" v-cloak
     v-loading.fullscreen.lock="mloading">
	<h2 class="box-tit">执业/职业人员管理
		<el-button class="top-handel-btn" type="primary" @click="addPeople">新增人员</el-button>
	</h2>
	<!-- 人员列表 -->
	<div class="pandel mt20" v-if="!isPeopleDetail">
		<el-form :model="searchForm" ref="searchForm" :inline="true">
			<el-row>
				<el-col :span="8">
					<el-form-item label="身份证号码：" prop="cardNo">
						<el-input v-model="searchForm.cardNo" placeholder="请输入身份证号" @blur="listAeaImServiceLinkmanByServiceId"></el-input>
					</el-form-item>
				</el-col>
				<el-col :span="8">
					<el-form-item label="审核情况：" prop="auditFlag">
						<el-select placeholder="请选择" v-model="searchForm.auditFlag" :popper-append-to-body="false">
							<el-option v-for="item in auditOptions" :key="item.value" :label="item.label" :value="item.value" @click.native="listAeaImServiceLinkmanByServiceId"></el-option>
						</el-select>
					</el-form-item>
				</el-col>
				<el-form-item>
					<el-button type="primary" @click="clearSearchForm">清空</el-button>
					<!--<el-button type="primary" @click="listAeaImServiceLinkmanByServiceId">查询</el-button>-->
				</el-form-item>
			</el-row>
		</el-form>
		<el-table :data="peopleList" class="scrollable mt20" border style="width: 100%;"
		          :header-cell-style="{background:'#f7f8fa'}">
			<el-table-column label="序号" width="80" align="center">
				<template scope="scope">{{scope.$index+1}}</template>
			</el-table-column>
			<el-table-column prop="linkmanName" label="姓名" width="100" align="center"></el-table-column>
			<el-table-column prop="linkmanCertNo" label="身份证号码"></el-table-column>
			<el-table-column label="证书列表">
				<template scope="scope">
					<div v-for="item in scope.row.certinsts">{{item.certinstName}}</div>
					<br/>
				</template>
			</el-table-column>
			<el-table-column prop="is_head" label="是否是项目负责人" align="center">
				<template slot-scope="scope">
					{{scope.row.isHead==1?'是':'否'}}
				</template>
			</el-table-column>
			<el-table-column prop="auditFlag" label="审核情况" width="100" align="center" :formatter="formatAudioFlag"></el-table-column>
			<el-table-column label="操作" width="80" align="center">
				<template scope="scope">
					<a class="a-color4879E4" href="javascript:;" @click="editPeople(scope.row)">查看</a>
				</template>
			</el-table-column>
		</el-table>
		<el-pagination background align="right" @size-change="peopleListSizeChange" @current-change="peopleListPageChange" :page-sizes="[10, 20, 30, 50]"
		               :page-size="peopleCheckData.pageSize" :current-page="peopleCheckData.pageNum"
		               layout="total,sizes, prev, pager, next, jumper" :total="peopleCheckData.total">
		</el-pagination>
	</div>

	<!-- 新增服务事项编辑-新增 -->
	<div class="pandel module-edit-pandel  mt20" v-else>
		<!-- 事项编辑区 -->
		<div style="width: 100%; " v-if="isPeoplePandelState == 1" v-bind="personInfo">
			<div class="info-header text-right mt20 clearfix">
				<el-button @click="peopleDetailReturnOne">返回上一级</el-button>
			</div>
			<!-- 项目title -->
			<div class="info-title">
				{{peopleDetailEditFlag ? '编辑':'新增'}}人员
			</div>
			<!-- 基本信息 -->
			<div class="info-item edit-item">
				<h2 class="item-title active" @click="expandProjectInfoItem"><i class="item-icon"></i>基本信息<i
						class="arrow-icon"></i></h2>
				<div class="item-detail edit-item-detail">
					<div class="row">
						<div class="col-md-6 form-item">
							<label><b class="red-cl">*</b>姓名</label>
							<div class="input-box input-handel-box" v-show="isEdit">
								<el-select placeholder="请选择" class="w-300" v-model="personInfo.linkmanInfoId" @change="choose(personInfo.linkmanInfoId)" :popper-append-to-body="false" filterable>
									<el-option v-for="item in allJobPeopleOptions" :key="item.linkmanInfoId" :label="item.linkmanName"
									           :value="item.linkmanInfoId">
									</el-option>
								</el-select>
								<a href="javascript:;" class="handel-btn" @click="addJobPeopleFromDialog">
									<i class="el-icon-circle-plus-outline"></i>
								</a>
								<a href="javascript:;" class="handel-btn" @click="editJobPeopleFromDialog">
									<i class="el-icon-edit-outline"></i>
								</a>
							</div>
							<span v-show="!isEdit">{{personInfo.linkmanName}}</span>
						</div>
						<div class="col-md-6 form-item">
							<label><b class="red-cl">*</b>身份证号码</label>
							<el-input class="w-300 mr20" placeholder="请输入身份证号" v-model="personInfo.linkmanCertNo" v-show="isEdit"/>
							<span v-show="!isEdit">{{personInfo.linkmanCertNo}}</span>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6 form-item">
							<label>联系电话</label>
							<el-input class="w-300 mr20" placeholder="请输入联系电话" v-model="personInfo.linkmanMobilePhone" v-show="isEdit"/>
							<span v-show="!isEdit">{{personInfo.linkmanMobilePhone}}</span>
						</div>
						<div class="col-md-6 form-item">
							<label>邮箱</label>
							<el-input class="w-300 mr20" placeholder="请输入邮箱" v-model="personInfo.linkmanMail" v-show="isEdit"/>
							<span v-show="!isEdit">{{personInfo.linkmanMail}}</span>
						</div>
					</div>
				</div>
			</div>

			<!-- 服务信息 -->
			<div class="info-item edit-item">
				<h2 class="item-title active" @click="expandProjectInfoItem"><i class="item-icon"></i>服务信息<i
						class="arrow-icon"></i></h2>
				<div class="item-detail edit-item-detail">
					<div class="row">
						<div class="col-md-6 form-item">
							<label><b class="red-cl">*</b>可提供服务的类型</label>
							<div class="input-box input-handel-box">
								<el-select placeholder="请选择" class="w-300" v-model="personInfo.serviceId" @change="chooseService" :popper-append-to-body="false">
									<el-option v-for="item in canProvideServiceOptions" :key="item.serviceId" :label="item.serviceName"
									           :value="item.serviceId">
									</el-option>
								</el-select>
							</div>
						</div>
						<div class="col-md-6 form-item">
							<label><b class="red-cl">*</b>从业时间</label>
							<div class="input-box input-handel-box" v-show="isEdit"><!--value-format="yyyy-MM-dd"-->
								<el-date-picker type="date" placeholder="选择日期" class="w-300" format="yyyy-MM-dd" v-model="personInfo.practiseDate">
								</el-date-picker>
							</div>
							<span v-show="!isEdit">{{personInfo.practiseDate}}</span>
						</div>
					</div>
					<div class="form-item">
						<label><b class="red-cl">*</b>是否是项目负责人</label>
						<div class="input-box input-radio">
							<el-radio-group v-model="personInfo.isHead">
								<el-radio label="1" value="1" key="1">是</el-radio>
								<el-radio label="0" value="0" key="0">否</el-radio>
							</el-radio-group>
						</div>
					</div>
				</div>
			</div>

			<!-- 附件材料 -->
			<div class="info-item edit-item">
				<h2 class="item-title active" @click="expandProjectInfoItem"><i
						class="item-icon item-fujian-icon"></i>附件材料<i class="arrow-icon"></i></h2>
				<div class="item-detail edit-item-detail">
					<el-button class="mt20" @click="addCertificate">添加证书</el-button>
					<el-button class="mt20" @click="listCertinstLibrary();">证照库</el-button>
					<el-table class="scrollable mt20" border style="width: 100%;" :data="jobPeopleDetailObj.certinstBVos"
					          :header-cell-style="{background:'#f7f8fa'}">
						<el-table-column prop="certinstCode" label="证书编码">
						</el-table-column>
						<el-table-column prop="certinstName" label="证书名称">
						</el-table-column>
						<el-table-column prop="qualName" label="所属资质">
						</el-table-column>
						<el-table-column prop="qualLevelName" label="等级">
						</el-table-column>
						<el-table-column label="证书列表" width="250">
							<template scope="scope">
								<p v-for="item in scope.row.certinstDetail">
									<a class="a-color4879E4" href="javascript:;"
									   @click="showDetailFormItem(item)">{{item.fileName}}</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<a class="debtn" style="color:red" href="javascript:;" @click="delOneEnclosure(item)">删除</a>
								</p>
							</template>
						</el-table-column>
						<el-table-column label="操作">
							<template scope="scope">
								<a class="a-color4879E4" href="javascript:;"
								   @click="editCertificate(scope.$index,scope.row)">编辑</a>
								<a class="a-color4879E4" href="javascript:;"
								   @click="delOneCertificate(scope.row)">删除</a>
							</template>
						</el-table-column>
					</el-table>
				</div>
			</div>
			<div class="text-center mt20">
				<el-button type="primary" @click="saveAeaLinkmanInfoFun">提交审核</el-button>
				<!-- <el-button>取消</el-button> -->
			</div>
		</div>
		<!-- 证书编辑区 -->
		<div style="width: 100%; " v-if="isPeoplePandelState == 2">
			<div class="info-header text-right mt20 clearfix">
				<el-button @click="certificateReturnOne">返回上一级</el-button>
			</div>
			<!-- 证书title -->
			<div class="info-title">
				{{certificateEditFlag ? '编辑':'新增'}}证书
			</div>
			<!-- 基本信息 -->
			<div class="info-item edit-item">
				<h2 class="item-title active" @click="expandProjectInfoItem"><i class="item-icon"></i>基本信息<i
						class="arrow-icon"></i></h2>
				<div class="item-detail edit-item-detail">
					<div class="form-item">
						<label><b class="red-cl">*</b>证书类型</label>
						<div class="input-box">
							<el-select placeholder="请选择" v-model="certificateDetailObj.certId" style="width: 100%;" :popper-append-to-body="false">
								<el-option v-for="item in addCertificateOptions" :key="item.certId"
								           :label="item.certName" :value="item.certId">
								</el-option>
							</el-select>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>证书编码</label>
						<div class="input-box date">
							<el-input class=" mr20" v-model="certificateDetailObj.certinstCode"/>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>证书名称</label>
						<div class="input-box date">
							<el-input class=" mr20" v-model="certificateDetailObj.certinstName"/>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>业务范围</label>
						<div class="input-box">
							<el-input class=" mr20" type="textarea" v-model="certificateDetailObj.managementScope"/>
						</div>
					</div>
					<div class="form-item mt20">
						<label style="line-height: 36px;margin-bottom: 0;"><b class="red-cl">*</b>有效期限</label>
						<div class="input-box clearfix">
							<div class="col-wd-5 date inlineblock-midd "><!--value-format="yyyy-MM-dd"-->
								<el-date-picker type="date" placeholder="选择日期" format="yyyy-MM-dd"
								                v-model="certificateDetailObj.termStart">
								</el-date-picker>
							</div>
							<div class="col-wd-1 md-label inlineblock-midd ">至</div>
							<div class="col-wd-5 date inlineblock-midd "><!--value-format="yyyy-MM-dd"-->
								<el-date-picker type="date" placeholder="选择日期" format="yyyy-MM-dd"
								                v-model="certificateDetailObj.termEnd">
								</el-date-picker>
							</div>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>资质</label>
						<div class="input-box">
							<el-select placeholder="请选择" style="width:100%;" v-model="certificateDetailObj.qualId" @change="getMajorTreeByQualId" :popper-append-to-body="false">
								<el-option v-for="item in serviceQual" :label="item.qualName" :value="item.qualId" :key="item.qualId"></el-option>
							</el-select>
						</div>
					</div>
					<div class="row mb20">
						<div class="col-md-12 form-item">
							<label @click="getTreeCheck"><b class="red-cl">*</b>所属专业</label>
							<div class="input-box major-tree-box">
								<div class="box-header-tool mb20">
									<el-button-group>
										<el-button class="quality-btn" type="primary" size="medium"
										           v-for="(item, index) in allSubordinateMajorData"
										           @click="selectTreeForQuality(item,index)">{{item.qualName}}
										</el-button>
									</el-button-group>

								</div>
								<el-tree ref="tree" :data="curSelectQualiTreeData" :props="treeProps" show-checkbox
								         :check-strictly="true" node-key="id">
								</el-tree>
							</div>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>等级</label>
						<div class="input-box input-radio">
							<el-radio-group v-model="certificateDetailObj.qualLevelId">
								<el-radio label="cd6ffb40-1123-4c0b-a726-76abae361f31">甲级</el-radio>
								<el-radio label="78bf88bb-6056-4095-b053-c0ee4bcea703">乙级</el-radio>
								<el-radio label="d251fdc1-6489-4a9a-946e-cb89f4bad73a">丙级</el-radio>
								<el-radio label="597da3a4-c69e-4e80-a6ab-b9ded332eb3c">不分等级</el-radio>
								<el-radio label="5655d405-ffdc-4339-8b6a-2e7d7f707bd2">不分级</el-radio>
							</el-radio-group>
						</div>
					</div>
					<div class="form-item mt20">
						<label><b class="red-cl">*</b>附件</label>
						<div class="input-box">
							<div class="upload-card">
								<div class="upload-btn">
									<el-upload class="enclosure-upload-ref inlineblock-midd" ref="enclosureUploadRef"
									           action="" :multiple="true" :on-change="enclosureFileSelectChange"
									           :on-remove="enclosureFileSelectRemove" :auto-upload="false">
										<el-button slot="trigger" size="medium" type="normal">上传文件</el-button>
									</el-upload>
									<span class="upload-tip">上传的附件不可超过10MB，禁止上传以下的附件类型：.exe,.sh,.bat,.com,.dll</span>
								</div>
								<ul class="pjfile-list">
									<li v-for="item in certificateDetailObj.certinstDetail">{{item.fileName}}<a
											class="debtn" href="javascript:;" @click="delOneEnclosure(item)">删除</a></li>
								</ul>
								<!-- <p class="note-txt mt-1">更新时间：2018年08月14日 21:58:20</p> -->
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="text-center">
				<el-button type="primary" @click="saveCertificateDetail">保存</el-button>
				<!-- <el-button @click="">取消</el-button> -->
			</div>
		</div>
	</div>
	<el-dialog title="证照库" :visible.sync="photoShop" width="960px" center>
		<el-button type="primary" @click="chooseCertinst">确定</el-button>
		<el-table class="scrollable mt20" border style="width: 100%;" :data="certinstShop"
		          :header-cell-style="{background:'#f7f8fa'}" @selection-change="handleSelectionChange">
			<el-table-column type="selection"></el-table-column>
			<el-table-column type="index" label="序号" width="50"></el-table-column>
			<el-table-column prop="certinstCode" label="证书编码" align="center">
			</el-table-column>
			<el-table-column prop="certinstName" label="证书名称">
			</el-table-column>
			<el-table-column prop="qualName" label="所属资质">
			</el-table-column>
			<el-table-column prop="qualLevelName" label="等级">
			</el-table-column>
			<el-table-column label="证书列表" width="250">
				<template slot-scope="scope">
					<p v-for="item in scope.row.certinstDetail">
						<a class="a-color4879E4" href="javascript:;"
						   @click="javascript:void(0);">{{item.fileName}}</a>
					</p>
				</template>
			</el-table-column>
			<el-table-column label="操作" align="center" width="150px">
				<template slot-scope="scope">
					<el-button type="text" class="btn-table" @click.native="deleteCertinst(scope.row)">
						删除
					</el-button>
				</template>
			</el-table-column>
		</el-table>
		<el-pagination
				background
				align="right"
				v-show="pagination2"
				:pager-count="5"
				@size-change="handleSizeChange2"
				@current-change="handleCurrentChange2"
				:page-sizes="[10, 20, 30, 50]"
				:page-size="certinstPage.pageSize"
				:current-page="certinstPage.pageNum"
				layout="total,sizes, prev, pager, next, jumper"
				:total="certinstPage.total">
		</el-pagination>
	</el-dialog>
	<!-- 人员新增-编辑模态框 -->
	<el-dialog :title="addEditJobPeopleDialogIsEdit ? '编辑从业人员':'新增从业人员'" :visible.sync="isShowAddEditJobPeopleDialog" width="700px" center>
		<el-form :model="addEditJobPeopleDialogFromData" :rules="addEditJobPeopleDialogFromRules" ref="ruleForm"
		         label-width="100px">
			<el-form-item label="姓名" prop="linkmanName">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanName"></el-input>
			</el-form-item>
			<el-form-item label="证件号" prop="linkmanCertNo">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanCertNo"></el-input>
			</el-form-item>
			<el-form-item label="手机号" prop="linkmanMobilePhone">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanMobilePhone"></el-input>
			</el-form-item>
			<el-form-item label="办公电话" prop="linkmanOfficePhon">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanOfficePhon"></el-input>
			</el-form-item>
			<el-form-item label="传真" prop="linkmanFax">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanFax"></el-input>
			</el-form-item>
			<el-form-item label="电子邮件" prop="linkmanMail">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanMail"></el-input>
			</el-form-item>
			<el-form-item label="联系地址" prop="linkmanAddr">
				<el-input v-model="addEditJobPeopleDialogFromData.linkmanAddr"></el-input>
			</el-form-item>
			<el-form-item label="备注" prop="linkmanMemo">
				<el-input type="textarea" v-model="addEditJobPeopleDialogFromData.linkmanMemo"></el-input>
			</el-form-item>
		</el-form>
		<span slot="footer" class="dialog-footer">
            <el-button @click="isShowAddEditJobPeopleDialog = false">取 消</el-button>
            <el-button type="primary" @click="saveLinkman">保存</el-button>
        </span>
	</el-dialog>
</div>
<script>
	// var ctx = "http://192.168.14.2:8084/aplanmis-mall/"    //振强
	// var ctx = "http://192.168.14.9:8084/aplanmis-mall/"  //泽浩
	// 人员详情初始数据
	var JOB_PEOPLE_DATAILOBJ = {
		certinstBVos: [], //证书list
	};
	// 证书详情初始数据
	var CERTIFICATE_DETAIL_OBJ = {
		certId: '', //证书类型
		certinstCode: '', //证书编码
		certinstName: '', //证书名称
		managementScope: '', //业务范围
		termStart: '', //有效期限-start
		termEnd: '', //有效期限-end
		majorId: [], //所属专业
		qualLevelId: '', //等级
		bscAttFileAndDirs: '', //附件列表
	};
	var module1 = new Vue({
		el: '#jobPeopleManage',
		mixins: [mixins],
		data: function () {
			return {
				// 证照库变量
				photoShop: false,
				// 证照库列表
				certinstShop: [],
				// 是否是可编辑
				isEdit: true,
				//身份证号
				cardNo: '',
				//审核情况
				auditflagSel: '',
				// 当前是否人员详情
				isPeopleDetail: false,
				// 证照库分页
				certinstPage: {
					pageNum: 1,
					pageSize: 10,
					total: 0
				},

				// 当前是否人员详情中的证书详情  1是人员详情  2，是证书详情页
				isPeoplePandelState: 1,

				pagination2: true,
				searchForm: {
					cardNo: '',
					auditFlag: ''
				},
				// 审核情况下拉选项
				auditOptions: [
					{value: '', label: '请选择'}, {
						value: '0',
						label: '审核失败'
					}, {
						value: '2',
						label: '审核中'
					}, {
						value: '1',
						label: '已审核'
					}],
				// 人员列表
				peopleList: [],
				// 人员列表-查询参数
				peopleCheckData: {
					pageSize: 10,
					pageNum: 1,
					total: 0,
					unitInfoId: '',
				},
				// 人员列表-总数
				peopleTotal: 0,

				// 当前人员详情页是否为编辑
				peopleDetailEditFlag: false,


				// 人员详情相关
				// 人员详情相关-detail
				jobPeopleDetailObj: {
					certinstBVos: [], //证书list
				},
				// 人员详情-姓名下拉框option
				allJobPeopleOptions: [],
				// 人员详情-是否展示人员模态框
				isShowAddEditJobPeopleDialog: false,
				// 人员详情-人员模态框是否编辑状态 false为添加，true为编辑
				addEditJobPeopleDialogIsEdit: false,
				// 人员详情-人员选择中模态框的表单数据
				addEditJobPeopleDialogFromData: {
					name: '',
					region: '',
				},
				//  人员详情-人员选择中模态框的表单数据-检验规则
				addEditJobPeopleDialogFromRules: {
					name: [{
						required: true,
						message: '请输入活动名称',
						trigger: 'blur'
					}],
					region: [{
						required: true,
						message: '请选择活动区域',
						trigger: 'change'
					}],
				},
				// 人员详情-可提供的服务类型options
				canProvideServiceOptions: [],


				// 证书详情相关
				// 证书详情-detail
				certificateDetailObj: {
					certId: '', //证书类型
					certinstCode: '', //证书编码
					certinstName: '', //证书名称
					managementScope: '', //业务范围
					termStart: '', //有效期限-start
					termEnd: '', //有效期限-end
					majorId: [], //所属专业
					qualLevelId: '', //等级
					qualId: '',//资质
					bscAttFileAndDirs: [], //附件列表
				},
				// 所属专业-树的数据
				subordinateMajorData: [],
				// 所属专业-树节点字段定义，child,name是后端接口数据
				treeProps: {
					children: 'child',
					label: 'name'
				},
				// 当前编辑的证书的索引
				curEditCertificateIndex: -1,
				// 证书详情-证书类型options
				addCertificateOptions: [],

				// 所属专业-所有的资质包括资质下的树
				allSubordinateMajorData: {},
				// 所属专业-当前选中资质的树的数据
				curSelectQualiTreeData: [],
				// 所属专业-当前选中资质的等级的数据options
				curSelectQualiRankDataOptions: [],
				// 附件相关
				// 已选择的附件-并为上传
				enclosureFileListArr: [],
				// 性别
				sex: '',
				//评估类型
				checkboxs: [{
					serviceId: '0',
					serviceName: '项目申请报告'
				}, {
					serviceId: '1',
					serviceName: '可行性研究报告'
				}, {
					serviceId: '2',
					serviceName: '项目建议书'
				}, {
					serviceId: '3',
					serviceName: '节能评估'
				}],
				// 企业信息
				unitInfo: '',
				// 联系人信息
				personInfo: {
					linkmanName: '',// 联系人
					linkmanCertNo: '',//身份证
					linkmanMobilePhone: '',//手机号
					linkmanMail: '',//邮箱
					serviceId: '', //服务类型
					practiseDate: '',//从业时间
					isHead: ''//是否负责人
				},
				// 资质列表
				serviceQual: [],
				//下拉选择信息
				choosenItem: {},
				// 新增还是修改
				postType: 1,
				//新增人员还是修改人员
				addOrEdit: '',
				//所选证照
				multipleSelection: []

			}
		},
		methods: {
			clearSearchForm: function () {
				//$refs['searchForm'].resetFields();;
				this.$refs['searchForm'].resetFields();
				this.listAeaImServiceLinkmanByServiceId();
			},
			init: function () {
				console.log('我是模块')
			},

			// 人员详情返回上一级
			peopleDetailReturnOne: function () {
				var ts = this;
				ts.isPeopleDetail = false;
				ts.isPeoplePandelState = 1; //返回人员列表时，默认将isPeoplePandelState重置为1
			},
			// 证书-返回上一级
			certificateReturnOne: function () {
				var ts = this;
				ts.isPeoplePandelState = 1; //当前事项-编辑面板重置为事项的详情
			},

			// 新增人员
			addPeople: function () {
				var ts = this;
				ts.postType = 1;
				ts.isEdit = true;
				ts.isPeopleDetail = true;
				ts.peopleDetailEditFlag = false; //当前为新增人员
				ts.jobPeopleDetailObj = JOB_PEOPLE_DATAILOBJ;
				ts.personInfo = new Object;
			},

			// 查看-编辑人员
			editPeople: function (row) {
				var ts = this;
				ts.postType = 0;
				ts.isEdit = false;
				ts.isPeopleDetail = true;
				ts.peopleDetailEditFlag = true; //当前为人员详情编辑
				ts.jobPeopleDetailObj = JSON.parse(JSON.stringify(row));
				ts.personInfo = JSON.parse(JSON.stringify(row));
				ts.personInfo.practiseDate = ts.dateFormat(ts.personInfo.practiseDate);
				ts.jobPeopleDetailObj.certinstBVos = JSON.parse(JSON.stringify(row)).certinsts || [];
				ts.choosenItem.linkmanName = ts.jobPeopleDetailObj.linkmanName;
				ts.choosenItem.linkmanInfoId = ts.jobPeopleDetailObj.linkmanInfoId;
				// ts.getAeaImMajorLevel();
			},
			// 格式化时间
			dateFormat: function (val) {
				var daterc = val;
				if (daterc != null) {
					var dateMat = new Date(parseInt(daterc));
					return formatDate(dateMat, 'yyyy-MM-dd')
				}
			},

			// 人员详情相关-姓名下拉框里的操作
			// 新增人员模态框-添加一个
			addJobPeopleFromDialog: function () {
				var ts = this;
				ts.addOrEdit = 'a';
				ts.isShowAddEditJobPeopleDialog = true;
				ts.addEditJobPeopleDialogIsEdit = false; //当前是人员模态框-新增
			},
			// 新增人员模态框-编辑一个
			editJobPeopleFromDialog: function () {
				var ts = this;
				ts.addOrEdit = 'e';

				if (!this.personInfo.linkmanInfoId) {
					ts.$message({
						message: '请先选择一名从业人员',
						type: 'error'
					});
					return;
				}
				ts.isShowAddEditJobPeopleDialog = true;
				ts.addEditJobPeopleDialogIsEdit = true; //当前是人员模态框-编辑

				ts.addEditJobPeopleDialogFromData = ts.choosenItem;
			},

			// 证书详情相关
			// 添加证书
			addCertificate: function () {
				var ts = this;
				// if(!this.personInfo.serviceId) {
				//   ts.$message({
				//     message: '请先选择服务类型',
				//     type: 'error'
				//   });
				//   return;
				// }
				ts.isPeoplePandelState = 2;
				ts.certificateEditFlag = false; //当前为添加证书
				ts.certificateDetailObj = CERTIFICATE_DETAIL_OBJ; //新增的的证书详情赋初始值


				ts.backToTop(); //body位置默认为返回顶部

				this.certificateDetailObj = new Object;
				this.getAeaCertInfo();
				this.listAeaImServiceQual();
				this.getMajorTreeByQualId();
			},
			// 编辑证书
			editCertificate: function (idx, row) {
				var ts = this;
				ts.isPeoplePandelState = 2;
				ts.certificateEditFlag = true; //当前为编辑证书
				ts.certificateDetailObj = row; //编辑的当前行的证书详情赋值
				ts.curEditCertificateIndex = idx; //编辑的当前行索引赋值

				ts.getAeaCertInfo();// 获取证书类型的下拉options
				ts.listAeaImServiceQual();//获取资质列表
				ts.getMajorTreeByQualId();//加载所属专业树的数据
				ts.backToTop(); //body位置默认为返回顶部
			},


			// 所属专业树-选中当前资质
			selectTreeForQuality: function (quality, idx) {
				var ts = this;
				ts.curSelectQualiTreeData = quality.majorTree; //当前选中的资质下树数据赋值
				ts.curSelectQualiRankDataOptions = quality.levelList; //当前选中的资质下等级的options数据赋值

				// 所属专业树获取成功后展开树并初始化
				ts.initMajorTree();
				// 所属专业树获取成功后-编辑时，对选中的树节点回显   certificateDetailObj
				if (ts.certificateDetailObj.majorId && ts.certificateDetailObj.majorId !== null) {
					ts.$refs.tree.setCheckedKeys(ts.certificateDetailObj.majorId);
				}
				// 所属专业树选中资质后的当前按钮变化
				var _curBtn = $('.major-tree-box').find('.quality-btn');
				_curBtn.eq(idx).addClass('el-button--primary');
				_curBtn.eq(idx).siblings().removeClass('el-button--primary');
			},
			// 获取所属专业人员树当中的选中节点数据
			getTreeCheck: function () {
				console.log(this.$refs.tree.getCheckedKeys());
				return this.$refs.tree.getCheckedKeys();
			},
			// 证书详情-所属专业树默认展开
			initMajorTree: function () {
				var ts = this;
				ts.$nextTick(function () {
					for (var i = 0; i < ts.$refs.tree.store._getAllNodes().length; i++) {
						ts.$refs.tree.store._getAllNodes()[i].expanded = true;
					}
				});
			},


			// 附件相关
			// 附件上传--before
			enclosureBeforeUpload: function (file) {
				var ts = this,
						file = file;
				var fileMaxSize = 1024 * 1024 * 10; // 10MB为最大限制
				// 文件类型
				// 检查文件类型
				var index = file.name.lastIndexOf(".");
				var ext = file.name.substr(index + 1);
				if (['exe', 'sh', 'bat', 'com', 'dll'].indexOf(ext) !== -1) {
					ts.$message({
						message: '请上传非.exe,.sh,.bat,.com,.dll文件',
					});
					return false;
				}
				;
				// 检查文件大小
				if (file.size > fileMaxSize) {
					ts.$message({
						message: '请上传大小在10M以内的文件',
					});
					return false;
				}
				;
				return true;
			},
			// 附件上传文件列表变动
			enclosureFileSelectChange: function (file, fileList) {
				console.log(fileList)
				var ts = this;
				ts.enclosureFileListArr = [];
				fileList.forEach(function (item) {
					ts.enclosureFileListArr.push(item.raw)
				})
			},
			// 附件上传文件列表移除某一项
			enclosureFileSelectRemove: function (file, fileList) {
				console.log(fileList)
				var ts = this;
				ts.enclosureFileListArr = [];
				fileList.forEach(function (item) {
					ts.enclosureFileListArr.push(item.raw)
				})
			},

			// 附件列表中删除掉一条数据
			delOneEnclosure: function (row) {
				var ts = this,
						_delData = {};
				confirmMsg('', '您确定删除当前附件吗？', function () {
					_delData.detailId = row.detailId;
					// test
					// ts.delOneEnclosureFrontSelf( _delData.detailId);
					// return;

					ts.mloading = true;
					request('', {
						url: ctx + 'supermarket/certinst/deleteAeaHiCertinstByDetailId.do',
						type: 'get',
						data: _delData
					}, function (res) {
						ts.mloading = false;
						if (res.success) {
							ts.delOneEnclosureFrontSelf(_delData.detailId);
							ts.$message({
								message: '删除成功！',
								type: 'success'
							});
						} else {
							ts.$message({
								message: '删除失败',
								type: 'error'
							});
						}
					}, function (msg) {
						ts.mloading = false;
						ts.$message({
							message: '删除失败',
							type: 'error'
						});
					});
				})
			},
			// 附件列表中删除接口调用后，成功后前端自己删除掉一条数据
			delOneEnclosureFrontSelf: function (enclosureId) {
				var ts = this;
				var _allEnclosure = ts.certificateDetailObj.certinstDetail; //所有的附件list
				var _idx = -1; //当前删除的附件索引
				for (var i = 0; i < _allEnclosure.length; i++) {
					var _tmpEnclosureId = _allEnclosure[i].fileId;
					if (enclosureId == _tmpEnclosureId) {
						_idx = i;
						break;
					}
				}
				console.log(_idx)
				if (_allEnclosure.length && _idx > -1) {
					ts.certificateDetailObj.certinstDetail.splice(_idx, 1);
				}
			},
			// 删除一条证书数据
			delOneCertificate: function (row) {
				var ts = this,
						_delData = {};

				confirmMsg('', '您确定删除当前证书吗？', function () {
					// _delData.detailId = row.bscAttDetails.length!=0?row.bscAttDetails[0].detailId : '';
					_delData.certinstId = row.certinstId;

					// test
					// ts.delOneCertificateFrontSelf(_delData.certinstId);
					// return;

					// ts.mloading = true;

					ts.delOneCertificateFrontSelf(_delData.certinstId);

					// request('', {
					//     url: ctx + 'supermarket/certinst/deleteAeaHiCertinstByCertinstId.do',
					//     type: 'post',
					//     data: _delData
					// }, function (res) {
					//     ts.mloading = false;
					//     if (res.success) {
					//         ts.delOneCertificateFrontSelf(_delData.certinstId);
					//         ts.$message({
					//             message: '删除成功！',
					//             type: 'success'
					//         });
					//     } else {
					//         ts.$message({
					//             message: '删除失败',
					//             type: 'error'
					//         });
					//     }
					// }, function (msg) {
					//     ts.mloading = false;
					//     ts.$message({
					//         message: '删除失败',
					//         type: 'error'
					//     });
					// });
				})
			},
			// 删除一条证书数据-接口成功后，前端自己删除对应证书
			delOneCertificateFrontSelf: function (certificateId) {
				var ts = this;

				var _allCertificate = ts.jobPeopleDetailObj.certinstBVos; //所有的证书List
				var _idx = -1; //当前删除的附件索引
				for (var i = 0; i < _allCertificate.length; i++) {
					var _tmpCertificateId = _allCertificate[i].certinstId;
					if (_tmpCertificateId == certificateId) {
						_idx = i;
						break;
					}
				}
				console.log(_idx);
				if (_allCertificate.length && _idx > -1) {
					ts.jobPeopleDetailObj.certinstBVos.splice(_idx, 1);
				}
			},
			// 获取首页信息
			listAeaImServiceLinkmanByServiceId: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/serviceLinkman/listAeaImServiceLinkmanByUnitInfoId.do',
					type: 'get',
					data: {
						// unitInfoId : this.unitInfo.unitInfos[0].unitInfoId,
						unitInfoId: this.unitInfo.unitId,
						cardNo: this.searchForm.cardNo,
						// auditFlag: this.auditflagSel,
						auditFlag: this.searchForm.auditFlag,
						pageNum: this.peopleCheckData.pageNum,
						pageSize: this.peopleCheckData.pageSize

					}
				}, function (res) {
					ts.mloading = false;
					if (res.rows) {
						ts.peopleList = res.rows;
						ts.peopleCheckData.total = res.total;
					} else {
						ts.$message({
							message: res.message,
							type: 'error'
						});
					}
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			// 首页表格切换页
			peopleListPageChange: function (val) {
				this.peopleCheckData.pageNum = val;
				this.listAeaImServiceLinkmanByServiceId();
			},
			// 首页表格切换大小
			peopleListSizeChange: function (val) {
				this.peopleCheckData.pageSize = val;
				this.listAeaImServiceLinkmanByServiceId();
			},
			// 获取所有从业人员
			getAeaLinkman: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/linkmanInfo/getAeaLinkmanInfoByUnitInfoId.do',
					type: 'get',
					data: {
						unitInfoId: this.unitInfo.unitId
					}
				}, function (res) {
					ts.mloading = false;
					// if (res.success) {
					ts.allJobPeopleOptions = res;
					// } else {
					//     ts.$message({
					//         message: '所有人员列表加载失败',
					//         type: 'error'
					//     });
					// }
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			// 获取服务类型
			getlistAeaImService: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/certinst/listAeaImService.do',
					type: 'get',
					data: {
						unitInfoId: this.unitInfo.unitId
					}
				}, function (res) {
					ts.mloading = false;
					// if (res.success) {
					ts.canProvideServiceOptions = res;
					ts.personInfo.serviceId = ts.canProvideServiceOptions[0].serviceId;
					// } else {
					//     ts.$message({
					//         message: '所有人员列表加载失败',
					//         type: 'error'
					//     });
					// }
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			// 选择服务类型
			chooseService: function (val) {
				var _this = this;
				// this.getAeaImMajorLevel();
			},
			//选择人员
			choose: function (value) {
				var _this = this;
				$.each(_this.allJobPeopleOptions, function (index, val) {
					if (val.linkmanInfoId == value) {
						_this.choosenItem = val;
					}
				});
				this.personInfo.linkmanMail = _this.choosenItem.linkmanMail;
				this.personInfo.linkmanCertNo = _this.choosenItem.linkmanCertNo;
				this.personInfo.linkmanMobilePhone = _this.choosenItem.linkmanMobilePhone;
			},
			// 获取材料列表
			getAeaImMajorLevel: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/certinst/getAeaImMajorLevelAndCertByServiceId.do',
					type: 'get',
					data: {
						serviceId: this.personInfo.serviceId,
						unitInfoId: this.unitInfo.unitId
					}
				}, function (res) {
					ts.mloading = false;
					// if (res.success) {
					ts.jobPeopleDetailObj = res;
					ts.jobPeopleDetailObj.certinstBVos = res.list;
					// } else {
					//     ts.$message({
					//         message: '所有人员列表加载失败',
					//         type: 'error'
					//     });
					// }
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			// 提交审核联系人信息
			saveAeaLinkmanInfoFun: function () {
				var ts = this;
				var arry = [];
				var ids = this.jobPeopleDetailObj.certinstBVos != null ? this.jobPeopleDetailObj.certinstBVos : this.jobPeopleDetailObj.certinsts;
				$.each(ids, function (index, val) {
					arry.push(val.certinstId);
				});
				// 校检
				if (this.choosenItem.linkmanName == '') {
					this.$message({
						message: '请选择联系人',
						type: 'error'
					});
					return false;
				}
				if (this.personInfo.linkmanCertNo == '') {
					this.$message({
						message: '请输入身份证号',
						type: 'error'
					});
					return false
				}
				if (this.personInfo.linkmanMobilePhone == '') {
					this.$message({
						message: '请输入联系电话',
						type: 'error'
					});
					return false
				}
				if (this.personInfo.linkmanMail == '') {
					this.$message({
						message: '请输入邮箱',
						type: 'error'
					});
					return false
				}
				if (this.personInfo.serviceId == '') {
					this.$message({
						message: '请选择服务类型',
						type: 'error'
					});
					return false
				}
				if (this.personInfo.isHead == '') {
					this.$message({
						message: '请选择是否项目负责人',
						type: 'error'
					});
					return false
				}
				if (this.personInfo.practiseDate == '') {
					this.$message({
						message: '请选择从业时间',
						type: 'error'
					});
					return false
				}
				if (!arry.length) {
					this.$message({
						message: '请选择添加证书',
						type: 'error'
					});
					return false
				}
				ts.mloading = true;

				var param = {
					linkmanInfoId: this.choosenItem.linkmanInfoId,
					linkmanName: this.choosenItem.linkmanName,
					linkmanType: 'u',
					linkmanCertNo: this.personInfo.linkmanCertNo,
					linkmanMobilePhone: this.personInfo.linkmanMobilePhone,
					linkmanMail: this.personInfo.linkmanMail,
					serviceId: this.personInfo.serviceId,
					practiseDate: this.personInfo.practiseDate,
					isHead: this.personInfo.isHead,
					unitInfoId: this.unitInfo.unitId,
					certinstId: arry.join(","),
					serviceLinkmanId: this.personInfo.serviceLinkmanId ? this.personInfo.serviceLinkmanId : ''
				}
				request('', {
					url: ctx + 'supermarket/linkmanInfo/saveAeaLinkmanInfo.do',
					type: 'post',
					data: param
				}, function (res) {
					ts.mloading = false;
					ts.listAeaImServiceLinkmanByServiceId();
					if (res.success) {
						ts.$message({
							message: '提交审核成功',
							type: 'success'
						});
					} else {
						ts.$message({
							message: '提交审核失败',
							type: 'error'
						});
					}
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},

			// 点击dialog查看某一条证书列表的详情
			showDetailFormItem: function (item) {
				var ts = this;
				window.open(ctx + 'file/showFile.do?detailId=' + item.fileId);
			},

			//获取证书类型
			getAeaCertInfo: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/cert/getAeaCertInfo.do',
					type: 'get',
					data: {}
				}, function (res) {
					ts.mloading = false;
					ts.addCertificateOptions = res;
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			//获取资质列表
			listAeaImServiceQual: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/certinst/listAeaImServiceQual.do',
					type: 'get',
					data: {
						serviceId: this.personInfo.serviceId
					}
				}, function (res) {
					ts.mloading = false;
					ts.serviceQual = res;
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			//获取资质证书树
			getMajorTreeByQualId: function () {
				var ts = this;
				ts.mloading = true;
				request('', {
					url: ctx + 'aea/supermarket/serviceMatter/getMajorTreeByServiceId.do',
					type: 'post',
					data: {
						serviceId: this.personInfo.serviceId
					}
				}, function (res) {
					ts.mloading = false;
					ts.allSubordinateMajorData = res;
					// 初始化树-默认选中第一个资质
					setTimeout(function () {
						$('.major-tree-box').find('.quality-btn').eq(0).trigger(
								'click');
					}, 0)
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			//保存/修改联系人信息
			saveLinkman: function () {
				var ts = this;
				var param = {
					unitInfoId: this.unitInfo.unitId,
					linkmanName: this.addEditJobPeopleDialogFromData.linkmanName,
					linkmanCertNo: this.addEditJobPeopleDialogFromData.linkmanCertNo,
					linkmanMobilePhone: this.addEditJobPeopleDialogFromData.linkmanMobilePhone,
					linkmanOfficePhon: this.addEditJobPeopleDialogFromData.linkmanOfficePhon,
					linkmanType: 'u',
					linkmanFax: this.addEditJobPeopleDialogFromData.linkmanFax,
					linkmanMail: this.addEditJobPeopleDialogFromData.linkmanMail,
					linkmanAddr: this.addEditJobPeopleDialogFromData.linkmanAddr,
					linkmanMemo: this.addEditJobPeopleDialogFromData.linkmanMemo,
				}
				if (ts.addOrEdit == "e") {
					param.linkmanInfoId = this.addEditJobPeopleDialogFromData.linkmanInfoId;
				}
				ts.mloading = true;
				request('', {
					url: ctx + 'supermarket/linkmanInfo/saveLinkman.do',
					type: 'post',
					data: param
				}, function (res) {
					ts.isShowAddEditJobPeopleDialog = false;
					ts.getAeaLinkman();
					ts.$message({
						message: '保存成功',
						type: 'success'
					});

					ts.$refs.ruleForm.resetFields()
				}, function (msg) {
					ts.mloading = false;
					ts.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},

			// 证书详情的取消操作
			cancelCertificateDetail: function () {
				this.isPeoplePandelState = 1;
			},
			// 证书详情的保存操作
			saveCertificateDetail: function () {
				var ts = this,
						_canSaveFlag = true,
						_saveData = {};
				ts.certificateDetailObj.majorId = ts.getTreeCheck(); //获取所属专业树当中选中的专业id

				_saveData = {
					certId: '', //证书类型
					certinstCode: '', //证书编码
					certinstName: '', //证书名称
					managementScope: '', //业务范围
					termStart: '', //有效期限-start
					termEnd: '', //有效期限-end
					qualId: '',//资质
					majorId: [], //所属专业
					qualLevelId: '', //等级
					// bscAttFileAndDirs: [], //附件列表
				};
				for (var k in _saveData) {
					_saveData[k] = ts.certificateDetailObj[k];
				}

				if (_saveData.certId === null || !_saveData.certId.length) {
					return ts.$message({
						message: '请选择证书类型！'
					})
				}
				if (_saveData.qualId === null || !_saveData.qualId.length) {
					return ts.$message({
						message: '请选择资质！'
					})
				}
				if (_saveData.certinstCode === null || !_saveData.certinstCode.length) {
					return ts.$message({
						message: '请填写证件编码！'
					})
				}
				if (_saveData.certinstName === null || !_saveData.certinstName.length) {
					return ts.$message({
						message: '请填写证件名称！'
					})
				}
				if (_saveData.managementScope === null || !_saveData.managementScope.length) {
					return ts.$message({
						message: '请填写业务范围！'
					})
				}
				//new Date(Date.parse(str.replace(/-/g,"/")));
				/*if (_saveData.termStart === null || !_saveData.termStart.length || _saveData.termEnd ===
						null || !_saveData.termEnd.length) {
					return ts.$message({
						message: '请选择有效期限！'
					})
				} else {
					if (_saveData.termEnd < _saveData.termStart) {
						return ts.$message({
							message: '有效期限起始时间不能大于结束时间！'
						})
					}
				}*/
				if (_saveData.majorId === null || !_saveData.majorId.length) {
					return ts.$message({
						message: '请选择所属专业！'
					})
				}
				if (_saveData.qualLevelId !== null && !_saveData.qualLevelId.length) {
					return ts.$message({
						message: '请选择等级！'
					})
				}
				// if (_saveData.bscAttFileAndDirs !== null && !_saveData.bscAttFileAndDirs.length && ts
				//     .certificateEditFlag) {
				//     return ts.$message({
				//         message: '请选择上传文件！'
				//     })
				// }

				// 新增证书并且没有打算选择上传文件
				if (!ts.enclosureFileListArr.length && !ts.certificateEditFlag) {
					return ts.$message({
						message: '请上传文件附件！'
					})
				}
				// 校验文件是否能上传
				if (ts.enclosureFileListArr.length) {
					var _fileCanUpload = true;
					for (var i = 0; i < ts.enclosureFileListArr.length; i++) {
						if (!ts.enclosureBeforeUpload(ts.enclosureFileListArr[i])) {
							_fileCanUpload = false;
							break;
						}
					}
					if (!_fileCanUpload) return ts.$message({
						message: '请上传非.exe,.sh,.bat,.com,.dll文件'
					});
				}
				// 如果是证书实例编辑,带上当前编辑证书的certinstId
				if (ts.certificateEditFlag) {
					_saveData.certinstId = ts.certificateDetailObj.certinstId;
				}
				// 带上unitId
				_saveData.unitInfoId = this.unitInfo.unitId;

				// return;
				var formData = new FormData();
				for (var k in _saveData) {
					formData.append(k, _saveData[k])
				}

				ts.enclosureFileListArr.forEach(function (item) {
					formData.append('file', item)
				})
				// return;

				ts.mloading = true;
				$.ajax({
					url: ctx + 'supermarket/certinst/uploadAeaHiCertinstFile.do',
					type: 'post',
					data: formData,
					contentType: false,
					processData: false,
					// mimeType: "multipart/form-data",
					success: function (res) {
						ts.mloading = false;
						if (res.success) {
							// 保存成功后将当前保存的证书实例添加到事项详情的证书列表中，若为编辑保存，则替换
							if (!ts.certificateEditFlag) {
								ts.jobPeopleDetailObj.certinstBVos.push(res.content)
							} else {
								ts.jobPeopleDetailObj.certinstBVos.splice(ts
										.curEditCertificateIndex, res.content)
							}
							// 保存成功后返回事项详情
							ts.cancelCertificateDetail();
							// 保存成功后将需要上传的附件文件列表清空
							ts.enclosureFileListArr = [];
							ts.$message({
								message: '保存成功',
								type: 'success'
							});
						} else {
							ts.$message({
								message: '保存失败',
								type: 'error'
							});
						}
					},
					error: function (msg) {
						ts.mloading = false;
						ts.$message({
							message: '保存失败',
							type: 'error'
						});
					},
				})
			},
			handleSizeChange2: function (val) {
				this.certinstPage.pageSize = val;
				this.listCertinstLibrary();
			},
			handleCurrentChange2: function (val) {
				this.certinstPage.pageNum = val;
				this.listCertinstLibrary();
			},
			handleSelectionChange: function (val) {
				this.multipleSelection = val;
			},
			// 获取证照库
			listCertinstLibrary: function () {
				var _this = this;
				_this.loading = true;

				// 判断是否为空
				if ($.isEmptyObject(_this.choosenItem)) {
					_this.$message({
						message: '请先选择联系人',
						type: 'error'
					});
					return;
				}
				_this.photoShop = true;
				request('', {
					url: ctx + 'supermarket/certinst/listCertinstLibrary',
					type: 'get',
					xhrFields: {
						withCredentials: true
					},
					data: {
						type: 2,
						typeId: _this.choosenItem.linkmanInfoId,
						// typeId: 'd41815e0-03d9-4b6f-8eb9-90c26c5fd968',
						pageNum: this.certinstPage.pageNum,
						pageSize: this.certinstPage.pageSize
					}
				}, function (res) {
					if (_this.certinstPage.total > 10) {
						_this.pagination2 = true;
					} else {
						_this.pagination2 = false;
					}
					_this.loading = false;
					_this.certinstShop = res.content.rows;
					_this.certinstPage.total = res.content.total;
				}, function (msg) {
					_this.mloading = false;
					_this.$message({
						message: '加载失败',
						type: 'error'
					});
				});
			},
			//添加证照到联系人
			chooseCertinst: function () {
				var _this = this;
				if (this.multipleSelection.length == 0) {
					_this.$message({
						message: '请先选择证照',
						type: 'error'
					});
					return;
				}
				$.each(this.multipleSelection, function (index, val) {
					for (var i = 0, list = _this.jobPeopleDetailObj.certinstBVos; i < list.length; i++) {
						if (list[i].certinstId == val.certinstId) {
							var repeat = true;
							_this.$message({
								message: '所选证照已存在，请重新选择',
								type: 'error'
							});
							return;
						} else {
							var repeat = false;
						}
					}
					if (!repeat) {
						_this.jobPeopleDetailObj.certinstBVos.push(val);
						_this.photoShop = false;
					}
				});

			},
			// 删除证照
			deleteCertinst: function (data) {
				var _this = this;
				confirmMsg('', '确定删除该证照吗？', function () {
					request('', {
						url: ctx + 'supermarket/certinst/deleteCertinst',
						type: 'post',
						data: {
							certinstId: data.certinstId
						}
					}, function (res) {
						_this.$message({
							message: '删除成功',
							type: 'success'
						});
						_this.listCertinstLibrary();
					}, function (msg) {
						_this.mloading = false;
						_this.$message({
							message: '删除失败',
							type: 'error'
						});
					});
				})

			},
			//格式化审核状态
			formatAudioFlag: function (row, column, cellValue, index) {
				switch (cellValue) {
					case '0':
						return '审核失败';
					case '1':
						return '已审核';
					case '2':
						return '审核中';
					default:
						return '审核中';
				}
			},

		},

		created: function () {
			this.unitInfo = JSON.parse(localStorage.getItem('loginInfo'))
			this.getAeaLinkman();
			this.getlistAeaImService();
			this.listAeaImServiceLinkmanByServiceId();
		},
		mounted: function () {
			this.init();
		},
	})
</script>