<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>事项一单清</title>
    <link rel="stylesheet" href="../../static/mall/css/listmatter/listmatter.css" th:href="@{/mall/skin_v4.1/css/listmatter/listmatter.css}">
</head>
<body>
    <div id="listmatter" class="listmatter">
        <div v-show="!contentLoading">
            <section>
                <div class="wt-content">
                     <div class="local-main">
                         <span class="local-icon"></span>
                         <span class="local-span"><img width="20" height="20" src="../../static/mall/images/guide/u736.png" th:src="@{/mall/skin_v4.1/images/listmatter/u391.svg}" /></span>
                         <a class="local-a" :href="ctx+'rest/main/toIndexPage'">首页</a>
                         <span class="local-span">&gt;</span>
                         <a class="local-a" :href="ctx+'rest/main/toIndexPage'"> 报建指引</a>
                         <span class="local-span">&gt;</span>
                         <a class="local-a active" href="javascript:void(0);" >事项一单清 </a>
                     </div>
                </div>
                <div class="back" @click="gotoGuideIndex">
                  返回
                </div>
            </section>
            <section>
                <div class="matter-title-wrapper clearfix">
                    <div class="fl" style="margin-left:25px;margin-top: 25px;">
                        <p class="matter-title">{{listmatterData.themeName}}</p>
                        <p class="matter-title-intro" style="margin-top: 10px;">
                            <span>申请阶段：{{listmatterData.stageName}}</span>
                            <span style="margin-left: 10px;">阶段时限：{{listmatterData.dueNum}}个工作日</span>
                        </p>
                    </div>
                    <div class="fr" style="margin-top: 35px;margin-right: 30px;">
                        <a href="javascript:;" class="matter-title-right-btn">查看项目报建流程</a>
                    </div>
                </div>
            </section>

            <section>
                <div class="wt-collapse-box" @click="show1 = !show1">
                    <div class="wt-collapse clearfix">
                        <div class="fl"><span class="wt-collapse-title">事项一单清</span> <span class="wt-collapse-title-des" v-show="listmatterData.handWay == 1">（我还不知道怎么选事项，我需要<a href="javascript:;" @click.stop="openAILeadDia" style="color: #4293F4;">智能引导</a>。）</span></div>
                        <div class="fr">
                            <img width="27" height="16" th:src="@{/mall/skin_v4.1/images/icon/u370.png}" />
                        </div>
                    </div>
                </div>
                <el-collapse-transition>
                <div class="parallel" v-show="show1">
                    <div class="p-header-phase1">并联事项</div>
                    <div class="parallel-table" style="margin-bottom: 40px">
                        <el-table
                                :data="parallelItemList"
                                border
                                @select="selectParallelItem"
                                ref="parallelItematable"
                                style="width: 100%">
                            <el-table-column
                                   type="selection"
                                   :selectable='selectable'
                                   align="center"
                                    width="50">
                            </el-table-column>
                            <el-table-column
                                    prop="itemName"
                                    label="事项名称"
                                    >
                                <template slot-scope="scope">
                                    <div>
                                        <span>
                                            <p class="parallel-title">{{scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.itemName}}</p>
                                            <p class="parallel-title-intro">
                                                <span>审批部门：{{scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.orgName||'-'}}</span>
                                                <span>审批时限：{{scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.dueNum||5}}个工作日</span>
                                                <span style="margin-left: 20px;">结果物：
                                                    <span v-if="scope.row.resultMats">
                                                        <el-tooltip class="item" effect="dark" content="" placement="top">
                                                            <span class="tooltip-span">{{scope.row.resultMats.length}}个</span>
                                                            <span slot="content">
                                                                <span v-for="item in scope.row.resultMats" class="result-item">{{item.aeaMatCertName}}</span>
                                                            </span>
                                                        </el-tooltip>
                                                    </span>
                                                    <span>暂无</span>
                                                </span>
                                            </p>
                                        </div>
                                        <div v-if="scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.paraStateList && scope.row.currentCarryOutItem.paraStateList.length > 0">
                                            <list :list="scope.row.currentCarryOutItem.paraStateList"></list>
                                        </div>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="isDoneItem"
                                    sortable
                                    label=" 是否必办"
                                    width="160">
                                <template slot-scope="scope">
                                    <div>
                                        <span v-if="scope.row.isDoneItem == 1">必办</span>
                                        <span v-else>选办</span>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="address"
                                    label=" 审批层级"
                                    width="160">
                                    <template slot-scope="scope">
                                        <div v-if="scope.row.isCatalog==1">
                                            <template v-if="scope.row.carryOutItems&&scope.row.carryOutItems.length>0">
                                                <el-select :disabled="scope.row.disabled" v-model="scope.row.currentCarryOutItem.itemVerId"
                                                           placeholder="请选择活动区域">
                                                    <el-option v-for="(item,indexOp) in scope.row.carryOutItems"
                                                               :key="indexOp"
                                                               :label="item.regionName"
                                                               @click.native="currentItemVerIdChangehandle(item,scope.$index)"
                                                               :value="item.itemVerId"></el-option>
                                                </el-select>
                                            </template>
                                            <template v-else>
                                                <el-select disabled="disabled" value="" placeholder="请选择活动区域">
                                                    <el-option value="请选择活动区域"></el-option>
                                                </el-select>
                                            </template>
                                        </div>
                                        <div v-else>
                                            <span>{{scope.row.regionName}}</span>
                                        </div>
                                    </template>
                            </el-table-column>
                        </el-table>
                    </div>
                    <div class="p-header-phase1">并行推进事项</div>
                    <div class="parallel-table" style="margin-bottom: 40px">
                        <el-table
                                :data="coreItemList"
                                border
                                @select="selectCoreItem"
                                ref="coreItemListTable"
                                style="width: 100%">
                            <el-table-column
                                    type="selection"
                                    align="center"
                                    width="50">
                            </el-table-column>
                            <el-table-column
                                    prop="itemName"
                                    label="事项名称"
                            >
                                <template slot-scope="scope">
                                    <div>
                                        <div>
                                            <p class="parallel-title">{{scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.itemName}}</p>
                                            <p class="parallel-title-intro">
                                                <span>审批时限：{{scope.row.currentCarryOutItem.dueNum||5}}个工作日</span>
                                                <span style="margin-left: 20px;">结果物：
                                                    <span v-if="scope.row.resultMats">
                                                        <el-tooltip class="item" effect="dark" content="" placement="top">
                                                            <span class="tooltip-span">{{scope.row.resultMats.length}}个</span>
                                                            <span slot="content">
                                                                <span v-for="item in scope.row.resultMats" class="result-item">{{item.aeaMatCertName}}</span>
                                                            </span>
                                                        </el-tooltip>
                                                    </span>
                                                    <span>暂无</span>
                                                </span>
                                            </p>
                                        </div>
                                      <!--  <div v-if="paraStateList && paraStateList.lenght>0">
                                            <div>
                                                <p class="situation-title"><span class="situation">情形</span>属于踏勘论证范围或按规定应当进行节地评价的提交：</p>
                                                <p class="situation-title-intro">
                                                    <el-radio v-model="radio" label="1">是</el-radio>
                                                    <el-radio v-model="radio" label="2">否</el-radio>
                                                </p>
                                            </div>
                                        </div>-->
                                        <div v-if="scope.row.currentCarryOutItem && scope.row.currentCarryOutItem.coreStateList && scope.row.currentCarryOutItem.coreStateList.length > 0">
                                            <list :list="scope.row.currentCarryOutItem.coreStateList"></list>
                                        </div>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="isDoneItem"
                                    sortable
                                    label=" 是否必办"
                                    width="160">
                                <template slot-scope="scope">
                                    <div>
                                        <span v-if="scope.row.isDoneItem == 1">必办</span>
                                        <span v-else>选办</span>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="address"
                                    label=" 审批层级"
                                    width="160">
                                <template slot-scope="scope">
                                    <div v-if="scope.row.isCatalog==1">
                                        <template v-if="scope.row.carryOutItems&&scope.row.carryOutItems.length>0">
                                            <el-select :disabled="scope.row.disabled" v-model="scope.row.currentCarryOutItem.itemVerId" @change="currentItemVerIdChangehandle"
                                                       placeholder="请选择活动区域">
                                                <el-option v-for="(item,indexOp) in scope.row.carryOutItems"
                                                           :key="indexOp"
                                                           :label="item.regionName"
                                                           :value="item.itemVerId"></el-option>
                                            </el-select>
                                        </template>
                                        <template v-else>
                                            <el-select disabled="disabled" value="" placeholder="请选择活动区域">
                                                <el-option value="请选择活动区域"></el-option>
                                            </el-select>
                                        </template>
                                    </div>
                                    <div v-else>
                                        <span>{{scope.row.regionName}}</span>
                                    </div>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
                </el-collapse-transition>
            </section>

            <!-- 一张表单 section-->
            <section>
                <div class="wt-collapse-box" @click="show2 = !show2">
                    <div class="wt-collapse clearfix">
                        <div class="fl"><span class="wt-collapse-title">一张表单</span></div>
                        <div class="fr">
                            <span class="expandPDF">导出PDF</span>
                            <img width="27" height="16" th:src="@{/mall/skin_v4.1/images/icon/u370.png}" />
                        </div>
                    </div>
                </div>
                <el-collapse-transition>
                <div class="formArea" v-show="show2">

                </div>
                </el-collapse-transition>
            </section>

            <!-- 一套材料 section-->
            <section v-loading="materialLoading">
                <div class="wt-collapse-box" @click="show3 = !show3">
                    <div class="wt-collapse clearfix">
                        <div class="fl"><span class="wt-collapse-title">一套材料</span> </div>
                        <div class="fr">
                            <img width="27" height="16" th:src="@{/mall/skin_v4.1/images/icon/u370.png}" />
                        </div>
                    </div>
                </div>
                <el-collapse-transition>
                <div class="parallel" v-show="show3">
                    <div class="p-header-phase1">必选材料（{{requireMat.length}}）</div>
                    <div class="Material-table" style="margin-bottom: 40px">
                        <el-table
                                :data="requireMat"
                                style="width: 100%">
                            <el-table-column
                                    type="index"
                                    label="序号"
                                    align="center"
                                    width="80">
                            </el-table-column>
                            <el-table-column
                                    prop="matName"
                                    label="材料名称"
                                   >
                                <template slot-scope="scope">
                                    <div>
                                        <span>{{scope.row.matName}}</span>
                                      <!--  <span class="material-sing">电子证照</span>-->
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="matMemo"
                                    align="center"
                                    label="全程网办接件标准"
                                    width="180">
                                <template slot-scope="scope">
                                    <el-tooltip placement="top" effect="light">
                                        <div slot="content">{{scope.row.matMemo||'暂无'}}</div>
                                        <img width="18" height="18" th:src="@{/mall/skin_v4.1/images/listmatter/u450.png}" />
                                    </el-tooltip>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="matFrom"
                                    label="材料来源">
                            </el-table-column>
                            <el-table-column
                                    prop=" matProp"
                                    label="材料类别">
                                <template slot-scope="scope">
                                    <span v-if="scope.row.matProp=='m'">普通材料</span>
                                    <span v-else-if="scope.row.matProp=='c'">证照材料</span>
                                    <span v-else-if="scope.row.matProp=='f'">在线表单</span>
                                    <span v-else>-</span>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop=""
                                    label="是否签章"
                                    width="80px">
                                <template slot-scope="scope">
                                   <span>是</span>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    align="center"
                                    prop="address"
                                    label="资料下载">
                                <template slot-scope="scope">
                                    <div>
                                        <el-button type="text" class="text-table">空表下载</el-button>
                                    </div>
                                    <div>
                                        <el-button type="text" class="text-table">样表下载</el-button>
                                    </div>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                    <div class="p-header-phase1">可选材料（{{noRequireMat.length}}）</div>
                    <div class="Material-table">
                        <el-table
                                :data="noRequireMat"
                                style="width: 100%">
                            <el-table-column
                                    type="index"
                                    label="序号"
                                    align="center"
                                    width="80">
                            </el-table-column>
                            <el-table-column
                                    prop="matName"
                                    label="材料名称"
                            >
                                <template slot-scope="scope">
                                    <div>
                                        <span>{{scope.row.matName}}</span>
                                        <!--  <span class="material-sing">电子证照</span>-->
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="matMemo"
                                    align="center"
                                    label="全程网办接件标准"
                                    width="180">
                                <template slot-scope="scope">
                                    <el-tooltip placement="top" effect="light">
                                        <div slot="content">{{scope.row.matMemo||'暂无'}}</div>
                                        <img width="18" height="18" th:src="@{/mall/skin_v4.1/images/listmatter/u450.png}" />
                                    </el-tooltip>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="matFrom"
                                    label="材料来源">
                            </el-table-column>
                            <el-table-column
                                    prop=" matProp"
                                    label="材料类别">
                                <template slot-scope="scope">
                                    <span v-if="scope.row.matProp=='m'">普通材料</span>
                                    <span v-else-if="scope.row.matProp=='c'">证照材料</span>
                                    <span v-else-if="scope.row.matProp=='f'">在线表单</span>
                                    <span v-else>-</span>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop=""
                                    label="是否签章"
                                    width="80px">
                                <template slot-scope="scope">
                                    <span v-if="scope.row.isSign == 1">是</span>
                                    <span v-else>否</span>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    align="center"
                                    prop="address"
                                    label="资料下载">
                                <template slot-scope="scope">
                                    <div>
                                        <el-button type="text" class="text-table"  @click="showMatFiles(scope.row,'TEMPLATE_DOC')">空表下载</el-button>
                                    </div>
                                    <div>
                                        <el-button type="text" class="text-table"  @click="showMatFiles(scope.row,'SAMPLE_DOC')">样表下载</el-button>
                                    </div>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
                </el-collapse-transition>
            </section>

            <!--<div class="declare-btn-box">
                <a href="#" class="declare-btn">我要申报</a>
            </div>-->
        </div>
        <!-- 事项阶段智能引导dialog -->
        <el-dialog title="智能引导" :visible.sync="AIleadDialogFlag" width="800px" >
            <div class="AIleadCon">
                <template v-if="stateList&&stateList.length>0">
                    <p class="title">请您回答一下问题完成选择事项的引导：</p>
                    <div class="stateList-form">
                        <el-form :model="stateSelVal" v-if="stateList&&stateList.length>0">
                            <el-form-item :required="item.mustAnswer==1"
                                          v-for="(item,index) in stateList"
                                          :key="index"
                                          :label="item.stateName">
                                <p class="status-label">
                                    <el-tooltip class="item" effect="light" :content="item.stateMemo?item.stateMemo:'无'" placement="right">
                                        <i class="el-icon-question"></i>
                                    </el-tooltip>
                                </p>
                                <template v-if="item.answerType=='s'||item.answerType=='y'">
                                    <el-radio-group v-model="item.selectAnswerId">
                                        <el-radio v-for="(itemAns,ind) in item.answerStates"
                                                  :key="ind"
                                                  @change="getChildsStateList(stateList,item,itemAns,index,'true1')"
                                                  :value="itemAns.parStateId"
                                                  :label="itemAns.parStateId" name="answer">{{itemAns.stateName}}</el-radio>
                                    </el-radio-group>
                                </template>
                                <template v-else>
                                    <el-checkbox-group v-model="item.selectAnswerId"
                                                       >
                                        <el-checkbox v-for="(itemAns,indAns) in item.answerStates"
                                                     :key="indAns"
                                                     :value="itemAns.parStateId"
                                                     @change="function(value) {getChildsStateList(stateList,item,itemAns,index,value)}"
                                                     :label="itemAns.parStateId" name="answer">{{itemAns.stateName}}</el-checkbox>
                                    </el-checkbox-group>
                                </template>
                            </el-form-item>
                        </el-form>
                    </div>
                </template>
                <template v-else>
                    <div style="padding: 50px;font-size: 18px;">暂无引导信息</div>
                </template>
            </div>
            <div slot="footer" class="dialog-footer">
                <el-button type="primary" @click="startAILeadFn">开始引导</el-button>
            </div>
        </el-dialog>
        <div v-loading="contentLoading"  v-show="contentLoading" style="width: 100%; height: 100%;position: absolute;top: 180px;"></div>

        <el-dialog title="查看样本" :visible.sync="matDialog" width="760px">
            <ul v-if="mats!== undefined && mats.length >0" class="matBox">
                <li v-for="item in mats" @click="download(item)">
                    <img src="../../static/mall/images/icon/guide.png" alt=""/>
                    <a href="javascript:void(0);">{{item.attName}}</a>
                </li>
            </ul>
            <p v-else style="margin: 30px 20px;font-size: 16px;">无模板</p>
            <span slot="footer" class="dialog-footer">
              <!--<el-button type="primary" @click="matDialog=false">关闭</el-button>-->
            </span>
        </el-dialog>

    </div>




    <template id="recursionList">
        <div>
          <div v-for="(item,index) in list" :key="index">
            <p class="situation-title"><span class="situation">情形&nbsp;</span> &nbsp;{{item.stateName}}：</p>
            <p class="situation-title-intro">
                <template v-if="item.answerType=='s'||item.answerType=='y'">
                    <el-radio-group v-model="item.selectAnswerId">
                        <el-radio v-for="(itemAns,ind) in item.answerStates"
                                  :key="ind"
                                  @change="getMatterChildsStateList(list,item,itemAns,index,'radio')"
                                  :value="itemAns.itemStateId"
                                  :label="itemAns.itemStateId" name="answer">{{itemAns.stateName}}</el-radio>
                    </el-radio-group>
                </template>
                <template v-else>
                    <el-checkbox-group v-model="item.selectAnswerId"
                                       :required="item.mustAnswer==1">
                        <el-checkbox v-for="(itemAns,indAns) in item.answerStates"
                                     :key="indAns"
                                     :value="itemAns.itemStateId"
                                     @change="function(value) {getMatterChildsStateList(list,item,itemAns,index,'checkbox',value)}"
                                     :label="itemAns.itemStateId" name="answer">{{itemAns.stateName}}</el-checkbox>
                    </el-checkbox-group>
                </template>
            </p>
            <div v-if="item.children" class="children-item">
                <list :list="item.children"></list>
            </div>
        </div>
        </div>
    </template>
    <script src="../../static/mall/js/listmatter/listmatter.js" th:src="@{/mall/skin_v4.1/js/listmatter/listmatter.js}" type="text/javascript"></script>
</body>
</html>