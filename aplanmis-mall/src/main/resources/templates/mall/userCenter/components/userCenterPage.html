<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>个人中心</title>
  <link rel="stylesheet" href="/framework-ui/src/main/resources/static/agcloud/framework/js-lib/element-2/element.css"
    th:href="@{/agcloud/framework/js-lib/element-2/element.css}">

  <link rel="stylesheet" href="../../../../static/mall/css/common/reset_wt.css"
    th:href="@{/mall/css/common/reset_wt.css}">
  <link rel="stylesheet" href="../../../../static/mall/css/common/base_wt.css"
    th:href="@{/mall/css/common/base_wt.css}">
  <link rel="stylesheet" href="../../../../static/mall/css/userCenter/userCenterPage.css"
    th:href="@{/mall/css/userCenter/userCenterPage.css}">
  <script>
    var ctx = "[[@{/}]]";
  </script>
</head>

<body>
  <div id="userCenterPage" v-cloak>
    <div class="back" @click="backToMyHomeIndex">
      返回
    </div>

    <header>
      <div class="header-wraper">
        <div class="head-img-url">
          <img src="../../../../static/mall/images/userCenter/avatar.png"
            th:src="@{/mall/images/userCenter/avatar.png}">
        </div>
        <div class="head-user-info">
          <p class="nickName"
            v-text='aeaUnitInfo && aeaUnitInfo.loginName || aeaLinkmanInfo && aeaLinkmanInfo .loginName ||"未知用户"'></p>
          <div class="nickName-des" v-if="user=='2'">
            <div class="nickName-des-left">
              <p>法定代表人：{{aeaUnitInfo.idrepresentative||"-"}} </p>
              <p>联系电话：{{aeaUnitInfo.idmobile||"-"}}</p>
            </div>
            <div class="nickName-des-right">
              <p>统一社会信用代码：{{aeaUnitInfo.unifiedSocialCreditCode||"-"}} </p>
              <p>单位名称：{{aeaUnitInfo.applicant||"-"}}</p>
            </div>
          </div>
          <div class="nickName-des" v-else>
            <div class="nickName-des-left">
              <p>联系人名：{{aeaLinkmanInfo.linkmanName||"-"}} </p>
              <p>
                联系电话：{{aeaLinkmanInfo.linkmanOfficePhon && aeaLinkmanInfo.linkmanOfficePhon!=null?aeaLinkmanInfo.linkmanOfficePhon:"-"}}
              </p>
            </div>
            <div class="nickName-des-right">
              <p>身份证号：{{aeaLinkmanInfo.linkmanCertNo||"-"}} </p>
              <p>邮箱：{{aeaLinkmanInfo.linkmanMail||"-"}}</p>
            </div>
          </div>
        </div>
        <div class="head-user-approval" @click="goToStageApply">
          <!--                    <a href="javascript:;" class="btn" @click="goToStageApply">并联申报</a>-->
          <!--                    <a href="javascript:;" class="btn">单项申报</a>-->
          <img src="../../../../static/mall/images/userCenter/icon.png" th:src="@{/mall/images/userCenter/icon.png}"
            alt="并联申报图标">
          <p style="margin-top:3px;">并联申报</p>
        </div>
      </div>
    </header>

    <div class="first" v-if="user=='1'">
      <div class="tabs-container normal">
        <!-- <ul class="tabs">
        <li class="tabs__item active" @click="tabChange1($event,'0')"><a href="javascript:void(0);">个人信息</a></li>
        <li class="tabs__item" @click="tabChange1($event,'1')"><a href="javascript:void(0);">企业管理</a></li>
      </ul>-->
        <ul class="wt-tab-nav-two">
          <li class="active" @click="tabChange1($event,'0')">个人信息</li>
          <p class="bottom-line"></p>
          <li class="" @click="tabChange1($event,'1')">企业管理</li>
        </ul>
      </div>
      <div class="table-card">
        <div class="table1" v-if="curTab=='0'">
          <div class="single-table" v-bind="aeaLinkmanInfo">
            <p>用户信息</p>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">用户名 <span class="required">*</span></div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanName" placeholder="请填写用户名"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">身份证号 <span class="required">*</span></div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanCertNo" placeholder="请填写身份证号"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">电话</div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanOfficePhon" placeholder="请填写电话"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">邮箱</div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanMail" placeholder="请填写邮箱"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">地址</div>
              </el-col>
              <el-col :span="17" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanAddr" placeholder="请填写地址"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">经营范围</div>
              </el-col>
              <el-col :span="17" class="td">
                <el-input v-model="aeaLinkmanInfo.linkmanMemo" placeholder="请填写经营范围"></el-input>
              </el-col>
            </el-row>
            <p>账号信息</p>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">登录名</div>
              </el-col>
              <el-col :span="17" class="td">
                <el-input v-model="aeaLinkmanInfo.loginName" placeholder="请填写登录名"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">修改密码</div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="loginPwd" placeholder="请填写密码"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">再次确认密码</div>
              </el-col>
              <el-col :span="7" class="td">
                <el-input v-model="confirmPwd" class="yesPwd" placeholder="请填写确认密码"></el-input>
              </el-col>
            </el-row>
            <div class="footer" style="text-align: center;margin-top: 85px;">
              <el-button type="primary"
                style="width:120px;height:40px;background:rgba(69,126,255,1);border-radius:4px;font-size:14px;"
                @click="saveUserinfo">保 存</el-button>
            </div>
          </div>
        </div>
        <div class="table1" v-if="curTab=='1'">
          <el-table class='el-table' :data="tableData1" style="width: 100%;margin-top: 27px;">
            <el-table-column prop="applicant" label="企业名称"></el-table-column>
            <el-table-column prop="unifiedSocialCreditCode" label="统一社会信用代码"></el-table-column>
            <el-table-column prop="idrepresentative" label="法定代表人"></el-table-column>
            <el-table-column prop="idno" label="法人证件号码"></el-table-column>
          </el-table>
          <div class="tips"><i style="color: red;">* </i>温馨提示：您已被列表中的企业设置为委托人，可代表这些企业办理申报业务。</div>
        </div>
      </div>
    </div>
    <div class="second" v-if="user=='0'">
      <div class="tabs-container normal">
        <!-- <ul class="tabs">
        <li class="tabs__item active" @click=""><a href="javascript:void(0);">个人信息</a></li>
      </ul>-->
        <ul class="wt-tab-nav-two">
          <li class="active">个人信息</li>
        </ul>
      </div>
      <div class="table1">
        <div class="single-table" v-bind="aeaLinkmanInfo">
          <p>用户信息</p>
          <el-row>
            <el-col :span="3" class="tr">
              <div class="grid-content">用户名 <span class="required">*</span></div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="aeaLinkmanInfo.linkmanName" placeholder="请填写用户名"></el-input>
            </el-col>
            <el-col :span="3" class="tr">
              <div class="grid-content">身份证号 <span class="required">*</span></div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="aeaLinkmanInfo.linkmanCertNo" placeholder="请填写身份证号"></el-input>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="3" class="tr">
              <div class="grid-content">电话</div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="aeaLinkmanInfo.linkmanOfficePhon" placeholder="请填写电话"></el-input>
            </el-col>
            <el-col :span="3" class="tr">
              <div class="grid-content">邮箱</div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="aeaLinkmanInfo.linkmanMail" placeholder="请填写邮箱"></el-input>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="3" class="tr">
              <div class="grid-content">地址</div>
            </el-col>
            <el-col :span="17" class="td">
              <el-input v-model="aeaLinkmanInfo.linkmanAddr" placeholder="请填写地址"></el-input>
            </el-col>
          </el-row>
          <p>账号信息</p>
          <el-row>
            <el-col :span="3" class="tr">
              <div class="grid-content">登录名</div>
            </el-col>
            <el-col :span="17" class="td">
              <el-input v-model="aeaLinkmanInfo.loginName" placeholder="请填写登录名"></el-input>
            </el-col>
          </el-row>
          <el-row>
            <el-col :span="3" class="tr">
              <div class="grid-content">修改密码</div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="loginPwd" placeholder="请填写密码"></el-input>
            </el-col>
            <el-col :span="3" class="tr">
              <div class="grid-content">再次确认密码</div>
            </el-col>
            <el-col :span="7" class="td">
              <el-input v-model="confirmPwd" class="yesPwd" placeholder="请填写确认密码"></el-input>
            </el-col>
          </el-row>
          <div class="footer" style="margin-left: 373px;margin-top: 70px;">
            <el-button style="width: 120px;height: 40px;" type="primary" @click="saveUserinfo">保 存</el-button>
          </div>
        </div>
      </div>
    </div>
    <div class="third" v-if="user=='2'">
      <div class="tabs-container normal">
        <!--<ul class="tabs">
        <li class="tabs__item active" @click="tabChange2($event,'0')"><a href="javascript:void(0);">企业信息</a></li>
        <li class="tabs__item" @click="tabChange2($event,'1')"><a href="javascript:void(0);">委托人管理</a></li>
      </ul>-->
        <ul class="wt-tab-nav-two">
          <li class="active" @click="tabChange2($event,'0')">企业信息</li>
          <p class="bottom-line"></p>
          <li class="" @click="tabChange2($event,'1')">委托人管理</li>
        </ul>
      </div>
      <div class="table-card">
        <div class="table1" v-if="curTab2=='0'">
          <div class="single-table" v-bind="aeaUnitInfo">
            <p>单位信息</p>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">单位名称 <span class="required">*</span></div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.applicant" placeholder="请填写单位名称"></el-input>
              </el-col>
              <el-col :span="4" class="tr">
                <div class="grid-content">统一社会信用代码 <span class="required">*</span></div>
              </el-col>
              <el-col :span="8" class="td">
                <el-input v-model="aeaUnitInfo.unifiedSocialCreditCode" placeholder="请填写统一社会信用代码"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">工商登记号</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.induCommRegNum" placeholder="请填写工商登记号"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">组织机构代码</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.organizationalCode" placeholder="请填写组织机构代码"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">政区（园区）</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.applicantDistrict" placeholder="请填写政区(园区)"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">注册资本</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.registeredCapital" placeholder="请填写注册资本"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">注册登记机关</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.registerAuthority" placeholder="请填写注册登记机关"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">邮政编码</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.postalCode" placeholder="请填写邮政编码"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">纳税人识别号</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.taxpayerNum" placeholder="请填写纳税人识别号"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">信用标记码</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.creditFlagNum" placeholder="请填写信用标记码"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">法定代表人 <span class="required">*</span></div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.idrepresentative" placeholder="请填写法定代表人"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">法人证件号 <span class="required">*</span></div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="aeaUnitInfo.idno" placeholder="请填写法人证件号"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">具体地址</div>
              </el-col>
              <el-col :span="21" class="td">
                <el-input v-model="aeaUnitInfo.applicantDetailSite" placeholder="请填写具体地址"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">经营范围</div>
              </el-col>
              <el-col :span="21" class="td">
                <el-input v-model="aeaUnitInfo.managementScope" placeholder="请填写经营范围"></el-input>
              </el-col>
            </el-row>
            <p>账号信息</p>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">登录名</div>
              </el-col>
              <el-col :span="21" class="td">
                <el-input v-model="aeaUnitInfo.loginName" placeholder="请填写登录名"></el-input>
              </el-col>
            </el-row>
            <el-row>
              <el-col :span="3" class="tr">
                <div class="grid-content">修改密码</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="loginPwd2" placeholder="请填写密码"></el-input>
              </el-col>
              <el-col :span="3" class="tr">
                <div class="grid-content">再次确认密码</div>
              </el-col>
              <el-col :span="9" class="td">
                <el-input v-model="confirmPwd2" class="yesPwd" placeholder="请填写确认密码"></el-input>
              </el-col>
            </el-row>
            <div class="footer" style="margin-left: 373px;margin-top: 70px;">
              <el-button style="width: 120px;height: 40px;" type="primary" @click="saveUnitinfo">保 存</el-button>
            </div>
          </div>
        </div>
        <div class="table1" v-if="curTab2=='1'">
          <div class="header" style="margin-top: 23px;height: 49px;">
            <el-button type="primary" icon="el-icon-plus" style="float:left;margin-bottom: 20px;" @click="addPersonFun">
              添加联系人</el-button>
            <div class="choose" style="float:right;padding-top:20px;">
              <el-radio v-model="radio" label="0" @change="radioChange">显示全部</el-radio>
              <el-radio v-model="radio" label="1" @change="radioChange">只显示委托人</el-radio>
            </div>
          </div>
          <div class="tips"><i class="el-icon-warning-outline"
              style="font-size: 28px;color: rgba(255,184,34,1);vertical-align: middle;"></i> <span
              style="color: #FF4B47;">温馨提示* </span>：点击【绑定单位】按钮即可委托该用户代表当前企业办理申报业务。若取消某用户的办理权限，可点击【解绑单位】按钮。</div>
          <el-table class='el-table' :data="tableData2" style="width: 100%">
            <el-table-column prop="linkmanName" label="用户名"></el-table-column>
            <el-table-column prop="linkmanMobilePhone" label="电话"></el-table-column>
            <el-table-column prop="isBindAccount" label="是否委托人" width="100">
              <template slot-scope="scope">
                {{scope.row.isBindAccount=='1'?'是':'否'}}
              </template>
            </el-table-column>
            <el-table-column label="操作">
              <template slot-scope="scope">
                <el-button type="success" plain size='mini' v-if="scope.row.isBindAccount=='1'"
                  @click="bindRelation(scope.row,'0')">解绑单位</el-button>
                <el-button type="primary" plain size='mini' v-else @click="bindRelation(scope.row,'1')">绑定单位</el-button>
                <el-button type="primary" size='mini' @click="editRelation(scope.row)">编辑</el-button>
                <el-button size='mini' @click="deleteRelation(scope.row)">删除</el-button>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </div>
    </div>

    <el-dialog :title="editTitle" :visible.sync="addPerson" width="800px">
      <!-- <el-select v-if="isAdd" clearable :filterable="true" :remote="true" reserve-keyword @change="hangeSelectChange"
        @clear="clearSelect" :remote-method="remoteMethod" value-key="linkmanCertNo" v-model="selectObj" filterable
        placeholder="请输入姓名/证件号码/手机号码查询" style="width:555px;margin-left: 119px;margin-bottom: 20px;">
        <el-option v-for="item in selectPeple" :key="item.linkmanInfoId" :label="item.linkmanName" :value="item">
        </el-option>
      </el-select>
      <div style="display: inline-block;" v-if="isAdd"> <span
          style="cursor:pointer;background: #457EFF;padding: 11px 15px;color: #fff;border-radius: 4px;"
          @click="searchLinkman"><i class="el-icon-search"></i>查询</span></div> -->
      <!-- <el-input v-model="keyword" placeholder="请输入姓名/证件号码/手机号码查询"style="width:555px;margin-left: 119px;margin-bottom: 20px;">
      <template slot="append" v-if="isAdd"> <span style="cursor:pointer;" @click="searchLinkman"><i class="el-icon-search"></i>查询</span></template>
      </el-input>-->
      <el-form :inline="true" :model="RowData" label-width="120px" :rules="rules" ref="RowData"
        class="demo-form-inline">
        <el-form-item label="所在单位">
          <el-input v-model="RowData.applicant" placeholder="所在单位" style="width:555px;"></el-input>
        </el-form-item>
        <el-form-item label="联系人姓名" required prop="linkmanName">
          <el-input v-model="RowData.linkmanName" :clearable="true" placeholder="联系人姓名" style="width:210px;"></el-input>
        </el-form-item>
        <el-form-item label="证件号码" required prop="linkmanCertNo">
          <el-input v-model="RowData.linkmanCertNo" placeholder="请输入姓名/证件号码/手机号码查询" style="width:210px;">
          </el-input>
        </el-form-item>
        <el-form-item label="手机号码" required prop="linkmanMobilePhone">
          <el-input v-model="RowData.linkmanMobilePhone" :clearable="true" placeholder="手机号码" style="width:210px;">
          </el-input>
        </el-form-item>
        <el-form-item label="办公电话" prop="linkmanOfficePhon">
          <el-input v-model="RowData.linkmanOfficePhon" :clearable="true" placeholder="办公电话" style="width:210px;">
          </el-input>
        </el-form-item>
        <el-form-item label="传真" prop="linkmanFax">
          <el-input v-model="RowData.linkmanFax" :clearable="true" placeholder="传真" style="width:210px;"></el-input>
        </el-form-item>
        <el-form-item label="电子邮箱" prop="linkmanMail">
          <el-input v-model="RowData.linkmanMail" :clearable="true" placeholder="电子邮箱" style="width:210px;"></el-input>
        </el-form-item>
        <el-form-item label="是否绑定单位">
          <el-select v-model="RowData.isBindAccount" @change="" style="width:555px;">
            <el-option key="0" label="否" value="0"></el-option>
            <el-option key="1" label="是" value="1"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="联系人住址" prop="linkmanAddr">
          <el-input type="textarea" :rows="3" placeholder="联系人住址" style="width:555px;" v-model="RowData.linkmanAddr">
          </el-input>
        </el-form-item>
        <el-form-item label="备注" prop="linkmanMemo">
          <el-input type="textarea" :rows="3" placeholder="备注" style="width:555px;" v-model="RowData.linkmanMemo">
          </el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="saveAddUser">保 存</el-button>
        <el-button @click="addPerson=false">取消</el-button>
      </div>
    </el-dialog>
  </div>
  <script src="/framework-ui/src/main/resources/static/agcloud/framework/js-lib/jquery-v1/jquery.min.js"
    th:src="@{/agcloud/framework/js-lib/jquery-v1/jquery.min.js}"></script>
  <script src="/framework-ui/src/main/resources/static/agcloud/framework/js-lib/vue-v2/vue.js"
    th:src="@{/agcloud/framework/js-lib/vue-v2/vue.js}"></script>
  <script src="/framework-ui/src/main/resources/static/agcloud/framework/js-lib/element-2/element.js"
    th:src="@{/agcloud/framework/js-lib/element-2/element.js}"></script>
  <!--<script src="/framework-ui/src/main/resources/static/agcloud/framework/js-lib/agcloud-lib/js/common.js" th:src="@{/agcloud/framework/js-lib/agcloud-lib/js/common.js}"></script>-->
  <script src="../../../../static/common/js/common.js" th:src="@{/common/js/common.js}"></script>

  <script src="../../../../static/mall/js/userCenter/components/md5.js"
    th:src="@{/mall/js/userCenter/components/md5.js}" type="text/javascript"></script>
  <!--<script src="/framework-ui/src/main/resources/static/sm3/sm3.js" th:src="@{/sm3/sm3.js}"></script>-->

  <script type="text/javascript">
    var module1 = new Vue({
      el: '#userCenterPage',
      data: function () {
        return {
          // 页面loading
          loading: false,
          keyword: "",
          tableData1: [{
            matName: '111',
            itemCode: '111',
            itemType: '111',
            orgName: '111'
          }],
          tableData2: [{
            matName: '222',
            itemCode: '222',
            itemType: '222'
          }],
          selectPeple: [],
          options: [],
          radio: '0',
          user: '2',
          curTab: 0,
          curTab2: 0,
          formData: {},
          formData2: {},
          formData3: {},
          addPerson: false,
          RowData: {},
          isAdd: true,
          //个人信息
          aeaLinkmanInfo: {},
          // 备份个人信息
          backUpAeaLinkmanInfo: {},
          //企业信息
          aeaUnitInfo: {},
          // 备份企业信息
          backUpAeaUnitInfo: {},
          // 临时联系人弹窗备份数据
          temporaryLinkman: {},
          rules: {
            linkmanName: [
              { required: true, message: '请输入联系人姓名' }
            ],
            linkmanCertNo: [
              { required: true, message: '请输入联系人身份证号' }
            ],
            linkmanMobilePhone: [
              { required: true, message: '请输入联系人手机号' }
            ],
          },
          confirmPwd: '',
          confirmPwd2: '',
          loginPwd: '',
          loginPwd2: '',
          editTitle: '添加联系人',
          selectObj: {},
        }
      },
      methods: {
        // 点击并联申报
        goToStageApply: function () {
          userCenter.vm.selectNav = "我的项目库";
          localStorage.setItem('selectNav', userCenter.vm.selectNav);
          location.href = ctx + "rest/main/toIndexPage?projInfoId=null#declare";
        },

        tabChange1: function (e, num) {
          if (e.target.localName == "a") {
            var target = $(e.target.parentNode);
          } else {
            var target = $(e.target);
          }
          if (target.hasClass('active')) return;

          this.curTab = num;
          target.addClass('active').siblings().removeClass('active');
        },
        tabChange2: function (e, num) {
          if (e.target.localName == "a") {
            var target = $(e.target.parentNode);
          } else {
            var target = $(e.target);
          }
          if (target.hasClass('active')) return;

          this.curTab2 = num;

          target.addClass('active').siblings().removeClass('active');

        },
        radioChange: function (val) {
          if (val == '0') {
            val = '';
          }
          this.getlinkman(val);
        },
        // 获取信息
        getUserinfo: function () {
          var _this = this;
          request('', {
            url: ctx + 'rest/user/userinfo',
            type: 'get',
            data: {}
          }, function (res) {
            if (res.success) {

              if (res.content.aeaLinkmanInfo || res.content.aeaUnitInfo) {
                _this.aeaLinkmanInfo = res.content.aeaLinkmanInfo;
                _this.backUpAeaLinkmanInfo = JSON.parse(JSON.stringify(res.content.aeaLinkmanInfo));
                _this.aeaUnitInfo = res.content.aeaUnitInfo || {};
                _this.backUpAeaUnitInfo = JSON.parse(JSON.stringify(res.content.aeaUnitInfo)) || {};
                _this.option = res.content.aeaUnitList;
                _this.user = res.content.role;
                console.log("取到User的值", _this.user);
                if (_this.user == '2') {
                  // _this.confirmPwd2 = _this.aeaUnitInfo.loginPwd;
                } else {
                  // _this.confirmPwd = _this.aeaLinkmanInfo.loginPwd;
                  _this.getUnitLinkman();
                }
              }

              // _this.aeaLinkmanInfo = _this.res.content.aeaUnitInfo;
              // _this.RowData = _this.res.content.aeaUnitInfo;
            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        //添加联系人按钮
        addPersonFun: function () {
          var _this = this;
          this.addPerson = true;
          this.isAdd = true;
          this.editTitle = "添加联系人";
          // setTimeout(function () {
          //   _this.$refs['RowData'].clearValidate();
          // }, 20)
          this.$nextTick(function () {
            _this.$refs['RowData'].clearValidate();
          });
          this.RowData = new Object();
          this.RowData.applicant = this.aeaUnitInfo.applicant;
          this.RowData.unitInfoId = this.aeaUnitInfo.unitInfoId;
          //this.RowData.isBindAccount = '0';
        },
        // 查询委托人/所有人
        getlinkman: function (isAll) {
          var _this = this;
          request('', {
            url: ctx + 'rest/user/linkman/list',
            type: 'get',
            data: {
              isAll: isAll ? isAll : ''
            }
          }, function (res) {
            if (res.success) {
              _this.tableData2 = res.content;
              _this.selectPeple = res.content;
            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        // 企业联系人
        getUnitLinkman: function () {
          var _this = this;
          request('', {
            url: ctx + 'rest/user/unitinfo/list/' + this.aeaLinkmanInfo.linkmanInfoId,
            type: 'get',
          }, function (res) {
            if (res.success) {
              _this.tableData1 = res.content;
            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        // 编辑联系人
        editRelation: function (val) {
          var _this = this;
          this.isAdd = false;
          this.addPerson = true;
          this.editTitle = "编辑联系人"

          request('', {
            url: ctx + 'rest/user/linkman/' + val.linkmanInfoId + '/' + val.unitInfoId,
            type: 'get',
          }, function (res) {
            if (res.success) {
              _this.RowData = res.content;
              _this.RowData.applicant = _this.aeaUnitInfo.applicant;
              _this.RowData.unitInfoId = _this.aeaUnitInfo.unitInfoId;

              // 备份联系人数据
              _this.temporaryLinkman = JSON.parse(JSON.stringify(_this.RowData));
            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        //查找联系人
        searchLinkman: function () {
          var _this = this;
          if (!this.keyword) {
            _this.$message({
              message: '请输入姓名/证件号码/手机号码查询',
              type: 'error'
            });
            return;
          }
          request('', {
            url: ctx + 'rest/user/linkman/list/key',
            type: 'get',
            data: {
              keyword: this.keyword,
              unitInfoId: this.RowData.unitInfoId
            }
          }, function (res) {
            if (res.success) {
              if (res.content.length === 0) {
                _this.$message({
                  message: '未查找到该联系人，请换个关键词',
                  type: 'error'
                });
                _this.selectPeple = [];
                return;
              }
              _this.$message.close();
              // _this.RowData = res.content[0];
              _this.selectPeple = res.content;
            } else {
              _this.$message.error("查询失败，请稍后重试！");
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        remoteMethod: function (query) {
          var _this = this;
          if (query !== '') {
            // this.loading = true;
            this.keyword = query;
            this.searchLinkman();
          } else {
            this.selectPeple = [];
          }
        },
        clearSelect: function () {
          var _this = this;
          this.selectObj = {};
          this.selectPeple = [];
          this.RowData = {};
          setTimeout(function () {
            _this.$refs['RowData'].clearValidate();
          }, 20)
        },
        hangeSelectChange: function (val) {
          this.RowData = val;
        },
        // 绑定解绑单位
        bindRelation: function (val, isAll) {
          var _this = this;
          var bind = isAll == '0' ? '解绑' : '绑定';
          confirmMsg('', '确定要' + bind + '单位吗？', function () {
            request('', {
              url: ctx + 'rest/user/bindRelation/update',
              type: 'post',
              data: {
                isBindAccount: isAll,
                linkmanInfoId: val.linkmanInfoId,
                unitInfoId: val.unitInfoId
              }
            }, function (res) {
              if (res.success) {
                _this.$message({
                  message: '操作成功',
                  type: 'success'
                });
                _this.getlinkman();
              } else {
                _this.$message.error(res.message);
              }

            }, function () {
              _this.$message.error('获取数据失败，请重试');
            });
          })

        },
        // 删除联系人
        deleteRelation: function (val) {
          var _this = this;
          confirmMsg('', '确定要删除联系人吗？', function () {
            request('', {
              url: ctx + 'rest/user/linkman/delete/' + val.unitInfoId + '/' + val.linkmanInfoId,
              type: 'delete',
            }, function (res) {
              if (res.success) {
                _this.$message({
                  message: '删除成功',
                  type: 'success'
                });
                _this.getlinkman();
              } else {
                _this.$message.error(res.message);
              }

            }, function () {
              _this.$message.error('获取数据失败，请重试');
            });
          })


        },
        // 个人中心保存
        saveUserinfo: function () {
          var _this = this;
          var param = {
            linkmanInfoId: this.aeaLinkmanInfo.linkmanInfoId,
            linkmanName: this.aeaLinkmanInfo.linkmanName,
            linkmanCertNo: this.aeaLinkmanInfo.linkmanCertNo,
            linkmanOfficePhon: this.aeaLinkmanInfo.linkmanOfficePhon,
            linkmanMail: this.aeaLinkmanInfo.linkmanMail,
            linkmanAddr: this.aeaLinkmanInfo.linkmanAddr,
            loginName: this.aeaLinkmanInfo.loginName,
            loginPwd: this.loginPwd ? hex_md5(this.loginPwd) : this.aeaLinkmanInfo.loginPwd
          }

          if (!this.aeaLinkmanInfo.linkmanCertNo) {
            this.$message({
              message: '请输入身份证号',
              type: 'error'
            });
            return;
          }

          // 身份证号码为空或者判断当前的身份证号码是否有改动，有改动触发校验
          if (!param.linkmanCertNo || param.linkmanCertNo != this.backUpAeaLinkmanInfo.linkmanCertNo) {
            if (!this.cardReg(this.aeaLinkmanInfo.linkmanCertNo)) {
              this.$message({
                message: '请输入正确的身份证号',
                type: 'error'
              });
              return;
            }
          }

          // 当前的电话号码有值并且当前的电话号码是否有改动，有改动触发校验
          if (!!this.aeaLinkmanInfo.linkmanOfficePhon && param.linkmanOfficePhon != this.backUpAeaLinkmanInfo.linkmanOfficePhon) {
            if (!this.phoneReg(this.aeaLinkmanInfo.linkmanOfficePhon)) {
              this.$message({
                message: '请输入正确的电话号码',
                type: 'error'
              });
              return;
            }
          }

          if (this.loginPwd && !this.confirmPwd) {
            this.$message({
              message: '请再次输入密码',
              type: 'error'
            });
            return;
          }
          if (this.loginPwd && this.confirmPwd != this.loginPwd) {
            this.$message({
              message: '两次输入密码不一样，请重新输入',
              type: 'error'
            });
            return;
          }

          // if(!this.cardReg(this.aeaLinkmanInfo.linkmanCertNo)){
          //   this.$message({
          //       message: '请输入正确的身份证号',
          //       type: 'error'
          //     });
          //     return;
          // }
          // if(!this.aeaLinkmanInfo.linkmanCertNo){
          //   this.$message({
          //       message: '请输入身份证号',
          //       type: 'error'
          //     });
          //     return;
          // }

          request('', {
            url: ctx + 'rest/user/linkman/save',
            type: 'post',
            data: param
          }, function (res) {
            if (res.success) {
              _this.$message({
                message: '保存成功',
                type: 'success'
              });

            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        //单位信息保存
        saveUnitinfo: function () {
          var _this = this;
          // var param = {
          //   unitInfoId: this.aeaUnitInfo.unitInfoId,
          //   applicant: this.aeaUnitInfo.applicant,
          //   idcard: this.aeaUnitInfo.idcard,
          //   unifiedSocialCreditCode: this.aeaUnitInfo.unifiedSocialCreditCode,
          //   organizationalCode: this.aeaUnitInfo.organizationalCode,
          //   induCommRegNum: this.aeaUnitInfo.induCommRegNum,
          //   idrepresentative: this.aeaUnitInfo.idrepresentative,
          //   idno: this.aeaUnitInfo.idno,
          //   applicantDetailSite: this.aeaUnitInfo.applicantDetailSite,
          //   loginName: this.aeaUnitInfo.loginName,
          //   loginPwd: this.loginPwd2 ? hex_md5(this.loginPwd2) : this.aeaUnitInfo.loginPwd
          // }

          var param = JSON.parse(JSON.stringify(this.aeaUnitInfo))
          param.loginPwd = this.loginPwd2 ? hex_md5(this.loginPwd2) : this.aeaUnitInfo.loginPwd

          if (!this.aeaUnitInfo.idno) {
            this.$message({
              message: '请输入法人证件号',
              type: 'error'
            });
            return;
          }

          // 法人证件号为空或者判断当前的法人证件号是否有改动，有改动触发校验
          if (!param.idno || param.idno != this.backUpAeaUnitInfo.idno) {
            if (!this.cardReg(this.aeaUnitInfo.idno)) {
              this.$message({
                message: '请输入正确的法人证件号',
                type: 'error'
              });
              return;
            }
          }

          if (this.loginPwd2 && !this.confirmPwd2) {
            this.$message({
              message: '请再次输入密码',
              type: 'error'
            });
            return;
          }
          if (this.loginPwd2 && this.confirmPwd2 != this.loginPwd2) {
            this.$message({
              message: '两次输入密码不一样，请重新输入',
              type: 'error'
            });
            return;
          }
          if (!this.aeaUnitInfo.applicant) {
            this.$message({
              message: '请输入单位名称',
              type: 'error'
            });
            return;
          }
          if (!this.aeaUnitInfo.unifiedSocialCreditCode) {
            this.$message({
              message: '请输入统一社会信用代码',
              type: 'error'
            });
            return;
          }
          // if (!this.aeaUnitInfo.idno) {
          //   this.$message({
          //     message: '请输入法人证件号',
          //     type: 'error'
          //   });
          //   return;
          // }
          // if (!this.cardReg(this.aeaUnitInfo.idno)) {
          //   this.$message({
          //     message: '请输入正确的法人证件号',
          //     type: 'error'
          //   });
          //   return;
          // }

          request('', {
            url: ctx + 'rest/user/unitInfo/save',
            type: 'post',
            data: param
          }, function (res) {
            if (res.success) {
              _this.$message({
                message: '保存成功',
                type: 'success'
              });

            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },
        //新增联系人保存
        saveAddUser: function () {
          var _this = this;
          if (!this.RowData.linkmanName) {
            this.$message({
              message: '请输入联系人姓名',
              type: 'error'
            });
            return;
          }

          if (!this.RowData.linkmanCertNo) {
            this.$message({
              message: '请输入联系人身份证号',
              type: 'error'
            });
            return;
          }

          if (!this.RowData.linkmanMobilePhone) {
            this.$message({
              message: '请输入手机号',
              type: 'error'
            });
            return;
          }

          // 判断当前的身份证号码是否有改动，有改动触发校验
          if (this.RowData.linkmanCertNo != this.temporaryLinkman.linkmanCertNo) {
            if (!this.cardReg(this.RowData.linkmanCertNo)) {
              this.$message({
                message: '请输入正确的身份证号',
                type: 'error'
              });
              return;
            }
          }

          // 当前的电话号码有值并且当前的电话号码是否有改动，有改动触发校验
          if (!!this.RowData.linkmanMobilePhone && this.RowData.linkmanMobilePhone != this.temporaryLinkman.linkmanMobilePhone) {
            if (!this.phoneReg(this.RowData.linkmanMobilePhone)) {
              this.$message({
                message: '请输入正确的电话号码',
                type: 'error'
              });
              return;
            }
          }
          // if (this.RowData.linkmanCertNo.length < 18) {
          //   this.$message({
          //     message: '请输入正确的身份证号',
          //     type: 'error'
          //   });
          //   return;
          // }
          // if (!this.RowData.linkmanCertNo) {
          //   this.$message({
          //     message: '请输入联系人身份证号',
          //     type: 'error'
          //   });
          //   return;
          // }
          // if (!this.RowData.linkmanMobilePhone) {
          //   this.$message({
          //     message: '请输入手机号',
          //     type: 'error'
          //   });
          //   return;
          // }
          // if (this.RowData.linkmanMobilePhone.length < 11) {
          //   this.$message({
          //     message: '请输入正确的手机号',
          //     type: 'error'
          //   });
          //   return;
          // }

          // 是否新增，反之编辑
          if (this.isAdd) {
            var param = {
              // linkmanInfoId: '',
              linkmanType: 'u',
              unitInfoId: this.RowData.unitInfoId,
              linkmanName: this.RowData.linkmanName,
              linkmanCertNo: this.RowData.linkmanCertNo,
              linkmanMobilePhone: this.RowData.linkmanMobilePhone,
              linkmanOfficePhon: this.RowData.linkmanOfficePhon,
              linkmanFax: this.RowData.linkmanFax,
              linkmanMail: this.RowData.linkmanMail,
              isBindAccount: this.RowData.isBindAccount,
              linkmanAddr: this.RowData.linkmanAddr,
              linkmanMemo: this.RowData.linkmanMemo
            }
          } else {
            var param = {
              linkmanInfoId: this.RowData.linkmanInfoId,
              linkmanType: 'u',
              unitInfoId: this.RowData.unitInfoId,
              linkmanName: this.RowData.linkmanName,
              linkmanCertNo: this.RowData.linkmanCertNo,
              linkmanMobilePhone: this.RowData.linkmanMobilePhone,
              linkmanOfficePhon: this.RowData.linkmanOfficePhon,
              linkmanFax: this.RowData.linkmanFax,
              linkmanMail: this.RowData.linkmanMail,
              isBindAccount: this.RowData.isBindAccount,
              linkmanAddr: this.RowData.linkmanAddr,
              linkmanMemo: this.RowData.linkmanMemo
            }
          }

          request('', {
            url: ctx + 'rest/user/linkmanCascade/save',
            type: 'post',
            data: param
          }, function (res) {
            if (res.success) {
              _this.$message({
                message: '保存成功',
                type: 'success'
              });
              _this.getlinkman();
              _this.addPerson = false;
            } else {
              _this.$message.error(res.message);
            }

          }, function () {
            _this.$message.error('获取数据失败，请重试');
          });
        },

        // 返回到个人中心首页
        backToMyHomeIndex: function () {
          var item = {
            itemName: '我的首页',
            value: 'MyHomeIndex',
            select: true,
          }
          userCenter.vm.userCenterMenuSelect(item)
        },

        //验证手机号
        phoneReg: function (val) {
          // var phone = /(^1[3|4|5|7|8|9]\d{9}$)|(^09\d{8}$)/;
          var phone = /^1[3|4|5|7|8|9]\d{9}$/;
          return phone.test(val);
        },
        //验证身份证号
        cardReg: function (val) {
          var card = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
          return card.test(val);
        },
        //验证邮箱
        emailReg: function (val) {
          var email = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
          return email.test(val);
        }


      },
      created: function () {
        this.getUserinfo();
      },
      mounted: function () {
        this.getlinkman();
      },
      watch: {
        confirmPwd: function (val) {
          if (val != this.aeaLinkmanInfo.loginPwd) {
            $(".yesPwd .el-input__inner").css('border-color', 'red');
          } else {
            $(".yesPwd .el-input__inner").css('border-color', 'green');
          }
        },
        confirmPwd2: function (val) {
          if (val != this.aeaUnitInfo.loginPwd) {
            $(".yesPwd .el-input__inner").css('border-color', 'red');
          } else {
            $(".yesPwd .el-input__inner").css('border-color', 'green');
          }
        }
      }
    })
  </script>
</body>

</html>